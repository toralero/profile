window.OpenSeadragon=window.OpenSeadragon||function(a){return new OpenSeadragon.Viewer(a)};if(typeof define==="function"&&define.amd){define(function(){return(window.OpenSeadragon)})}(function(c){c.version={versionStr:"<%= osdVersion.versionStr %>",major:parseInt("<%= osdVersion.major %>",10),minor:parseInt("<%= osdVersion.minor %>",10),revision:parseInt("<%= osdVersion.revision %>",10)};var b={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},d=Object.prototype.toString,a=Object.prototype.hasOwnProperty;c.isFunction=function(e){return c.type(e)==="function"};c.isArray=Array.isArray||function(e){return c.type(e)==="array"};c.isWindow=function(e){return e&&typeof e==="object"&&"setInterval" in e};c.type=function(e){return(e===null)||(e===undefined)?String(e):b[d.call(e)]||"object"};c.isPlainObject=function(g){if(!g||OpenSeadragon.type(g)!=="object"||g.nodeType||c.isWindow(g)){return false}if(g.constructor&&!a.call(g,"constructor")&&!a.call(g.constructor.prototype,"isPrototypeOf")){return false}var e;for(var f in g){e=f}return e===undefined||a.call(g,e)};c.isEmptyObject=function(f){for(var e in f){return false}return true};c.freezeObject=function(e){if(Object.freeze){c.freezeObject=Object.freeze}else{c.freezeObject=function(f){return f}}return c.freezeObject(e)};c.supportsCanvas=(function(){var e=document.createElement("canvas");return !!(c.isFunction(e.getContext)&&e.getContext("2d"))}());c.isCanvasTainted=function(f){var i=false;try{var g=f.getContext("2d").getImageData(0,0,1,1)}catch(h){i=true}return i};c.pixelDensityRatio=(function(){if(c.supportsCanvas){var f=document.createElement("canvas").getContext("2d");var e=window.devicePixelRatio||1;var g=f.webkitBackingStorePixelRatio||f.mozBackingStorePixelRatio||f.msBackingStorePixelRatio||f.oBackingStorePixelRatio||f.backingStorePixelRatio||1;return e/g}else{return 1}}())}(OpenSeadragon));(function($){$.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},length=arguments.length,deep=false,i=1;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(typeof target!=="object"&&!OpenSeadragon.isFunction(target)){target={}}if(length===i){target=this;--i}for(;i<length;i++){options=arguments[i];if(options!==null||options!==undefined){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(OpenSeadragon.isPlainObject(copy)||(copyIsArray=OpenSeadragon.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&OpenSeadragon.isArray(src)?src:[]}else{clone=src&&OpenSeadragon.isPlainObject(src)?src:{}}target[name]=OpenSeadragon.extend(deep,clone,copy)}else{if(copy!==undefined){target[name]=copy}}}}}return target};var isIOSDevice=function(){if(typeof navigator!=="object"){return false}var userAgent=navigator.userAgent;if(typeof userAgent!=="string"){return false}return userAgent.indexOf("iPhone")!==-1||userAgent.indexOf("iPad")!==-1||userAgent.indexOf("iPod")!==-1};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:false,ajaxWithCredentials:false,panHorizontal:true,panVertical:true,constrainDuringPan:false,wrapHorizontal:false,wrapVertical:false,visibilityRatio:0.5,minPixelRatio:0.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:false,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:true,clickToZoom:true,dblClickToZoom:false,pinchToZoom:false,flickEnabled:false,flickMinSpeed:120,flickMomentum:0.25,pinchRotate:false},gestureSettingsTouch:{scrollToZoom:false,clickToZoom:false,dblClickToZoom:true,pinchToZoom:true,flickEnabled:true,flickMinSpeed:120,flickMomentum:0.25,pinchRotate:false},gestureSettingsPen:{scrollToZoom:false,clickToZoom:true,dblClickToZoom:false,pinchToZoom:false,flickEnabled:false,flickMinSpeed:120,flickMomentum:0.25,pinchRotate:false},gestureSettingsUnknown:{scrollToZoom:false,clickToZoom:false,dblClickToZoom:true,pinchToZoom:true,flickEnabled:true,flickMinSpeed:120,flickMomentum:0.25,pinchRotate:false},zoomPerClick:2,zoomPerScroll:1.8,zoomPerSecond:1,blendTime:0,alwaysBlend:false,autoHideControls:true,immediateRender:false,minZoomImageRatio:0.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,autoResize:true,preserveImageSizeOnResize:false,minScrollDeltaTime:50,showSequenceControl:true,sequenceControlAnchor:null,preserveViewport:false,preserveOverlays:false,navPrevNextWrap:false,showNavigationControl:true,navigationControlAnchor:null,showZoomControl:true,showHomeControl:true,showFullPageControl:true,showRotationControl:false,controlsFadeDelay:2000,controlsFadeLength:1500,mouseNavEnabled:true,showNavigator:false,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:0.2,navigatorMaintainSizeRatio:false,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:true,navigatorAutoFade:true,navigatorRotate:true,degrees:0,opacity:1,compositeOperation:null,placeholderFillStyle:null,showReferenceStrip:false,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:0.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:false,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:30000,useCanvas:true,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:false,debugGridColor:"#437AB2"},SIGNAL:"----seadragon----",delegate:function(object,method){return function(){var args=arguments;if(args===undefined){args=[]}return method.apply(object,args)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6},getElement:function(element){if(typeof(element)=="string"){element=document.getElementById(element)}return element},getElementPosition:function(element){var result=new $.Point(),isFixed,offsetParent;element=$.getElement(element);isFixed=$.getElementStyle(element).position=="fixed";offsetParent=getOffsetParent(element,isFixed);while(offsetParent){result.x+=element.offsetLeft;result.y+=element.offsetTop;if(isFixed){result=result.plus($.getPageScroll())}element=offsetParent;isFixed=$.getElementStyle(element).position=="fixed";offsetParent=getOffsetParent(element,isFixed)}return result},getElementOffset:function(element){element=$.getElement(element);var doc=element&&element.ownerDocument,docElement,win,boundingRect={top:0,left:0};if(!doc){return new $.Point()}docElement=doc.documentElement;if(typeof element.getBoundingClientRect!==typeof undefined){boundingRect=element.getBoundingClientRect()}win=(doc==doc.window)?doc:(doc.nodeType===9)?doc.defaultView||doc.parentWindow:false;return new $.Point(boundingRect.left+(win.pageXOffset||docElement.scrollLeft)-(docElement.clientLeft||0),boundingRect.top+(win.pageYOffset||docElement.scrollTop)-(docElement.clientTop||0))},getElementSize:function(element){element=$.getElement(element);return new $.Point(element.clientWidth,element.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(element){element=$.getElement(element);return element.currentStyle}:function(element){element=$.getElement(element);return window.getComputedStyle(element,"")},getCssPropertyWithVendorPrefix:function(property){var memo={};$.getCssPropertyWithVendorPrefix=function(property){if(memo[property]!==undefined){return memo[property]}var style=document.createElement("div").style;var result=null;if(style[property]!==undefined){result=property}else{var prefixes=["Webkit","Moz","MS","O","webkit","moz","ms","o"];var suffix=$.capitalizeFirstLetter(property);for(var i=0;i<prefixes.length;i++){var prop=prefixes[i]+suffix;if(style[prop]!==undefined){result=prop;break}}}memo[property]=result;return result};return $.getCssPropertyWithVendorPrefix(property)},capitalizeFirstLetter:function(string){return string.charAt(0).toUpperCase()+string.slice(1)},pointInElement:function(element,point){element=$.getElement(element);var offset=$.getElementOffset(element),size=$.getElementSize(element);return point.x>=offset.x&&point.x<offset.x+size.x&&point.y<offset.y+size.y&&point.y>=offset.y},getEvent:function(event){if(event){$.getEvent=function(event){return event}}else{$.getEvent=function(){return window.event}}return $.getEvent(event)},getMousePosition:function(event){if(typeof(event.pageX)=="number"){$.getMousePosition=function(event){var result=new $.Point();event=$.getEvent(event);result.x=event.pageX;result.y=event.pageY;return result}}else{if(typeof(event.clientX)=="number"){$.getMousePosition=function(event){var result=new $.Point();event=$.getEvent(event);result.x=event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;result.y=event.clientY+document.body.scrollTop+document.documentElement.scrollTop;return result}}else{throw new Error("Unknown event mouse position, no known technique.")}}return $.getMousePosition(event)},getPageScroll:function(){var docElement=document.documentElement||{},body=document.body||{};if(typeof(window.pageXOffset)=="number"){$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)}}else{if(body.scrollLeft||body.scrollTop){$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)}}else{if(docElement.scrollLeft||docElement.scrollTop){$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}else{return new $.Point(0,0)}}}return $.getPageScroll()},setPageScroll:function(scroll){if(typeof(window.scrollTo)!=="undefined"){$.setPageScroll=function(scroll){window.scrollTo(scroll.x,scroll.y)}}else{var originalScroll=$.getPageScroll();if(originalScroll.x===scroll.x&&originalScroll.y===scroll.y){return}document.body.scrollLeft=scroll.x;document.body.scrollTop=scroll.y;var currentScroll=$.getPageScroll();if(currentScroll.x!==originalScroll.x&&currentScroll.y!==originalScroll.y){$.setPageScroll=function(scroll){document.body.scrollLeft=scroll.x;document.body.scrollTop=scroll.y};return}document.documentElement.scrollLeft=scroll.x;document.documentElement.scrollTop=scroll.y;currentScroll=$.getPageScroll();if(currentScroll.x!==originalScroll.x&&currentScroll.y!==originalScroll.y){$.setPageScroll=function(scroll){document.documentElement.scrollLeft=scroll.x;document.documentElement.scrollTop=scroll.y};return}$.setPageScroll=function(scroll){}}return $.setPageScroll(scroll)},getWindowSize:function(){var docElement=document.documentElement||{},body=document.body||{};if(typeof(window.innerWidth)=="number"){$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)}}else{if(docElement.clientWidth||docElement.clientHeight){$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)}}else{if(body.clientWidth||body.clientHeight){$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}else{throw new Error("Unknown window size, no known technique.")}}}return $.getWindowSize()},makeCenteredNode:function(element){element=$.getElement(element);var wrappers=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];$.extend(wrappers[0].style,{display:"table",height:"100%",width:"100%"});$.extend(wrappers[1].style,{display:"table-row"});$.extend(wrappers[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"});wrappers[0].appendChild(wrappers[1]);wrappers[1].appendChild(wrappers[2]);wrappers[2].appendChild(element);return wrappers[0]},makeNeutralElement:function(tagName){var element=document.createElement(tagName),style=element.style;style.background="transparent none";style.border="none";style.margin="0px";style.padding="0px";style.position="static";return element},now:function(){if(Date.now){$.now=Date.now}else{$.now=function(){return new Date().getTime()}}return $.now()},makeTransparentImage:function(src){$.makeTransparentImage=function(src){var img=$.makeNeutralElement("img");img.src=src;return img};if($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7){$.makeTransparentImage=function(src){var img=$.makeNeutralElement("img"),element=null;element=$.makeNeutralElement("span");element.style.display="inline-block";img.onload=function(){element.style.width=element.style.width||img.width+"px";element.style.height=element.style.height||img.height+"px";img.onload=null;img=null};img.src=src;element.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+src+"', sizingMethod='scale')";return element}}return $.makeTransparentImage(src)},setElementOpacity:function(element,opacity,usesAlpha){var ieOpacity,ieFilter;element=$.getElement(element);if(usesAlpha&&!$.Browser.alpha){opacity=Math.round(opacity)}if($.Browser.opacity){element.style.opacity=opacity<1?opacity:""}else{if(opacity<1){ieOpacity=Math.round(100*opacity);ieFilter="alpha(opacity="+ieOpacity+")";element.style.filter=ieFilter}else{element.style.filter=""}}},setElementTouchActionNone:function(element){element=$.getElement(element);if(typeof element.style.touchAction!=="undefined"){element.style.touchAction="none"}else{if(typeof element.style.msTouchAction!=="undefined"){element.style.msTouchAction="none"}}},addClass:function(element,className){element=$.getElement(element);if(!element.className){element.className=className}else{if((" "+element.className+" ").indexOf(" "+className+" ")===-1){element.className+=" "+className}}},indexOf:function(array,searchElement,fromIndex){if(Array.prototype.indexOf){this.indexOf=function(array,searchElement,fromIndex){return array.indexOf(searchElement,fromIndex)}}else{this.indexOf=function(array,searchElement,fromIndex){var i,pivot=(fromIndex)?fromIndex:0,length;if(!array){throw new TypeError()}length=array.length;if(length===0||pivot>=length){return -1}if(pivot<0){pivot=length-Math.abs(pivot)}for(i=pivot;i<length;i++){if(array[i]===searchElement){return i}}return -1}}return this.indexOf(array,searchElement,fromIndex)},removeClass:function(element,className){var oldClasses,newClasses=[],i;element=$.getElement(element);oldClasses=element.className.split(/\s+/);for(i=0;i<oldClasses.length;i++){if(oldClasses[i]&&oldClasses[i]!==className){newClasses.push(oldClasses[i])}}element.className=newClasses.join(" ")},addEvent:(function(){if(window.addEventListener){return function(element,eventName,handler,useCapture){element=$.getElement(element);element.addEventListener(eventName,handler,useCapture)}}else{if(window.attachEvent){return function(element,eventName,handler,useCapture){element=$.getElement(element);element.attachEvent("on"+eventName,handler)}}else{throw new Error("No known event model.")}}}()),removeEvent:(function(){if(window.removeEventListener){return function(element,eventName,handler,useCapture){element=$.getElement(element);element.removeEventListener(eventName,handler,useCapture)}}else{if(window.detachEvent){return function(element,eventName,handler,useCapture){element=$.getElement(element);element.detachEvent("on"+eventName,handler)}}else{throw new Error("No known event model.")}}}()),cancelEvent:function(event){event=$.getEvent(event);if(event.preventDefault){$.cancelEvent=function(event){event.preventDefault()}}else{$.cancelEvent=function(event){event=$.getEvent(event);event.cancel=true;event.returnValue=false}}$.cancelEvent(event)},stopEvent:function(event){event=$.getEvent(event);if(event.stopPropagation){$.stopEvent=function(event){event.stopPropagation()}}else{$.stopEvent=function(event){event=$.getEvent(event);event.cancelBubble=true}}$.stopEvent(event)},createCallback:function(object,method){var initialArgs=[],i;for(i=2;i<arguments.length;i++){initialArgs.push(arguments[i])}return function(){var args=initialArgs.concat([]),i;for(i=0;i<arguments.length;i++){args.push(arguments[i])}return method.apply(object,args)}},getUrlParameter:function(key){var value=URLPARAMS[key];return value?value:null},getUrlProtocol:function(url){var match=url.match(/^([a-z]+:)\/\//i);if(match===null){return window.location.protocol}return match[1].toLowerCase()},createAjaxRequest:function(local){var supportActiveX;try{supportActiveX=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(e){supportActiveX=false}if(supportActiveX){if(window.XMLHttpRequest){$.createAjaxRequest=function(local){if(local){return new ActiveXObject("Microsoft.XMLHTTP")}return new XMLHttpRequest()}}else{$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}}else{if(window.XMLHttpRequest){$.createAjaxRequest=function(){return new XMLHttpRequest()}}else{throw new Error("Browser doesn't support XMLHttpRequest.")}}return $.createAjaxRequest(local)},makeAjaxRequest:function(url,onSuccess,onError){var withCredentials;if($.isPlainObject(url)){onSuccess=url.success;onError=url.error;withCredentials=url.withCredentials;url=url.url}var protocol=$.getUrlProtocol(url);var request=$.createAjaxRequest(protocol==="file:");if(!$.isFunction(onSuccess)){throw new Error("makeAjaxRequest requires a success callback")}request.onreadystatechange=function(){if(request.readyState==4){request.onreadystatechange=function(){};if(request.status===200||(request.status===0&&protocol!=="http:"&&protocol!=="https:")){onSuccess(request)}else{$.console.log("AJAX request returned %d: %s",request.status,url);if($.isFunction(onError)){onError(request)}}}};if(withCredentials){request.withCredentials=true}try{request.open("GET",url,true);request.send(null)}catch(e){var msg=e.message;var oldIE=$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10;if(oldIE&&typeof(e.number)!="undefined"&&e.number==-2147024891){msg+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"}$.console.log("%s while making AJAX request: %s",e.name,msg);request.onreadystatechange=function(){};if(window.XDomainRequest){var xdr=new XDomainRequest();if(xdr){xdr.onload=function(e){if($.isFunction(onSuccess)){onSuccess({responseText:xdr.responseText,status:200,statusText:"OK"})}};xdr.onerror=function(e){if($.isFunction(onError)){onError({responseText:xdr.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})}};try{xdr.open("GET",url);xdr.send()}catch(e2){if($.isFunction(onError)){onError(request,e)}}}}else{if($.isFunction(onError)){onError(request,e)}}}},jsonp:function(options){var script,url=options.url,head=document.head||document.getElementsByTagName("head")[0]||document.documentElement,jsonpCallback=options.callbackName||"openseadragon"+$.now(),previous=window[jsonpCallback],replace="$1"+jsonpCallback+"$2",callbackParam=options.param||"callback",callback=options.callback;url=url.replace(/(\=)\?(&|$)|\?\?/i,replace);url+=(/\?/.test(url)?"&":"?")+callbackParam+"="+jsonpCallback;window[jsonpCallback]=function(response){if(!previous){try{delete window[jsonpCallback]}catch(e){}}else{window[jsonpCallback]=previous}if(callback&&$.isFunction(callback)){callback(response)}};script=document.createElement("script");if(undefined!==options.async||false!==options.async){script.async="async"}if(options.scriptCharset){script.charset=options.scriptCharset}script.src=url;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(head&&script.parentNode){head.removeChild(script)}script=undefined}};head.insertBefore(script,head.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(string){if(window.DOMParser){$.parseXml=function(string){var xmlDoc=null,parser;parser=new DOMParser();xmlDoc=parser.parseFromString(string,"text/xml");return xmlDoc}}else{if(window.ActiveXObject){$.parseXml=function(string){var xmlDoc=null;xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async=false;xmlDoc.loadXML(string);return xmlDoc}}else{throw new Error("Browser doesn't support XML DOM.")}}return $.parseXml(string)},parseJSON:function(string){if(window.JSON&&window.JSON.parse){$.parseJSON=window.JSON.parse}else{$.parseJSON=function(string){return eval("("+string+")")}}return $.parseJSON(string)},imageFormatSupported:function(extension){extension=extension?extension:"";return !!FILEFORMATS[extension.toLowerCase()]}});$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:true};var FILEFORMATS={bmp:false,jpeg:true,jpg:true,png:true,tif:false,wdp:false},URLPARAMS={};(function(){var app=navigator.appName,ver=navigator.appVersion,ua=navigator.userAgent,regex;switch(navigator.appName){case"Microsoft Internet Explorer":if(!!window.attachEvent&&!!window.ActiveXObject){$.Browser.vendor=$.BROWSERS.IE;$.Browser.version=parseFloat(ua.substring(ua.indexOf("MSIE")+5,ua.indexOf(";",ua.indexOf("MSIE"))))}break;case"Netscape":if(!!window.addEventListener){if(ua.indexOf("Firefox")>=0){$.Browser.vendor=$.BROWSERS.FIREFOX;$.Browser.version=parseFloat(ua.substring(ua.indexOf("Firefox")+8))}else{if(ua.indexOf("Edge")>=0){$.Browser.vendor=$.BROWSERS.EDGE;var vNo=ua.match(/\bOPR|Edge\/(\d+)/);if(vNo!==null&&vNo.length>1){$.Browser.version=vNo}}else{if(ua.indexOf("Safari")>=0){$.Browser.vendor=ua.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI;$.Browser.version=parseFloat(ua.substring(ua.substring(0,ua.indexOf("Safari")).lastIndexOf("/")+1,ua.indexOf("Safari")))}else{regex=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");if(regex.exec(ua)!==null){$.Browser.vendor=$.BROWSERS.IE;$.Browser.version=parseFloat(RegExp.$1)}}}}}break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA;$.Browser.version=parseFloat(ver);break}var query=window.location.search.substring(1),parts=query.split("&"),part,sep,i;for(i=0;i<parts.length;i++){part=parts[i];sep=part.indexOf("=");if(sep>0){URLPARAMS[part.substring(0,sep)]=decodeURIComponent(part.substring(sep+1))}}$.Browser.alpha=!(($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)||($.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2));$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)})();var nullfunction=function(msg){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction};(function(w){var requestAnimationFrame=w.requestAnimationFrame||w.mozRequestAnimationFrame||w.webkitRequestAnimationFrame||w.msRequestAnimationFrame;var cancelAnimationFrame=w.cancelAnimationFrame||w.mozCancelAnimationFrame||w.webkitCancelAnimationFrame||w.msCancelAnimationFrame;if(requestAnimationFrame&&cancelAnimationFrame){$.requestAnimationFrame=function(){return requestAnimationFrame.apply(w,arguments)};$.cancelAnimationFrame=function(){return cancelAnimationFrame.apply(w,arguments)}}else{var aAnimQueue=[],processing=[],iRequestId=0,iIntervalId;$.requestAnimationFrame=function(callback){aAnimQueue.push([++iRequestId,callback]);if(!iIntervalId){iIntervalId=setInterval(function(){if(aAnimQueue.length){var time=$.now();var temp=processing;processing=aAnimQueue;aAnimQueue=temp;while(processing.length){processing.shift()[1](time)}}else{clearInterval(iIntervalId);iIntervalId=undefined}},1000/50)}return iRequestId};$.cancelAnimationFrame=function(requestId){var i,j;for(i=0,j=aAnimQueue.length;i<j;i+=1){if(aAnimQueue[i][0]===requestId){aAnimQueue.splice(i,1);return}}for(i=0,j=processing.length;i<j;i+=1){if(processing[i][0]===requestId){processing.splice(i,1);return}}}}})(window);function getOffsetParent(element,isFixed){if(isFixed&&element!=document.body){return document.body}else{return element.offsetParent}}}(OpenSeadragon));(function(a){var b={supportsFullScreen:false,isFullScreen:function(){return false},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};if(document.exitFullscreen){b.supportsFullScreen=true;b.getFullScreenElement=function(){return document.fullscreenElement};b.requestFullScreen=function(c){return c.requestFullscreen()};b.exitFullScreen=function(){document.exitFullscreen()};b.fullScreenEventName="fullscreenchange";b.fullScreenErrorEventName="fullscreenerror"}else{if(document.msExitFullscreen){b.supportsFullScreen=true;b.getFullScreenElement=function(){return document.msFullscreenElement};b.requestFullScreen=function(c){return c.msRequestFullscreen()};b.exitFullScreen=function(){document.msExitFullscreen()};b.fullScreenEventName="MSFullscreenChange";b.fullScreenErrorEventName="MSFullscreenError"}else{if(document.webkitExitFullscreen){b.supportsFullScreen=true;b.getFullScreenElement=function(){return document.webkitFullscreenElement};b.requestFullScreen=function(c){return c.webkitRequestFullscreen()};b.exitFullScreen=function(){document.webkitExitFullscreen()};b.fullScreenEventName="webkitfullscreenchange";b.fullScreenErrorEventName="webkitfullscreenerror"}else{if(document.webkitCancelFullScreen){b.supportsFullScreen=true;b.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement};b.requestFullScreen=function(c){return c.webkitRequestFullScreen()};b.exitFullScreen=function(){document.webkitCancelFullScreen()};b.fullScreenEventName="webkitfullscreenchange";b.fullScreenErrorEventName="webkitfullscreenerror"}else{if(document.mozCancelFullScreen){b.supportsFullScreen=true;b.getFullScreenElement=function(){return document.mozFullScreenElement};b.requestFullScreen=function(c){return c.mozRequestFullScreen()};b.exitFullScreen=function(){document.mozCancelFullScreen()};b.fullScreenEventName="mozfullscreenchange";b.fullScreenErrorEventName="mozfullscreenerror"}}}}}b.isFullScreen=function(){return b.getFullScreenElement()!==null};b.cancelFullScreen=function(){a.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead.");b.exitFullScreen()};a.extend(a,b)})(OpenSeadragon);(function(a){a.EventSource=function(){this.events={}};a.EventSource.prototype={addOnceHandler:function(d,f,b,h){var c=this;h=h||1;var g=0;var e=function(i){g++;if(g===h){c.removeHandler(d,e)}f(i)};this.addHandler(d,e,b)},addHandler:function(c,e,b){var d=this.events[c];if(!d){this.events[c]=d=[]}if(e&&a.isFunction(e)){d[d.length]={handler:e,userData:b||null}}},removeHandler:function(c,f){var e=this.events[c],b=[],d;if(!e){return}if(a.isArray(e)){for(d=0;d<e.length;d++){if(e[d].handler!==f){b.push(e[d])}}this.events[c]=b}},removeAllHandlers:function(b){if(b){this.events[b]=[]}else{for(var c in this.events){this.events[c]=[]}}},getHandler:function(b){var c=this.events[b];if(!c||!c.length){return null}c=c.length===1?[c[0]]:Array.apply(null,c);return function(g,d){var e,f=c.length;for(e=0;e<f;e++){if(c[e]){d.eventSource=g;d.userData=c[e].userData;c[e].handler(d)}}}},raiseEvent:function(c,b){var d=this.getHandler(c);if(d){if(!b){b={}}d(this,b)}}}}(OpenSeadragon));(function(R){var B=[];var E={};R.MouseTracker=function(av){B.push(this);var au=arguments;if(!R.isPlainObject(av)){av={element:au[0],clickTimeThreshold:au[1],clickDistThreshold:au[2]}}this.hash=Math.random();this.element=R.getElement(av.element);this.clickTimeThreshold=av.clickTimeThreshold||R.DEFAULT_SETTINGS.clickTimeThreshold;this.clickDistThreshold=av.clickDistThreshold||R.DEFAULT_SETTINGS.clickDistThreshold;this.dblClickTimeThreshold=av.dblClickTimeThreshold||R.DEFAULT_SETTINGS.dblClickTimeThreshold;this.dblClickDistThreshold=av.dblClickDistThreshold||R.DEFAULT_SETTINGS.dblClickDistThreshold;this.userData=av.userData||null;this.stopDelay=av.stopDelay||50;this.enterHandler=av.enterHandler||null;this.exitHandler=av.exitHandler||null;this.pressHandler=av.pressHandler||null;this.nonPrimaryPressHandler=av.nonPrimaryPressHandler||null;this.releaseHandler=av.releaseHandler||null;this.nonPrimaryReleaseHandler=av.nonPrimaryReleaseHandler||null;this.moveHandler=av.moveHandler||null;this.scrollHandler=av.scrollHandler||null;this.clickHandler=av.clickHandler||null;this.dblClickHandler=av.dblClickHandler||null;this.dragHandler=av.dragHandler||null;this.dragEndHandler=av.dragEndHandler||null;this.pinchHandler=av.pinchHandler||null;this.stopHandler=av.stopHandler||null;this.keyDownHandler=av.keyDownHandler||null;this.keyUpHandler=av.keyUpHandler||null;this.keyHandler=av.keyHandler||null;this.focusHandler=av.focusHandler||null;this.blurHandler=av.blurHandler||null;var aw=this;E[this.hash]={click:function(ax){F(aw,ax)},dblclick:function(ax){T(aw,ax)},keydown:function(ax){n(aw,ax)},keyup:function(ax){e(aw,ax)},keypress:function(ax){ar(aw,ax)},focus:function(ax){Q(aw,ax)},blur:function(ax){x(aw,ax)},wheel:function(ax){j(aw,ax)},mousewheel:function(ax){ad(aw,ax)},DOMMouseScroll:function(ax){ad(aw,ax)},MozMousePixelScroll:function(ax){ad(aw,ax)},mouseenter:function(ax){y(aw,ax)},mouseleave:function(ax){N(aw,ax)},mouseover:function(ax){A(aw,ax)},mouseout:function(ax){c(aw,ax)},mousedown:function(ax){ak(aw,ax)},mouseup:function(ax){at(aw,ax)},mouseupcaptured:function(ax){g(aw,ax)},mousemove:function(ax){a(aw,ax)},mousemovecaptured:function(ax){Y(aw,ax)},touchendcaptured:function(ax){S(aw,ax)},touchmovecaptured:function(ax){W(aw,ax)},touchcancel:function(ax){s(aw,ax)},gesturestart:function(ax){M(aw,ax)},gesturechange:function(ax){l(aw,ax)},pointerover:function(ax){o(aw,ax)},MSPointerOver:function(ax){o(aw,ax)},pointerout:function(ax){aa(aw,ax)},MSPointerOut:function(ax){aa(aw,ax)},pointerdown:function(ax){X(aw,ax)},MSPointerDown:function(ax){X(aw,ax)},pointerup:function(ax){Z(aw,ax)},MSPointerUp:function(ax){Z(aw,ax)},pointermove:function(ax){ab(aw,ax)},MSPointerMove:function(ax){ab(aw,ax)},pointercancel:function(ax){aq(aw,ax)},MSPointerCancel:function(ax){aq(aw,ax)},pointerupcaptured:function(ax){V(aw,ax)},pointermovecaptured:function(ax){K(aw,ax)},tracking:false,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null};if(!av.startDisabled){this.setTracking(true)}};R.MouseTracker.prototype={destroy:function(){var au;b(this);this.element=null;for(au=0;au<B.length;au++){if(B[au]===this){B.splice(au,1);break}}E[this.hash]=null;delete E[this.hash]},isTracking:function(){return E[this.hash].tracking},setTracking:function(au){if(au){m(this)}else{b(this)}return this},getActivePointersListByType:function(ax){var aw=E[this.hash],av,au=aw.activePointersLists.length,ay;for(av=0;av<au;av++){if(aw.activePointersLists[av].type===ax){return aw.activePointersLists[av]}}ay=new R.MouseTracker.GesturePointList(ax);aw.activePointersLists.push(ay);return ay},getActivePointerCount:function(){var aw=E[this.hash],av,au=aw.activePointersLists.length,ax=0;for(av=0;av<au;av++){ax+=aw.activePointersLists[av].getLength()}return ax},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};R.MouseTracker.gesturePointVelocityTracker=(function(){var az=[],ax=0,ay=0;var aA=function(aC,aB){return aC.hash.toString()+aB.type+aB.id.toString()};var aw=function(){var aF,aB=az.length,aH,aE,aD=R.now(),aC,aI,aG;aC=aD-ay;ay=aD;for(aF=0;aF<aB;aF++){aH=az[aF];aE=aH.gPoint;aE.direction=Math.atan2(aE.currentPos.y-aH.lastPos.y,aE.currentPos.x-aH.lastPos.x);aI=aH.lastPos.distanceTo(aE.currentPos);aH.lastPos=aE.currentPos;aG=1000*aI/(aC+1);aE.speed=0.75*aG+0.25*aE.speed}};var au=function(aD,aC){var aB=aA(aD,aC);az.push({guid:aB,gPoint:aC,lastPos:aC.currentPos});if(az.length===1){ay=R.now();ax=window.setInterval(aw,50)}};var av=function(aF,aE){var aC=aA(aF,aE),aD,aB=az.length;for(aD=0;aD<aB;aD++){if(az[aD].guid===aC){az.splice(aD,1);aB--;if(aB===0){window.clearInterval(ax)}break}}};return{addPoint:au,removePoint:av}})();R.MouseTracker.captureElement=document;R.MouseTracker.wheelEventName=(R.Browser.vendor==R.BROWSERS.IE&&R.Browser.version>8)||("onwheel" in document.createElement("div"))?"wheel":document.onmousewheel!==undefined?"mousewheel":"DOMMouseScroll";R.MouseTracker.supportsMouseCapture=(function(){var au=document.createElement("div");return R.isFunction(au.setCapture)&&R.isFunction(au.releaseCapture)}());R.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",R.MouseTracker.wheelEventName];if(R.MouseTracker.wheelEventName=="DOMMouseScroll"){R.MouseTracker.subscribeEvents.push("MozMousePixelScroll")}if(window.PointerEvent&&(window.navigator.pointerEnabled||R.Browser.vendor!==R.BROWSERS.IE)){R.MouseTracker.havePointerEvents=true;R.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel");R.MouseTracker.unprefixedPointerEvents=true;if(navigator.maxTouchPoints){R.MouseTracker.maxTouchPoints=navigator.maxTouchPoints}else{R.MouseTracker.maxTouchPoints=0}R.MouseTracker.haveMouseEnter=false}else{if(window.MSPointerEvent&&window.navigator.msPointerEnabled){R.MouseTracker.havePointerEvents=true;R.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel");R.MouseTracker.unprefixedPointerEvents=false;if(navigator.msMaxTouchPoints){R.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints}else{R.MouseTracker.maxTouchPoints=0}R.MouseTracker.haveMouseEnter=false}else{R.MouseTracker.havePointerEvents=false;if(R.Browser.vendor===R.BROWSERS.IE&&R.Browser.version<9){R.MouseTracker.subscribeEvents.push("mouseenter","mouseleave");R.MouseTracker.haveMouseEnter=true}else{R.MouseTracker.subscribeEvents.push("mouseover","mouseout");R.MouseTracker.haveMouseEnter=false}R.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove");if("ontouchstart" in window){R.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel")}if("ongesturestart" in window){R.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")}R.MouseTracker.mousePointerId="legacy-mouse";R.MouseTracker.maxTouchPoints=10}}R.MouseTracker.GesturePointList=function(au){this._gPoints=[];this.type=au;this.buttons=0;this.contacts=0;this.clicks=0;this.captureCount=0};R.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(au){return this._gPoints.push(au)},removeById:function(aw){var av,au=this._gPoints.length;for(av=0;av<au;av++){if(this._gPoints[av].id===aw){this._gPoints.splice(av,1);break}}return this._gPoints.length},getByIndex:function(au){if(au<this._gPoints.length){return this._gPoints[au]}return null},getById:function(aw){var av,au=this._gPoints.length;for(av=0;av<au;av++){if(this._gPoints[av].id===aw){return this._gPoints[av]}}return null},getPrimary:function(aw){var av,au=this._gPoints.length;for(av=0;av<au;av++){if(this._gPoints[av].isPrimary){return this._gPoints[av]}}return null}};function af(aw){var av=E[aw.hash],au,ax=av.activePointersLists.length;for(au=0;au<ax;au++){if(av.activePointersLists[au].captureCount>0){R.removeEvent(R.MouseTracker.captureElement,"mousemove",av.mousemovecaptured,true);R.removeEvent(R.MouseTracker.captureElement,"mouseup",av.mouseupcaptured,true);R.removeEvent(R.MouseTracker.captureElement,R.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",av.pointermovecaptured,true);R.removeEvent(R.MouseTracker.captureElement,R.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",av.pointerupcaptured,true);R.removeEvent(R.MouseTracker.captureElement,"touchmove",av.touchmovecaptured,true);R.removeEvent(R.MouseTracker.captureElement,"touchend",av.touchendcaptured,true);av.activePointersLists[au].captureCount=0}}for(au=0;au<ax;au++){av.activePointersLists.pop()}}function m(ax){var av=E[ax.hash],aw,au;if(!av.tracking){for(au=0;au<R.MouseTracker.subscribeEvents.length;au++){aw=R.MouseTracker.subscribeEvents[au];R.addEvent(ax.element,aw,av[aw],false)}af(ax);av.tracking=true}}function b(ax){var av=E[ax.hash],aw,au;if(av.tracking){for(au=0;au<R.MouseTracker.subscribeEvents.length;au++){aw=R.MouseTracker.subscribeEvents[au];R.removeEvent(ax.element,aw,av[aw],false)}af(ax);av.tracking=false}}function L(aw,au){var av=E[aw.hash];if(au==="pointerevent"){return{upName:R.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:av.pointerupcaptured,moveName:R.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:av.pointermovecaptured}}else{if(au==="mouse"){return{upName:"mouseup",upHandler:av.mouseupcaptured,moveName:"mousemove",moveHandler:av.mousemovecaptured}}else{if(au==="touch"){return{upName:"touchend",upHandler:av.touchendcaptured,moveName:"touchmove",moveHandler:av.touchmovecaptured}}else{throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}}}}function t(aw,au,av){var ay=aw.getActivePointersListByType(au),ax;ay.captureCount+=(av||1);if(ay.captureCount===1){if(R.Browser.vendor===R.BROWSERS.IE&&R.Browser.version<9){aw.element.setCapture(true)}else{ax=L(aw,R.MouseTracker.havePointerEvents?"pointerevent":au);if(G&&J(window.top)){R.addEvent(window.top,ax.upName,ax.upHandler,true)}R.addEvent(R.MouseTracker.captureElement,ax.upName,ax.upHandler,true);R.addEvent(R.MouseTracker.captureElement,ax.moveName,ax.moveHandler,true)}}}function P(aw,au,av){var ay=aw.getActivePointersListByType(au),ax;ay.captureCount-=(av||1);if(ay.captureCount===0){if(R.Browser.vendor===R.BROWSERS.IE&&R.Browser.version<9){aw.element.releaseCapture()}else{ax=L(aw,R.MouseTracker.havePointerEvents?"pointerevent":au);if(G&&J(window.top)){R.removeEvent(window.top,ax.upName,ax.upHandler,true)}R.removeEvent(R.MouseTracker.captureElement,ax.moveName,ax.moveHandler,true);R.removeEvent(R.MouseTracker.captureElement,ax.upName,ax.upHandler,true)}}}function ag(av){var au;if(R.MouseTracker.unprefixedPointerEvents){au=av.pointerType}else{switch(av.pointerType){case 2:au="touch";break;case 3:au="pen";break;case 4:au="mouse";break;default:au=""}}return au}function v(au){return R.getMousePosition(au)}function aj(av,au){return C(v(av),au)}function C(au,av){var aw=R.getElementOffset(av);return au.minus(aw)}function f(av,au){return new R.Point((av.x+au.x)/2,(av.y+au.y)/2)}function F(av,au){if(av.clickHandler){R.cancelEvent(au)}}function T(av,au){if(av.dblClickHandler){R.cancelEvent(au)}}function n(aw,av){var au;if(aw.keyDownHandler){av=R.getEvent(av);au=aw.keyDownHandler({eventSource:aw,keyCode:av.keyCode?av.keyCode:av.charCode,ctrl:av.ctrlKey,shift:av.shiftKey,alt:av.altKey,meta:av.metaKey,originalEvent:av,preventDefaultAction:false,userData:aw.userData});if(!au){R.cancelEvent(av)}}}function e(aw,av){var au;if(aw.keyUpHandler){av=R.getEvent(av);au=aw.keyUpHandler({eventSource:aw,keyCode:av.keyCode?av.keyCode:av.charCode,ctrl:av.ctrlKey,shift:av.shiftKey,alt:av.altKey,meta:av.metaKey,originalEvent:av,preventDefaultAction:false,userData:aw.userData});if(!au){R.cancelEvent(av)}}}function ar(aw,av){var au;if(aw.keyHandler){av=R.getEvent(av);au=aw.keyHandler({eventSource:aw,keyCode:av.keyCode?av.keyCode:av.charCode,ctrl:av.ctrlKey,shift:av.shiftKey,alt:av.altKey,meta:av.metaKey,originalEvent:av,preventDefaultAction:false,userData:aw.userData});if(!au){R.cancelEvent(av)}}}function Q(aw,av){var au;if(aw.focusHandler){av=R.getEvent(av);au=aw.focusHandler({eventSource:aw,originalEvent:av,preventDefaultAction:false,userData:aw.userData});if(au===false){R.cancelEvent(av)}}}function x(aw,av){var au;if(aw.blurHandler){av=R.getEvent(av);au=aw.blurHandler({eventSource:aw,originalEvent:av,preventDefaultAction:false,userData:aw.userData});if(au===false){R.cancelEvent(av)}}}function j(av,au){al(av,au,au)}function ad(aw,av){av=R.getEvent(av);var au={target:av.target||av.srcElement,type:"wheel",shiftKey:av.shiftKey||false,clientX:av.clientX,clientY:av.clientY,pageX:av.pageX?av.pageX:av.clientX,pageY:av.pageY?av.pageY:av.clientY,deltaMode:av.type=="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};if(R.MouseTracker.wheelEventName=="mousewheel"){au.deltaY=-1/R.DEFAULT_SETTINGS.pixelsPerWheelLine*av.wheelDelta}else{au.deltaY=av.detail}al(aw,au,av)}function al(ax,aw,av){var ay=0,au;ay=aw.deltaY<0?1:-1;if(ax.scrollHandler){au=ax.scrollHandler({eventSource:ax,pointerType:"mouse",position:aj(aw,ax.element),scroll:ay,shift:aw.shiftKey,isTouchEvent:false,originalEvent:av,preventDefaultAction:false,userData:ax.userData});if(au===false){R.cancelEvent(av)}}}function i(au,av){if(au===av){return false}while(av&&av!==au){av=av.parentNode}return av===au}function y(av,au){au=R.getEvent(au);z(av,au)}function A(av,au){au=R.getEvent(au);if(au.currentTarget===au.relatedTarget||i(au.currentTarget,au.relatedTarget)){return}z(av,au)}function z(aw,av){var au={id:R.MouseTracker.mousePointerId,type:"mouse",isPrimary:true,currentPos:v(av),currentTime:R.now()};D(aw,av,[au])}function N(av,au){au=R.getEvent(au);an(av,au)}function c(av,au){au=R.getEvent(au);if(au.currentTarget===au.relatedTarget||i(au.currentTarget,au.relatedTarget)){return}an(av,au)}function an(aw,av){var au={id:R.MouseTracker.mousePointerId,type:"mouse",isPrimary:true,currentPos:v(av),currentTime:R.now()};q(aw,av,[au])}function I(au){if(R.Browser.vendor===R.BROWSERS.IE&&R.Browser.version<9){if(au===1){return 0}else{if(au===2){return 2}else{if(au===4){return 1}else{return -1}}}}else{return au}}function ak(aw,av){var au;av=R.getEvent(av);au={id:R.MouseTracker.mousePointerId,type:"mouse",isPrimary:true,currentPos:v(av),currentTime:R.now()};if(w(aw,av,[au],I(av.button))){R.stopEvent(av);t(aw,"mouse")}if(aw.clickHandler||aw.dblClickHandler||aw.pressHandler||aw.dragHandler||aw.dragEndHandler){R.cancelEvent(av)}}function at(av,au){ap(av,au)}function g(av,au){ap(av,au);R.stopEvent(au)}function ap(aw,av){var au;av=R.getEvent(av);au={id:R.MouseTracker.mousePointerId,type:"mouse",isPrimary:true,currentPos:v(av),currentTime:R.now()};if(U(aw,av,[au],I(av.button))){P(aw,"mouse")}}function a(av,au){k(av,au)}function Y(av,au){k(av,au);R.stopEvent(au)}function k(aw,av){var au;av=R.getEvent(av);au={id:R.MouseTracker.mousePointerId,type:"mouse",isPrimary:true,currentPos:v(av),currentTime:R.now()};H(aw,av,[au])}function p(aw,av,az){var au,ax=az.getLength(),ay=[];for(au=0;au<ax;au++){ay.push(az.getByIndex(au))}if(ay.length>0){U(aw,av,ay,0);az.captureCount=1;P(aw,"touch");q(aw,av,ay)}}function ai(aB,au){var av,az,ay,aA=au.changedTouches.length,aC=[],aw,ax=aB.getActivePointersListByType("touch");av=R.now();if(ax.getLength()>au.touches.length-aA){R.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers.");p(aB,au,ax)}for(az=0;az<aA;az++){aC.push({id:au.changedTouches[az].identifier,type:"touch",currentPos:v(au.changedTouches[az]),currentTime:av})}D(aB,au,aC);for(az=0;az<B.length;az++){if(B[az]!==aB&&B[az].isTracking()&&i(B[az].element,aB.element)){aw=[];for(ay=0;ay<aA;ay++){aw.push({id:au.changedTouches[ay].identifier,type:"touch",currentPos:v(au.changedTouches[ay]),currentTime:av})}D(B[az],au,aw)}}if(w(aB,au,aC,0)){R.stopEvent(au);t(aB,"touch",aA)}R.cancelEvent(au)}function ac(av,au){h(av,au)}function S(av,au){h(av,au);R.stopEvent(au)}function h(az,ay){var aB,aw,av,au=ay.changedTouches.length,aA=[],ax;aB=R.now();for(aw=0;aw<au;aw++){aA.push({id:ay.changedTouches[aw].identifier,type:"touch",currentPos:v(ay.changedTouches[aw]),currentTime:aB})}if(U(az,ay,aA,0)){P(az,"touch",au)}q(az,ay,aA);for(aw=0;aw<B.length;aw++){if(B[aw]!==az&&B[aw].isTracking()&&i(B[aw].element,az.element)){ax=[];for(av=0;av<au;av++){ax.push({id:ay.changedTouches[av].identifier,type:"touch",currentPos:v(ay.changedTouches[av]),currentTime:aB})}q(B[aw],ay,ax)}}R.cancelEvent(ay)}function am(av,au){d(av,au)}function W(av,au){d(av,au);R.stopEvent(au)}function d(ax,aw){var av,au=aw.changedTouches.length,ay=[];for(av=0;av<au;av++){ay.push({id:aw.changedTouches[av].identifier,type:"touch",currentPos:v(aw.changedTouches[av]),currentTime:R.now()})}H(ax,aw,ay);R.cancelEvent(aw)}function s(ax,aw){var av,au=aw.changedTouches.length,ay=[],az=ax.getActivePointersListByType("touch");p(ax,aw,az)}function M(av,au){au.stopPropagation();au.preventDefault();return false}function l(av,au){au.stopPropagation();au.preventDefault();return false}function o(aw,av){var au;if(av.currentTarget===av.relatedTarget||i(av.currentTarget,av.relatedTarget)){return}au={id:av.pointerId,type:ag(av),isPrimary:av.isPrimary,currentPos:v(av),currentTime:R.now()};D(aw,av,[au])}function aa(aw,av){var au;if(av.currentTarget===av.relatedTarget||i(av.currentTarget,av.relatedTarget)){return}au={id:av.pointerId,type:ag(av),isPrimary:av.isPrimary,currentPos:v(av),currentTime:R.now()};q(aw,av,[au])}function X(aw,av){var au;au={id:av.pointerId,type:ag(av),isPrimary:av.isPrimary,currentPos:v(av),currentTime:R.now()};if(w(aw,av,[au],av.button)){R.stopEvent(av);t(aw,au.type)}if(aw.clickHandler||aw.dblClickHandler||aw.pressHandler||aw.dragHandler||aw.dragEndHandler||aw.pinchHandler){R.cancelEvent(av)}}function Z(av,au){ah(av,au)}function V(av,au){var aw=av.getActivePointersListByType(ag(au));if(aw.getById(au.pointerId)){ah(av,au)}R.stopEvent(au)}function ah(aw,av){var au;au={id:av.pointerId,type:ag(av),isPrimary:av.isPrimary,currentPos:v(av),currentTime:R.now()};if(U(aw,av,[au],av.button)){P(aw,au.type)}}function ab(av,au){r(av,au)}function K(av,au){var aw=av.getActivePointersListByType(ag(au));if(aw.getById(au.pointerId)){r(av,au)}R.stopEvent(au)}function r(aw,av){var au;au={id:av.pointerId,type:ag(av),isPrimary:av.isPrimary,currentPos:v(av),currentTime:R.now()};H(aw,av,[au])}function aq(aw,av){var au;au={id:av.pointerId,type:ag(av)};ae(aw,av,[au])}function O(av,au){if(!au.hasOwnProperty("isPrimary")){if(av.getLength()===0){au.isPrimary=true}else{au.isPrimary=false}}au.speed=0;au.direction=0;au.contactPos=au.currentPos;au.contactTime=au.currentTime;au.lastPos=au.currentPos;au.lastTime=au.currentTime;return av.add(au)}function ao(ax,av){var aw,au;if(ax.getById(av.id)){aw=ax.removeById(av.id);if(!av.hasOwnProperty("isPrimary")){au=ax.getPrimary();if(!au){au=ax.getByIndex(0);if(au){au.isPrimary=true}}}}else{aw=ax.getLength()}return aw}function D(aA,au,aB){var av=aA.getActivePointersListByType(aB[0].type),aw,az=aB.length,aC,ay,ax;for(aw=0;aw<az;aw++){aC=aB[aw];ay=av.getById(aC.id);if(ay){ay.insideElement=true;ay.lastPos=ay.currentPos;ay.lastTime=ay.currentTime;ay.currentPos=aC.currentPos;ay.currentTime=aC.currentTime;aC=ay}else{aC.captured=false;aC.insideElementPressed=false;aC.insideElement=true;O(av,aC)}if(aA.enterHandler){ax=aA.enterHandler({eventSource:aA,pointerType:aC.type,position:C(aC.currentPos,aA.element),buttons:av.buttons,pointers:aA.getActivePointerCount(),insideElementPressed:aC.insideElementPressed,buttonDownAny:av.buttons!==0,isTouchEvent:aC.type==="touch",originalEvent:au,preventDefaultAction:false,userData:aA.userData});if(ax===false){R.cancelEvent(au)}}}}function q(aB,au,aC){var az=E[aB.hash],av=aB.getActivePointersListByType(aC[0].type),aw,aA=aC.length,aD,ay,ax;for(aw=0;aw<aA;aw++){aD=aC[aw];ay=av.getById(aD.id);if(ay){if(ay.captured){ay.insideElement=false;ay.lastPos=ay.currentPos;ay.lastTime=ay.currentTime;ay.currentPos=aD.currentPos;ay.currentTime=aD.currentTime}else{ao(av,ay)}aD=ay}if(aB.exitHandler){ax=aB.exitHandler({eventSource:aB,pointerType:aD.type,position:C(aD.currentPos,aB.element),buttons:av.buttons,pointers:aB.getActivePointerCount(),insideElementPressed:ay?ay.insideElementPressed:false,buttonDownAny:av.buttons!==0,isTouchEvent:aD.type==="touch",originalEvent:au,preventDefaultAction:false,userData:aB.userData});if(ax===false){R.cancelEvent(au)}}}}function w(aC,au,aD,ax){var aA=E[aC.hash],ay,av=aC.getActivePointersListByType(aD[0].type),aw,aB=aD.length,aE,az;if(typeof au.buttons!=="undefined"){av.buttons=au.buttons}else{if(R.Browser.vendor===R.BROWSERS.IE&&R.Browser.version<9){if(ax===0){av.buttons+=1}else{if(ax===1){av.buttons+=4}else{if(ax===2){av.buttons+=2}else{if(ax===3){av.buttons+=8}else{if(ax===4){av.buttons+=16}else{if(ax===5){av.buttons+=32}}}}}}}else{if(ax===0){av.buttons|=1}else{if(ax===1){av.buttons|=4}else{if(ax===2){av.buttons|=2}else{if(ax===3){av.buttons|=8}else{if(ax===4){av.buttons|=16}else{if(ax===5){av.buttons|=32}}}}}}}}if(ax!==0){if(aC.nonPrimaryPressHandler){ay=aC.nonPrimaryPressHandler({eventSource:aC,pointerType:aD[0].type,position:C(aD[0].currentPos,aC.element),button:ax,buttons:av.buttons,isTouchEvent:aD[0].type==="touch",originalEvent:au,preventDefaultAction:false,userData:aC.userData});if(ay===false){R.cancelEvent(au)}}return false}for(aw=0;aw<aB;aw++){aE=aD[aw];az=av.getById(aE.id);if(az){az.captured=true;az.insideElementPressed=true;az.insideElement=true;az.contactPos=aE.currentPos;az.contactTime=aE.currentTime;az.lastPos=az.currentPos;az.lastTime=az.currentTime;az.currentPos=aE.currentPos;az.currentTime=aE.currentTime;aE=az}else{aE.captured=true;aE.insideElementPressed=true;aE.insideElement=true;O(av,aE)}av.contacts++;if(aC.dragHandler||aC.dragEndHandler||aC.pinchHandler){R.MouseTracker.gesturePointVelocityTracker.addPoint(aC,aE)}if(av.contacts===1){if(aC.pressHandler){ay=aC.pressHandler({eventSource:aC,pointerType:aE.type,position:C(aE.contactPos,aC.element),buttons:av.buttons,isTouchEvent:aE.type==="touch",originalEvent:au,preventDefaultAction:false,userData:aC.userData});if(ay===false){R.cancelEvent(au)}}}else{if(av.contacts===2){if(aC.pinchHandler&&aE.type==="touch"){aA.pinchGPoints=av.asArray();aA.lastPinchDist=aA.currentPinchDist=aA.pinchGPoints[0].currentPos.distanceTo(aA.pinchGPoints[1].currentPos);aA.lastPinchCenter=aA.currentPinchCenter=f(aA.pinchGPoints[0].currentPos,aA.pinchGPoints[1].currentPos)}}}}return true}function U(aH,ax,aI,aC){var aF=E[aH.hash],aA=aH.getActivePointersListByType(aI[0].type),aD,av,ay,aw,aB,aG=aI.length,aJ,aE,aK=false,au=false,az;if(typeof ax.buttons!=="undefined"){aA.buttons=ax.buttons}else{if(R.Browser.vendor===R.BROWSERS.IE&&R.Browser.version<9){if(aC===0){aA.buttons-=1}else{if(aC===1){aA.buttons-=4}else{if(aC===2){aA.buttons-=2}else{if(aC===3){aA.buttons-=8}else{if(aC===4){aA.buttons-=16}else{if(aC===5){aA.buttons-=32}}}}}}}else{if(aC===0){aA.buttons^=~1}else{if(aC===1){aA.buttons^=~4}else{if(aC===2){aA.buttons^=~2}else{if(aC===3){aA.buttons^=~8}else{if(aC===4){aA.buttons^=~16}else{if(aC===5){aA.buttons^=~32}}}}}}}}if(aC!==0){if(aH.nonPrimaryReleaseHandler){aD=aH.nonPrimaryReleaseHandler({eventSource:aH,pointerType:aI[0].type,position:C(aI[0].currentPos,aH.element),button:aC,buttons:aA.buttons,isTouchEvent:aI[0].type==="touch",originalEvent:ax,preventDefaultAction:false,userData:aH.userData});if(aD===false){R.cancelEvent(ax)}}return false}for(aB=0;aB<aG;aB++){aJ=aI[aB];aE=aA.getById(aJ.id);if(aE){if(aE.captured){aE.captured=false;aK=true;au=true}aE.lastPos=aE.currentPos;aE.lastTime=aE.currentTime;aE.currentPos=aJ.currentPos;aE.currentTime=aJ.currentTime;if(!aE.insideElement){ao(aA,aE)}ay=aE.currentPos;aw=aE.currentTime;if(au){aA.contacts--;if(aH.dragHandler||aH.dragEndHandler||aH.pinchHandler){R.MouseTracker.gesturePointVelocityTracker.removePoint(aH,aE)}if(aA.contacts===0){if(aH.releaseHandler){aD=aH.releaseHandler({eventSource:aH,pointerType:aE.type,position:C(ay,aH.element),buttons:aA.buttons,insideElementPressed:aE.insideElementPressed,insideElementReleased:aE.insideElement,isTouchEvent:aE.type==="touch",originalEvent:ax,preventDefaultAction:false,userData:aH.userData});if(aD===false){R.cancelEvent(ax)}}if(aH.dragEndHandler&&!aE.currentPos.equals(aE.contactPos)){aD=aH.dragEndHandler({eventSource:aH,pointerType:aE.type,position:C(aE.currentPos,aH.element),speed:aE.speed,direction:aE.direction,shift:ax.shiftKey,isTouchEvent:aE.type==="touch",originalEvent:ax,preventDefaultAction:false,userData:aH.userData});if(aD===false){R.cancelEvent(ax)}}if((aH.clickHandler||aH.dblClickHandler)&&aE.insideElement){az=aw-aE.contactTime<=aH.clickTimeThreshold&&aE.contactPos.distanceTo(ay)<=aH.clickDistThreshold;if(aH.clickHandler){aD=aH.clickHandler({eventSource:aH,pointerType:aE.type,position:C(aE.currentPos,aH.element),quick:az,shift:ax.shiftKey,isTouchEvent:aE.type==="touch",originalEvent:ax,preventDefaultAction:false,userData:aH.userData});if(aD===false){R.cancelEvent(ax)}}if(aH.dblClickHandler&&az){aA.clicks++;if(aA.clicks===1){aF.lastClickPos=ay;aF.dblClickTimeOut=setTimeout(function(){aA.clicks=0},aH.dblClickTimeThreshold)}else{if(aA.clicks===2){clearTimeout(aF.dblClickTimeOut);aA.clicks=0;if(aF.lastClickPos.distanceTo(ay)<=aH.dblClickDistThreshold){aD=aH.dblClickHandler({eventSource:aH,pointerType:aE.type,position:C(aE.currentPos,aH.element),shift:ax.shiftKey,isTouchEvent:aE.type==="touch",originalEvent:ax,preventDefaultAction:false,userData:aH.userData});if(aD===false){R.cancelEvent(ax)}}aF.lastClickPos=null}}}}}else{if(aA.contacts===2){if(aH.pinchHandler&&aE.type==="touch"){aF.pinchGPoints=aA.asArray();aF.lastPinchDist=aF.currentPinchDist=aF.pinchGPoints[0].currentPos.distanceTo(aF.pinchGPoints[1].currentPos);aF.lastPinchCenter=aF.currentPinchCenter=f(aF.pinchGPoints[0].currentPos,aF.pinchGPoints[1].currentPos)}}}}else{if(aH.releaseHandler){aD=aH.releaseHandler({eventSource:aH,pointerType:aE.type,position:C(ay,aH.element),buttons:aA.buttons,insideElementPressed:aE.insideElementPressed,insideElementReleased:aE.insideElement,isTouchEvent:aE.type==="touch",originalEvent:ax,preventDefaultAction:false,userData:aH.userData});if(aD===false){R.cancelEvent(ax)}}}}}return aK}function H(aC,au,aE){var az=E[aC.hash],av=aC.getActivePointersListByType(aE[0].type),aw,aA=aE.length,aF,ay,aB,aD,ax;if(typeof au.buttons!=="undefined"){av.buttons=au.buttons}for(aw=0;aw<aA;aw++){aF=aE[aw];ay=av.getById(aF.id);if(ay){if(aF.hasOwnProperty("isPrimary")){ay.isPrimary=aF.isPrimary}ay.lastPos=ay.currentPos;ay.lastTime=ay.currentTime;ay.currentPos=aF.currentPos;ay.currentTime=aF.currentTime}else{aF.captured=false;aF.insideElementPressed=false;aF.insideElement=true;O(av,aF)}}if(aC.stopHandler&&aE[0].type==="mouse"){clearTimeout(aC.stopTimeOut);aC.stopTimeOut=setTimeout(function(){u(aC,au,aE[0].type)},aC.stopDelay)}if(av.contacts===0){if(aC.moveHandler){ax=aC.moveHandler({eventSource:aC,pointerType:aE[0].type,position:C(aE[0].currentPos,aC.element),buttons:av.buttons,isTouchEvent:aE[0].type==="touch",originalEvent:au,preventDefaultAction:false,userData:aC.userData});if(ax===false){R.cancelEvent(au)}}}else{if(av.contacts===1){if(aC.moveHandler){ay=av.asArray()[0];ax=aC.moveHandler({eventSource:aC,pointerType:ay.type,position:C(ay.currentPos,aC.element),buttons:av.buttons,isTouchEvent:ay.type==="touch",originalEvent:au,preventDefaultAction:false,userData:aC.userData});if(ax===false){R.cancelEvent(au)}}if(aC.dragHandler){ay=av.asArray()[0];aD=ay.currentPos.minus(ay.lastPos);ax=aC.dragHandler({eventSource:aC,pointerType:ay.type,position:C(ay.currentPos,aC.element),buttons:av.buttons,delta:aD,speed:ay.speed,direction:ay.direction,shift:au.shiftKey,isTouchEvent:ay.type==="touch",originalEvent:au,preventDefaultAction:false,userData:aC.userData});if(ax===false){R.cancelEvent(au)}}}else{if(av.contacts===2){if(aC.moveHandler){aB=av.asArray();ax=aC.moveHandler({eventSource:aC,pointerType:aB[0].type,position:C(f(aB[0].currentPos,aB[1].currentPos),aC.element),buttons:av.buttons,isTouchEvent:aB[0].type==="touch",originalEvent:au,preventDefaultAction:false,userData:aC.userData});if(ax===false){R.cancelEvent(au)}}if(aC.pinchHandler&&aE[0].type==="touch"){aD=az.pinchGPoints[0].currentPos.distanceTo(az.pinchGPoints[1].currentPos);if(aD!=az.currentPinchDist){az.lastPinchDist=az.currentPinchDist;az.currentPinchDist=aD;az.lastPinchCenter=az.currentPinchCenter;az.currentPinchCenter=f(az.pinchGPoints[0].currentPos,az.pinchGPoints[1].currentPos);ax=aC.pinchHandler({eventSource:aC,pointerType:"touch",gesturePoints:az.pinchGPoints,lastCenter:C(az.lastPinchCenter,aC.element),center:C(az.currentPinchCenter,aC.element),lastDistance:az.lastPinchDist,distance:az.currentPinchDist,shift:au.shiftKey,originalEvent:au,preventDefaultAction:false,userData:aC.userData});if(ax===false){R.cancelEvent(au)}}}}}}}function ae(av,au,aw){U(av,au,aw,0);q(av,au,aw)}function u(av,aw,au){if(av.stopHandler){av.stopHandler({eventSource:av,pointerType:au,position:aj(aw,av.element),buttons:av.getActivePointersListByType(au).buttons,isTouchEvent:au==="touch",originalEvent:aw,preventDefaultAction:false,userData:av.userData})}}var G=(function(){try{return window.self!==window.top}catch(au){return true}})();function J(av){try{return av.addEventListener&&av.removeEventListener}catch(au){return false}}}(OpenSeadragon));(function(a){a.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5};a.Control=function(d,c,b){var e=d.parentNode;if(typeof c==="number"){a.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013");c={anchor:c}}c.attachToViewer=(typeof c.attachToViewer==="undefined")?true:c.attachToViewer;this.autoFade=(typeof c.autoFade==="undefined")?true:c.autoFade;this.element=d;this.anchor=c.anchor;this.container=b;if(this.anchor==a.ControlAnchor.ABSOLUTE){this.wrapper=a.makeNeutralElement("div");this.wrapper.style.position="absolute";this.wrapper.style.top=typeof(c.top)=="number"?(c.top+"px"):c.top;this.wrapper.style.left=typeof(c.left)=="number"?(c.left+"px"):c.left;this.wrapper.style.height=typeof(c.height)=="number"?(c.height+"px"):c.height;this.wrapper.style.width=typeof(c.width)=="number"?(c.width+"px"):c.width;this.wrapper.style.margin="0px";this.wrapper.style.padding="0px";this.element.style.position="relative";this.element.style.top="0px";this.element.style.left="0px";this.element.style.height="100%";this.element.style.width="100%"}else{this.wrapper=a.makeNeutralElement("div");this.wrapper.style.display="inline-block";if(this.anchor==a.ControlAnchor.NONE){this.wrapper.style.width=this.wrapper.style.height="100%"}}this.wrapper.appendChild(this.element);if(c.attachToViewer){if(this.anchor==a.ControlAnchor.TOP_RIGHT||this.anchor==a.ControlAnchor.BOTTOM_RIGHT){this.container.insertBefore(this.wrapper,this.container.firstChild)}else{this.container.appendChild(this.wrapper)}}else{e.appendChild(this.wrapper)}};a.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element);this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!="none"},setVisible:function(b){this.wrapper.style.display=b?(this.anchor==a.ControlAnchor.ABSOLUTE?"block":"inline-block"):"none"},setOpacity:function(b){if(this.element[a.SIGNAL]&&a.Browser.vendor==a.BROWSERS.IE){a.setElementOpacity(this.element,b,true)}else{a.setElementOpacity(this.wrapper,b,true)}}}}(OpenSeadragon));(function(b){b.ControlDock=function(c){var f=["topleft","topright","bottomright","bottomleft"],e,d;b.extend(true,this,{id:"controldock-"+b.now()+"-"+Math.floor(Math.random()*1000000),container:b.makeNeutralElement("div"),controls:[]},c);this.container.onsubmit=function(){return false};if(this.element){this.element=b.getElement(this.element);this.element.appendChild(this.container);this.element.style.position="relative";this.container.style.width="100%";this.container.style.height="100%"}for(d=0;d<f.length;d++){e=f[d];this.controls[e]=b.makeNeutralElement("div");this.controls[e].style.position="absolute";if(e.match("left")){this.controls[e].style.left="0px"}if(e.match("right")){this.controls[e].style.right="0px"}if(e.match("top")){this.controls[e].style.top="0px"}if(e.match("bottom")){this.controls[e].style.bottom="0px"}}this.container.appendChild(this.controls.topleft);this.container.appendChild(this.controls.topright);this.container.appendChild(this.controls.bottomright);this.container.appendChild(this.controls.bottomleft)};b.ControlDock.prototype={addControl:function(c,e){c=b.getElement(c);var d=null;if(a(this,c)>=0){return}switch(e.anchor){case b.ControlAnchor.TOP_RIGHT:d=this.controls.topright;c.style.position="relative";c.style.paddingRight="0px";c.style.paddingTop="0px";break;case b.ControlAnchor.BOTTOM_RIGHT:d=this.controls.bottomright;c.style.position="relative";c.style.paddingRight="0px";c.style.paddingBottom="0px";break;case b.ControlAnchor.BOTTOM_LEFT:d=this.controls.bottomleft;c.style.position="relative";c.style.paddingLeft="0px";c.style.paddingBottom="0px";break;case b.ControlAnchor.TOP_LEFT:d=this.controls.topleft;c.style.position="relative";c.style.paddingLeft="0px";c.style.paddingTop="0px";break;case b.ControlAnchor.ABSOLUTE:d=this.container;c.style.margin="0px";c.style.padding="0px";break;default:case b.ControlAnchor.NONE:d=this.container;c.style.margin="0px";c.style.padding="0px";break}this.controls.push(new b.Control(c,e,d));c.style.display="inline-block"},removeControl:function(d){d=b.getElement(d);var c=a(this,d);if(c>=0){this.controls[c].destroy();this.controls.splice(c,1)}return this},clearControls:function(){while(this.controls.length>0){this.controls.pop().destroy()}return this},areControlsEnabled:function(){var c;for(c=this.controls.length-1;c>=0;c--){if(this.controls[c].isVisible()){return true}}return false},setControlsEnabled:function(c){var d;for(d=this.controls.length-1;d>=0;d--){this.controls[d].setVisible(c)}return this}};function a(f,e){var c=f.controls,d;for(d=c.length-1;d>=0;d--){if(c[d].element==e){return d}}return -1}}(OpenSeadragon));(function(a){a.Placement=a.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:false,isHorizontallyCentered:true,isRight:false,isTop:false,isVerticallyCentered:true,isBottom:false},1:{isLeft:true,isHorizontallyCentered:false,isRight:false,isTop:true,isVerticallyCentered:false,isBottom:false},2:{isLeft:false,isHorizontallyCentered:true,isRight:false,isTop:true,isVerticallyCentered:false,isBottom:false},3:{isLeft:false,isHorizontallyCentered:false,isRight:true,isTop:true,isVerticallyCentered:false,isBottom:false},4:{isLeft:false,isHorizontallyCentered:false,isRight:true,isTop:false,isVerticallyCentered:true,isBottom:false},5:{isLeft:false,isHorizontallyCentered:false,isRight:true,isTop:false,isVerticallyCentered:false,isBottom:true},6:{isLeft:false,isHorizontallyCentered:true,isRight:false,isTop:false,isVerticallyCentered:false,isBottom:true},7:{isLeft:true,isHorizontallyCentered:false,isRight:false,isTop:false,isVerticallyCentered:false,isBottom:true},8:{isLeft:true,isHorizontallyCentered:false,isRight:false,isTop:false,isVerticallyCentered:true,isBottom:false}}})}(OpenSeadragon));(function(C){var n={};var K=1;C.Viewer=function(X){var W=arguments,Z=this,Y;if(!C.isPlainObject(X)){X={id:W[0],xmlPath:W.length>1?W[1]:undefined,prefixUrl:W.length>2?W[2]:undefined,controls:W.length>3?W[3]:undefined,overlays:W.length>4?W[4]:undefined}}if(X.config){C.extend(true,X,X.config);delete X.config}C.extend(true,this,{id:X.id,hash:X.hash||K++,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},C.DEFAULT_SETTINGS,X);if(typeof(this.hash)==="undefined"){throw new Error("A hash must be defined, either by specifying options.id or options.hash.")}if(typeof(n[this.hash])!=="undefined"){C.console.warn("Hash "+this.hash+" has already been used.")}n[this.hash]={fsBoundsDelta:new C.Point(1,1),prevContainerSize:null,animating:false,forceRedraw:false,mouseInside:false,group:null,zooming:false,zoomFactor:null,lastZoomTime:null,fullPage:false,onfullscreenchange:null};this._sequenceIndex=0;this._firstOpen=true;this._updateRequestId=null;this._loadQueue=[];this.currentOverlays=[];this._lastScrollTime=C.now();C.EventSource.call(this);this.addHandler("open-failed",function(aa){var ab=C.getString("Errors.OpenFailed",aa.eventSource,aa.message);Z._showMessage(ab)});C.ControlDock.call(this,X);if(this.xmlPath){this.tileSources=[this.xmlPath]}this.element=this.element||document.getElementById(this.id);this.canvas=C.makeNeutralElement("div");this.canvas.className="openseadragon-canvas";(function(aa){aa.width="100%";aa.height="100%";aa.overflow="hidden";aa.position="absolute";aa.top="0px";aa.left="0px"}(this.canvas.style));C.setElementTouchActionNone(this.canvas);if(X.tabIndex!==""){this.canvas.tabIndex=(X.tabIndex===undefined?0:X.tabIndex)}this.container.className="openseadragon-container";(function(aa){aa.width="100%";aa.height="100%";aa.position="relative";aa.overflow="hidden";aa.left="0px";aa.top="0px";aa.textAlign="left"}(this.container.style));this.container.insertBefore(this.canvas,this.container.firstChild);this.element.appendChild(this.container);this.bodyWidth=document.body.style.width;this.bodyHeight=document.body.style.height;this.bodyOverflow=document.body.style.overflow;this.docOverflow=document.documentElement.style.overflow;this.innerTracker=new C.MouseTracker({element:this.canvas,startDisabled:this.mouseNavEnabled?false:true,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:C.delegate(this,r),keyHandler:C.delegate(this,N),clickHandler:C.delegate(this,y),dblClickHandler:C.delegate(this,o),dragHandler:C.delegate(this,v),dragEndHandler:C.delegate(this,b),enterHandler:C.delegate(this,Q),exitHandler:C.delegate(this,s),pressHandler:C.delegate(this,F),releaseHandler:C.delegate(this,B),nonPrimaryPressHandler:C.delegate(this,T),nonPrimaryReleaseHandler:C.delegate(this,j),scrollHandler:C.delegate(this,P),pinchHandler:C.delegate(this,h)});this.outerTracker=new C.MouseTracker({element:this.container,startDisabled:this.mouseNavEnabled?false:true,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:C.delegate(this,O),exitHandler:C.delegate(this,I)});if(this.toolbar){this.toolbar=new C.ControlDock({element:this.toolbar})}this.bindStandardControls();n[this.hash].prevContainerSize=w(this.container);this.world=new C.World({viewer:this});this.world.addHandler("add-item",function(aa){Z.source=Z.world.getItemAt(0).source;n[Z.hash].forceRedraw=true;if(!Z._updateRequestId){Z._updateRequestId=S(Z,m)}});this.world.addHandler("remove-item",function(aa){if(Z.world.getItemCount()){Z.source=Z.world.getItemAt(0).source}else{Z.source=null}n[Z.hash].forceRedraw=true});this.world.addHandler("metrics-change",function(aa){if(Z.viewport){Z.viewport._setContentBounds(Z.world.getHomeBounds(),Z.world.getContentFactor())}});this.world.addHandler("item-index-change",function(aa){Z.source=Z.world.getItemAt(0).source});this.viewport=new C.Viewport({containerSize:n[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins});this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor());this.imageLoader=new C.ImageLoader({jobLimit:this.imageLoaderLimit});this.tileCache=new C.TileCache({maxImageCacheCount:this.maxImageCacheCount});this.drawer=new C.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor});this.overlaysContainer=C.makeNeutralElement("div");this.canvas.appendChild(this.overlaysContainer);if(!this.drawer.canRotate()){if(this.rotateLeft){Y=this.buttons.buttons.indexOf(this.rotateLeft);this.buttons.buttons.splice(Y,1);this.buttons.element.removeChild(this.rotateLeft.element)}if(this.rotateRight){Y=this.buttons.buttons.indexOf(this.rotateRight);this.buttons.buttons.splice(Y,1);this.buttons.element.removeChild(this.rotateRight.element)}}if(this.showNavigator){this.navigator=new C.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,crossOriginPolicy:this.crossOriginPolicy})}if(this.sequenceMode){this.bindSequenceControls()}if(this.tileSources){this.open(this.tileSources)}for(Y=0;Y<this.customControls.length;Y++){this.addControl(this.customControls[Y].id,{anchor:this.customControls[Y].anchor})}C.requestAnimationFrame(function(){t(Z)})};C.extend(C.Viewer.prototype,C.EventSource.prototype,C.ControlDock.prototype,{isOpen:function(){return !!this.world.getItemCount()},openDzi:function(W){C.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead.");return this.open(W)},openTileSource:function(W){C.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead.");return this.open(W)},open:function(ad){var Y=this;this.close();if(!ad){return}if(this.sequenceMode&&C.isArray(ad)){if(this.referenceStrip){this.referenceStrip.destroy();this.referenceStrip=null}this.tileSources=ad;this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage));if(this.tileSources.length){this.open(this.tileSources[this._sequenceIndex]);if(this.showReferenceStrip){this.referenceStrip=new C.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,viewer:this})}}this._updateSequenceButtons(this._sequenceIndex);return}if(!C.isArray(ad)){ad=[ad]}if(!ad.length){return}this._opening=true;var Z=ad.length;var ac=0;var W=0;var aa;var ae=function(){if(ac+W===Z){if(ac){if(Y._firstOpen||!Y.preserveViewport){Y.viewport.goHome(true);Y.viewport.update()}Y._firstOpen=false;var ag=ad[0];if(ag.tileSource){ag=ag.tileSource}if(Y.overlays&&!Y.preserveOverlays){for(var af=0;af<Y.overlays.length;af++){Y.currentOverlays[af]=g(Y,Y.overlays[af])}}Y._drawOverlays();Y._opening=false;Y.raiseEvent("open",{source:ag})}else{Y._opening=false;Y.raiseEvent("open-failed",aa)}}};var ab=function(ag){if(!C.isPlainObject(ag)||!ag.tileSource){ag={tileSource:ag}}if(ag.index!==undefined){C.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead");delete ag.index}if(ag.collectionImmediately===undefined){ag.collectionImmediately=true}var af=ag.success;ag.success=function(aj){ac++;if(ag.tileSource.overlays){for(var ai=0;ai<ag.tileSource.overlays.length;ai++){Y.addOverlay(ag.tileSource.overlays[ai])}}if(af){af(aj)}ae()};var ah=ag.error;ag.error=function(ai){W++;if(!aa){aa=ai}if(ah){ah(ai)}ae()};Y.addTiledImage(ag)};for(var X=0;X<ad.length;X++){ab(ad[X])}return this},close:function(){if(!n[this.hash]){return this}this._opening=false;if(this.navigator){this.navigator.close()}if(!this.preserveOverlays){this.clearOverlays();this.overlaysContainer.innerHTML=""}n[this.hash].animating=false;this.world.removeAll();this.imageLoader.clear();this.raiseEvent("close");return this},destroy:function(){if(!n[this.hash]){return}this.close();this.clearOverlays();this.overlaysContainer.innerHTML="";if(this.referenceStrip){this.referenceStrip.destroy();this.referenceStrip=null}if(this._updateRequestId!==null){C.cancelAnimationFrame(this._updateRequestId);this._updateRequestId=null}if(this.drawer){this.drawer.destroy()}this.removeAllHandlers();if(this.element){while(this.element.firstChild){this.element.removeChild(this.element.firstChild)}}if(this.innerTracker){this.innerTracker.destroy()}if(this.outerTracker){this.outerTracker.destroy()}n[this.hash]=null;delete n[this.hash];this.canvas=null;this.container=null;this.element=null},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(W){this.innerTracker.setTracking(W);this.outerTracker.setTracking(W);this.raiseEvent("mouse-enabled",{enabled:W});return this},areControlsEnabled:function(){var W=this.controls.length,X;for(X=0;X<this.controls.length;X++){W=W&&this.controls[X].isVisibile()}return W},setControlsEnabled:function(W){if(W){A(this)}else{t(this)}this.raiseEvent("controls-enabled",{enabled:W});return this},isFullPage:function(){return n[this.hash].fullPage},setFullPage:function(ag){var aa=document.body,ad=aa.style,Z=document.documentElement.style,ab=this,X,W,Y;if(ag==this.isFullPage()){return this}var ae={fullPage:ag,preventDefaultAction:false};this.raiseEvent("pre-full-page",ae);if(ae.preventDefaultAction){return this}if(ag){this.elementSize=C.getElementSize(this.element);this.pageScroll=C.getPageScroll();this.elementMargin=this.element.style.margin;this.element.style.margin="0";this.elementPadding=this.element.style.padding;this.element.style.padding="0";this.bodyMargin=ad.margin;this.docMargin=Z.margin;ad.margin="0";Z.margin="0";this.bodyPadding=ad.padding;this.docPadding=Z.padding;ad.padding="0";Z.padding="0";this.bodyWidth=ad.width;this.docWidth=Z.width;ad.width="100%";Z.width="100%";this.bodyHeight=ad.height;this.docHeight=Z.height;ad.height="100%";Z.height="100%";this.previousBody=[];n[this.hash].prevElementParent=this.element.parentNode;n[this.hash].prevNextSibling=this.element.nextSibling;n[this.hash].prevElementWidth=this.element.style.width;n[this.hash].prevElementHeight=this.element.style.height;W=aa.childNodes.length;for(Y=0;Y<W;Y++){this.previousBody.push(aa.childNodes[0]);aa.removeChild(aa.childNodes[0])}if(this.toolbar&&this.toolbar.element){this.toolbar.parentNode=this.toolbar.element.parentNode;this.toolbar.nextSibling=this.toolbar.element.nextSibling;aa.appendChild(this.toolbar.element);C.addClass(this.toolbar.element,"fullpage")}C.addClass(this.element,"fullpage");aa.appendChild(this.element);this.element.style.height=C.getWindowSize().y+"px";this.element.style.width=C.getWindowSize().x+"px";if(this.toolbar&&this.toolbar.element){this.element.style.height=(C.getElementSize(this.element).y-C.getElementSize(this.toolbar.element).y)+"px"}n[this.hash].fullPage=true;C.delegate(this,O)({})}else{this.element.style.margin=this.elementMargin;this.element.style.padding=this.elementPadding;ad.margin=this.bodyMargin;Z.margin=this.docMargin;ad.padding=this.bodyPadding;Z.padding=this.docPadding;ad.width=this.bodyWidth;Z.width=this.docWidth;ad.height=this.bodyHeight;Z.height=this.docHeight;aa.removeChild(this.element);W=this.previousBody.length;for(Y=0;Y<W;Y++){aa.appendChild(this.previousBody.shift())}C.removeClass(this.element,"fullpage");n[this.hash].prevElementParent.insertBefore(this.element,n[this.hash].prevNextSibling);if(this.toolbar&&this.toolbar.element){aa.removeChild(this.toolbar.element);C.removeClass(this.toolbar.element,"fullpage");this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling);delete this.toolbar.parentNode;delete this.toolbar.nextSibling}this.element.style.width=n[this.hash].prevElementWidth;this.element.style.height=n[this.hash].prevElementHeight;var af=0;var ac=function(){C.setPageScroll(ab.pageScroll);var ah=C.getPageScroll();af++;if(af<10&&ah.x!==ab.pageScroll.x||ah.y!==ab.pageScroll.y){C.requestAnimationFrame(ac)}};C.requestAnimationFrame(ac);n[this.hash].fullPage=false;C.delegate(this,I)({})}if(this.navigator&&this.viewport){this.navigator.update(this.viewport)}this.raiseEvent("full-page",{fullPage:ag});return this},setFullScreen:function(X){var Z=this;if(!C.supportsFullScreen){return this.setFullPage(X)}if(C.isFullScreen()===X){return this}var Y={fullScreen:X,preventDefaultAction:false};this.raiseEvent("pre-full-screen",Y);if(Y.preventDefaultAction){return this}if(X){this.setFullPage(true);if(!this.isFullPage()){return this}this.fullPageStyleWidth=this.element.style.width;this.fullPageStyleHeight=this.element.style.height;this.element.style.width="100%";this.element.style.height="100%";var W=function(){var aa=C.isFullScreen();if(!aa){C.removeEvent(document,C.fullScreenEventName,W);C.removeEvent(document,C.fullScreenErrorEventName,W);Z.setFullPage(false);if(Z.isFullPage()){Z.element.style.width=Z.fullPageStyleWidth;Z.element.style.height=Z.fullPageStyleHeight}}if(Z.navigator&&Z.viewport){Z.navigator.update(Z.viewport)}Z.raiseEvent("full-screen",{fullScreen:aa})};C.addEvent(document,C.fullScreenEventName,W);C.addEvent(document,C.fullScreenErrorEventName,W);C.requestFullScreen(document.body)}else{C.exitFullScreen()}return this},isVisible:function(){return this.container.style.visibility!="hidden"},setVisible:function(W){this.container.style.visibility=W?"":"hidden";this.raiseEvent("visible",{visible:W});return this},addTiledImage:function(W){C.console.assert(W,"[Viewer.addTiledImage] options is required");C.console.assert(W.tileSource,"[Viewer.addTiledImage] options.tileSource is required");C.console.assert(!W.replace||(W.index>-1&&W.index<this.world.getItemCount()),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var aa=this;if(W.replace){W.replaceItem=aa.world.getItemAt(W.index)}this._hideMessage();if(W.placeholderFillStyle===undefined){W.placeholderFillStyle=this.placeholderFillStyle}if(W.opacity===undefined){W.opacity=this.opacity}if(W.compositeOperation===undefined){W.compositeOperation=this.compositeOperation}var Y={options:W};function Z(ac){for(var ab=0;ab<aa._loadQueue.length;ab++){if(aa._loadQueue[ab]===Y){aa._loadQueue.splice(ab,1);break}}if(aa._loadQueue.length===0){X(Y)}aa.raiseEvent("add-item-failed",ac);if(W.error){W.error(ac)}}function X(ab){if(aa.collectionMode){aa.world.arrange({immediately:ab.options.collectionImmediately,rows:aa.collectionRows,columns:aa.collectionColumns,layout:aa.collectionLayout,tileSize:aa.collectionTileSize,tileMargin:aa.collectionTileMargin});aa.world.setAutoRefigureSizes(true)}}if(C.isArray(W.tileSource)){setTimeout(function(){Z({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:W.tileSource,options:W})});return}this._loadQueue.push(Y);a(this,W.tileSource,function(ae){Y.tileSource=ae;var af,ad,ab;while(aa._loadQueue.length){af=aa._loadQueue[0];if(!af.tileSource){break}aa._loadQueue.splice(0,1);if(af.options.replace){var ac=aa.world.getIndexOfItem(af.options.replaceItem);if(ac!=-1){af.options.index=ac}aa.world.removeItem(af.options.replaceItem)}ad=new C.TiledImage({viewer:aa,source:af.tileSource,viewport:aa.viewport,drawer:aa.drawer,tileCache:aa.tileCache,imageLoader:aa.imageLoader,x:af.options.x,y:af.options.y,width:af.options.width,height:af.options.height,fitBounds:af.options.fitBounds,fitBoundsPlacement:af.options.fitBoundsPlacement,clip:af.options.clip,placeholderFillStyle:af.options.placeholderFillStyle,opacity:af.options.opacity,compositeOperation:af.options.compositeOperation,springStiffness:aa.springStiffness,animationTime:aa.animationTime,minZoomImageRatio:aa.minZoomImageRatio,wrapHorizontal:aa.wrapHorizontal,wrapVertical:aa.wrapVertical,immediateRender:aa.immediateRender,blendTime:aa.blendTime,alwaysBlend:aa.alwaysBlend,minPixelRatio:aa.minPixelRatio,smoothTileEdgesMinZoom:aa.smoothTileEdgesMinZoom,iOSDevice:aa.iOSDevice,crossOriginPolicy:aa.crossOriginPolicy,debugMode:aa.debugMode});if(aa.collectionMode){aa.world.setAutoRefigureSizes(false)}aa.world.addItem(ad,{index:af.options.index});if(aa._loadQueue.length===0){X(af)}if(aa.world.getItemCount()===1&&!aa.preserveViewport){aa.viewport.goHome(true)}if(aa.navigator){ab=C.extend({},af.options,{replace:false,originalTiledImage:ad,tileSource:af.tileSource});aa.navigator.addTiledImage(ab)}if(af.options.success){af.options.success({item:ad})}}},function(ab){ab.options=W;Z(ab)})},addSimpleImage:function(W){C.console.assert(W,"[Viewer.addSimpleImage] options is required");C.console.assert(W.url,"[Viewer.addSimpleImage] options.url is required");var X=C.extend({},W,{tileSource:{type:"image",url:W.url}});delete X.url;this.addTiledImage(X)},addLayer:function(X){var Y=this;C.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var W=C.extend({},X,{success:function(Z){Y.raiseEvent("add-layer",{options:X,drawer:Z.item})},error:function(Z){Y.raiseEvent("add-layer-failed",Z)}});this.addTiledImage(W);return this},getLayerAtLevel:function(W){C.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead.");return this.world.getItemAt(W)},getLevelOfLayer:function(W){C.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead.");return this.world.getIndexOfItem(W)},getLayersCount:function(){C.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead.");return this.world.getItemCount()},setLayerLevel:function(W,X){C.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead.");return this.world.setItemIndex(W,X)},removeLayer:function(W){C.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead.");return this.world.removeItem(W)},forceRedraw:function(){n[this.hash].forceRedraw=true;return this},bindSequenceControls:function(){var aa=C.delegate(this,z),X=C.delegate(this,k),W=C.delegate(this,c),Y=C.delegate(this,e),ab=this.navImages,Z=true;if(this.showSequenceControl){if(this.previousButton||this.nextButton){Z=false}this.previousButton=new C.Button({element:this.previousButton?C.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:C.getString("Tooltips.PreviousPage"),srcRest:J(this.prefixUrl,ab.previous.REST),srcGroup:J(this.prefixUrl,ab.previous.GROUP),srcHover:J(this.prefixUrl,ab.previous.HOVER),srcDown:J(this.prefixUrl,ab.previous.DOWN),onRelease:Y,onFocus:aa,onBlur:X});this.nextButton=new C.Button({element:this.nextButton?C.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:C.getString("Tooltips.NextPage"),srcRest:J(this.prefixUrl,ab.next.REST),srcGroup:J(this.prefixUrl,ab.next.GROUP),srcHover:J(this.prefixUrl,ab.next.HOVER),srcDown:J(this.prefixUrl,ab.next.DOWN),onRelease:W,onFocus:aa,onBlur:X});if(!this.navPrevNextWrap){this.previousButton.disable()}if(!this.tileSources||!this.tileSources.length){this.nextButton.disable()}if(Z){this.paging=new C.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold});this.pagingControl=this.paging.element;if(this.toolbar){this.toolbar.addControl(this.pagingControl,{anchor:C.ControlAnchor.BOTTOM_RIGHT})}else{this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||C.ControlAnchor.TOP_LEFT})}}}return this},bindStandardControls:function(){var aj=C.delegate(this,x),W=C.delegate(this,l),X=C.delegate(this,M),ab=C.delegate(this,f),ad=C.delegate(this,u),af=C.delegate(this,i),Y=C.delegate(this,G),ae=C.delegate(this,H),aa=C.delegate(this,U),ai=C.delegate(this,z),Z=C.delegate(this,k),ah=this.navImages,ac=[],ag=true;if(this.showNavigationControl){if(this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton){ag=false}if(this.showZoomControl){ac.push(this.zoomInButton=new C.Button({element:this.zoomInButton?C.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:C.getString("Tooltips.ZoomIn"),srcRest:J(this.prefixUrl,ah.zoomIn.REST),srcGroup:J(this.prefixUrl,ah.zoomIn.GROUP),srcHover:J(this.prefixUrl,ah.zoomIn.HOVER),srcDown:J(this.prefixUrl,ah.zoomIn.DOWN),onPress:aj,onRelease:W,onClick:X,onEnter:aj,onExit:W,onFocus:ai,onBlur:Z}));ac.push(this.zoomOutButton=new C.Button({element:this.zoomOutButton?C.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:C.getString("Tooltips.ZoomOut"),srcRest:J(this.prefixUrl,ah.zoomOut.REST),srcGroup:J(this.prefixUrl,ah.zoomOut.GROUP),srcHover:J(this.prefixUrl,ah.zoomOut.HOVER),srcDown:J(this.prefixUrl,ah.zoomOut.DOWN),onPress:ab,onRelease:W,onClick:ad,onEnter:ab,onExit:W,onFocus:ai,onBlur:Z}))}if(this.showHomeControl){ac.push(this.homeButton=new C.Button({element:this.homeButton?C.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:C.getString("Tooltips.Home"),srcRest:J(this.prefixUrl,ah.home.REST),srcGroup:J(this.prefixUrl,ah.home.GROUP),srcHover:J(this.prefixUrl,ah.home.HOVER),srcDown:J(this.prefixUrl,ah.home.DOWN),onRelease:af,onFocus:ai,onBlur:Z}))}if(this.showFullPageControl){ac.push(this.fullPageButton=new C.Button({element:this.fullPageButton?C.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:C.getString("Tooltips.FullPage"),srcRest:J(this.prefixUrl,ah.fullpage.REST),srcGroup:J(this.prefixUrl,ah.fullpage.GROUP),srcHover:J(this.prefixUrl,ah.fullpage.HOVER),srcDown:J(this.prefixUrl,ah.fullpage.DOWN),onRelease:Y,onFocus:ai,onBlur:Z}))}if(this.showRotationControl){ac.push(this.rotateLeftButton=new C.Button({element:this.rotateLeftButton?C.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:C.getString("Tooltips.RotateLeft"),srcRest:J(this.prefixUrl,ah.rotateleft.REST),srcGroup:J(this.prefixUrl,ah.rotateleft.GROUP),srcHover:J(this.prefixUrl,ah.rotateleft.HOVER),srcDown:J(this.prefixUrl,ah.rotateleft.DOWN),onRelease:ae,onFocus:ai,onBlur:Z}));ac.push(this.rotateRightButton=new C.Button({element:this.rotateRightButton?C.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:C.getString("Tooltips.RotateRight"),srcRest:J(this.prefixUrl,ah.rotateright.REST),srcGroup:J(this.prefixUrl,ah.rotateright.GROUP),srcHover:J(this.prefixUrl,ah.rotateright.HOVER),srcDown:J(this.prefixUrl,ah.rotateright.DOWN),onRelease:aa,onFocus:ai,onBlur:Z}))}if(ag){this.buttons=new C.ButtonGroup({buttons:ac,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold});this.navControl=this.buttons.element;this.addHandler("open",C.delegate(this,E));if(this.toolbar){this.toolbar.addControl(this.navControl,{anchor:C.ControlAnchor.TOP_LEFT})}else{this.addControl(this.navControl,{anchor:this.navigationControlAnchor||C.ControlAnchor.TOP_LEFT})}}}return this},currentPage:function(){return this._sequenceIndex},goToPage:function(W){if(this.tileSources&&W>=0&&W<this.tileSources.length){this.raiseEvent("page",{page:W});this._sequenceIndex=W;this._updateSequenceButtons(W);this.open(this.tileSources[W]);if(this.referenceStrip){this.referenceStrip.setFocus(W)}}return this},addOverlay:function(aa,W,Z,ab){var Y;if(C.isPlainObject(aa)){Y=aa}else{Y={element:aa,location:W,placement:Z,onDraw:ab}}aa=C.getElement(Y.element);if(d(this.currentOverlays,aa)>=0){return this}var X=g(this,Y);this.currentOverlays.push(X);X.drawHTML(this.overlaysContainer,this.viewport);this.raiseEvent("add-overlay",{element:aa,location:Y.location,placement:Y.placement});return this},updateOverlay:function(Z,W,Y){var X;Z=C.getElement(Z);X=d(this.currentOverlays,Z);if(X>=0){this.currentOverlays[X].update(W,Y);n[this.hash].forceRedraw=true;this.raiseEvent("update-overlay",{element:Z,location:W,placement:Y})}return this},removeOverlay:function(X){var W;X=C.getElement(X);W=d(this.currentOverlays,X);if(W>=0){this.currentOverlays[W].destroy();this.currentOverlays.splice(W,1);n[this.hash].forceRedraw=true;this.raiseEvent("remove-overlay",{element:X})}return this},clearOverlays:function(){while(this.currentOverlays.length>0){this.currentOverlays.pop().destroy()}n[this.hash].forceRedraw=true;this.raiseEvent("clear-overlay",{});return this},getOverlayById:function(X){var W;X=C.getElement(X);W=d(this.currentOverlays,X);if(W>=0){return this.currentOverlays[W]}else{return null}},_updateSequenceButtons:function(W){if(this.nextButton){if(!this.tileSources||this.tileSources.length-1===W){if(!this.navPrevNextWrap){this.nextButton.disable()}}else{this.nextButton.enable()}}if(this.previousButton){if(W>0){this.previousButton.enable()}else{if(!this.navPrevNextWrap){this.previousButton.disable()}}}},_showMessage:function(W){this._hideMessage();var X=C.makeNeutralElement("div");X.appendChild(document.createTextNode(W));this.messageDiv=C.makeCenteredNode(X);C.addClass(this.messageDiv,"openseadragon-message");this.container.appendChild(this.messageDiv)},_hideMessage:function(){var W=this.messageDiv;if(W){W.parentNode.removeChild(W);delete this.messageDiv}},gestureSettingsByDeviceType:function(W){switch(W){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var W,X=this.currentOverlays.length;for(W=0;W<X;W++){this.currentOverlays[W].drawHTML(this.overlaysContainer,this.viewport)}},_cancelPendingImages:function(){this._loadQueue=[]}});function w(W){W=C.getElement(W);return new C.Point((W.clientWidth===0?1:W.clientWidth),(W.clientHeight===0?1:W.clientHeight))}function a(Z,ad,Y,ab){var aa=Z;if(C.type(ad)=="string"){if(ad.match(/\s*<.*/)){ad=C.parseXml(ad)}else{if(ad.match(/\s*[\{\[].*/)){ad=C.parseJSON(ad)}}}function ac(ag,af){if(ag.ready){Y(ag)}else{ag.addHandler("ready",function(){Y(ag)});ag.addHandler("open-failed",function(ah){ab({message:ah.message,source:af})})}}if(C.type(ad)=="string"){ad=new C.TileSource({url:ad,crossOriginPolicy:Z.crossOriginPolicy,ajaxWithCredentials:Z.ajaxWithCredentials,useCanvas:Z.useCanvas,success:function(af){Y(af.tileSource)}});ad.addHandler("open-failed",function(af){ab(af)})}else{if(C.isPlainObject(ad)||ad.nodeType){if(!ad.crossOriginPolicy&&Z.crossOriginPolicy){ad.crossOriginPolicy=Z.crossOriginPolicy}if(ad.ajaxWithCredentials===undefined){ad.ajaxWithCredentials=Z.ajaxWithCredentials}if(ad.useCanvas===undefined){ad.useCanvas=Z.useCanvas}if(C.isFunction(ad.getTileUrl)){var W=new C.TileSource(ad);W.getTileUrl=ad.getTileUrl;Y(W)}else{var X=C.TileSource.determineType(aa,ad);if(!X){ab({message:"Unable to load TileSource",source:ad});return}var ae=X.prototype.configure.apply(aa,[ad]);ac(new X(ae),ad)}}else{ac(ad,ad)}}}function g(ab,Z){if(Z instanceof C.Overlay){return Z}var aa=null;if(Z.element){aa=C.getElement(Z.element)}else{var W=Z.id?Z.id:"openseadragon-overlay-"+Math.floor(Math.random()*10000000);aa=C.getElement(Z.id);if(!aa){aa=document.createElement("a");aa.href="#/overlay/"+W}aa.id=W;C.addClass(aa,Z.className?Z.className:"openseadragon-overlay")}var af=Z.location;var X=Z.width;var ag=Z.height;if(!af){var ae=Z.x;var ad=Z.y;if(Z.px!==undefined){var ac=ab.viewport.imageToViewportRectangle(new C.Rect(Z.px,Z.py,X||0,ag||0));ae=ac.x;ad=ac.y;X=X!==undefined?ac.width:undefined;ag=ag!==undefined?ac.height:undefined}af=new C.Point(ae,ad)}var Y=Z.placement;if(Y&&C.type(Y)==="string"){Y=C.Placement[Z.placement.toUpperCase()]}return new C.Overlay({element:aa,location:af,placement:Y,onDraw:Z.onDraw,checkResize:Z.checkResize,width:X,height:ag,rotationMode:Z.rotationMode})}function d(Y,X){var W;for(W=Y.length-1;W>=0;W--){if(Y[W].element===X){return W}}return -1}function S(X,W){return C.requestAnimationFrame(function(){W(X)})}function R(W){C.requestAnimationFrame(function(){q(W)})}function t(W){if(!W.autoHideControls){return}W.controlsShouldFade=true;W.controlsFadeBeginTime=C.now()+W.controlsFadeDelay;window.setTimeout(function(){R(W)},W.controlsFadeDelay)}function q(aa){var Z,W,X,Y;if(aa.controlsShouldFade){Z=C.now();W=Z-aa.controlsFadeBeginTime;X=1-W/aa.controlsFadeLength;X=Math.min(1,X);X=Math.max(0,X);for(Y=aa.controls.length-1;Y>=0;Y--){if(aa.controls[Y].autoFade){aa.controls[Y].setOpacity(X)}}if(X>0){R(aa)}}}function A(X){var W;X.controlsShouldFade=false;for(W=X.controls.length-1;W>=0;W--){X.controls[W].setOpacity(1)}}function z(){A(this)}function k(){t(this)}function r(W){if(!W.preventDefaultAction&&!W.ctrl&&!W.alt&&!W.meta){switch(W.keyCode){case 38:if(W.shift){this.viewport.zoomBy(1.1)}else{this.viewport.panBy(this.viewport.deltaPointsFromPixels(new C.Point(0,-40)))}this.viewport.applyConstraints();return false;case 40:if(W.shift){this.viewport.zoomBy(0.9)}else{this.viewport.panBy(this.viewport.deltaPointsFromPixels(new C.Point(0,40)))}this.viewport.applyConstraints();return false;case 37:this.viewport.panBy(this.viewport.deltaPointsFromPixels(new C.Point(-40,0)));this.viewport.applyConstraints();return false;case 39:this.viewport.panBy(this.viewport.deltaPointsFromPixels(new C.Point(40,0)));this.viewport.applyConstraints();return false;default:return true}}else{return true}}function N(W){if(!W.preventDefaultAction&&!W.ctrl&&!W.alt&&!W.meta){switch(W.keyCode){case 43:case 61:this.viewport.zoomBy(1.1);this.viewport.applyConstraints();return false;case 45:this.viewport.zoomBy(0.9);this.viewport.applyConstraints();return false;case 48:this.viewport.goHome();this.viewport.applyConstraints();return false;case 119:case 87:if(W.shift){this.viewport.zoomBy(1.1)}else{this.viewport.panBy(this.viewport.deltaPointsFromPixels(new C.Point(0,-40)))}this.viewport.applyConstraints();return false;case 115:case 83:if(W.shift){this.viewport.zoomBy(0.9)}else{this.viewport.panBy(this.viewport.deltaPointsFromPixels(new C.Point(0,40)))}this.viewport.applyConstraints();return false;case 97:this.viewport.panBy(this.viewport.deltaPointsFromPixels(new C.Point(-40,0)));this.viewport.applyConstraints();return false;case 100:this.viewport.panBy(this.viewport.deltaPointsFromPixels(new C.Point(40,0)));this.viewport.applyConstraints();return false;default:return true}}else{return true}}function y(X){var W;var Y=document.activeElement==this.canvas;if(!Y){this.canvas.focus()}if(!X.preventDefaultAction&&this.viewport&&X.quick){W=this.gestureSettingsByDeviceType(X.pointerType);if(W.clickToZoom){this.viewport.zoomBy(X.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(X.position,true));this.viewport.applyConstraints()}}this.raiseEvent("canvas-click",{tracker:X.eventSource,position:X.position,quick:X.quick,shift:X.shift,originalEvent:X.originalEvent})}function o(X){var W;if(!X.preventDefaultAction&&this.viewport){W=this.gestureSettingsByDeviceType(X.pointerType);if(W.dblClickToZoom){this.viewport.zoomBy(X.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(X.position,true));this.viewport.applyConstraints()}}this.raiseEvent("canvas-double-click",{tracker:X.eventSource,position:X.position,shift:X.shift,originalEvent:X.originalEvent})}function v(X){var W;if(!X.preventDefaultAction&&this.viewport){W=this.gestureSettingsByDeviceType(X.pointerType);if(!this.panHorizontal){X.delta.x=0}if(!this.panVertical){X.delta.y=0}this.viewport.panBy(this.viewport.deltaPointsFromPixels(X.delta.negate()),W.flickEnabled);if(this.constrainDuringPan){this.viewport.applyConstraints()}}this.raiseEvent("canvas-drag",{tracker:X.eventSource,position:X.position,delta:X.delta,speed:X.speed,direction:X.direction,shift:X.shift,originalEvent:X.originalEvent})}function b(aa){if(!aa.preventDefaultAction&&this.viewport){var X=this.gestureSettingsByDeviceType(aa.pointerType);if(X.flickEnabled&&aa.speed>=X.flickMinSpeed){var Z=0;if(this.panHorizontal){Z=X.flickMomentum*aa.speed*Math.cos(aa.direction)}var Y=0;if(this.panVertical){Y=X.flickMomentum*aa.speed*Math.sin(aa.direction)}var W=this.viewport.pixelFromPoint(this.viewport.getCenter(true));var ab=this.viewport.pointFromPixel(new C.Point(W.x-Z,W.y-Y));this.viewport.panTo(ab,false)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:aa.eventSource,position:aa.position,speed:aa.speed,direction:aa.direction,shift:aa.shift,originalEvent:aa.originalEvent})}function Q(W){this.raiseEvent("canvas-enter",{tracker:W.eventSource,pointerType:W.pointerType,position:W.position,buttons:W.buttons,pointers:W.pointers,insideElementPressed:W.insideElementPressed,buttonDownAny:W.buttonDownAny,originalEvent:W.originalEvent})}function s(W){this.raiseEvent("canvas-exit",{tracker:W.eventSource,pointerType:W.pointerType,position:W.position,buttons:W.buttons,pointers:W.pointers,insideElementPressed:W.insideElementPressed,buttonDownAny:W.buttonDownAny,originalEvent:W.originalEvent})}function F(W){this.raiseEvent("canvas-press",{tracker:W.eventSource,pointerType:W.pointerType,position:W.position,insideElementPressed:W.insideElementPressed,insideElementReleased:W.insideElementReleased,originalEvent:W.originalEvent})}function B(W){this.raiseEvent("canvas-release",{tracker:W.eventSource,pointerType:W.pointerType,position:W.position,insideElementPressed:W.insideElementPressed,insideElementReleased:W.insideElementReleased,originalEvent:W.originalEvent})}function T(W){this.raiseEvent("canvas-nonprimary-press",{tracker:W.eventSource,position:W.position,pointerType:W.pointerType,button:W.button,buttons:W.buttons,originalEvent:W.originalEvent})}function j(W){this.raiseEvent("canvas-nonprimary-release",{tracker:W.eventSource,position:W.position,pointerType:W.pointerType,button:W.button,buttons:W.buttons,originalEvent:W.originalEvent})}function h(Z){var X,ac,Y,W;if(!Z.preventDefaultAction&&this.viewport){X=this.gestureSettingsByDeviceType(Z.pointerType);if(X.pinchToZoom){ac=this.viewport.pointFromPixel(Z.center,true);Y=this.viewport.pointFromPixel(Z.lastCenter,true);W=Y.minus(ac);if(!this.panHorizontal){W.x=0}if(!this.panVertical){W.y=0}this.viewport.zoomBy(Z.distance/Z.lastDistance,ac,true);this.viewport.panBy(W,true);this.viewport.applyConstraints()}if(X.pinchRotate){var ab=Math.atan2(Z.gesturePoints[0].currentPos.y-Z.gesturePoints[1].currentPos.y,Z.gesturePoints[0].currentPos.x-Z.gesturePoints[1].currentPos.x);var aa=Math.atan2(Z.gesturePoints[0].lastPos.y-Z.gesturePoints[1].lastPos.y,Z.gesturePoints[0].lastPos.x-Z.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+((ab-aa)*(180/Math.PI)))}}this.raiseEvent("canvas-pinch",{tracker:Z.eventSource,gesturePoints:Z.gesturePoints,lastCenter:Z.lastCenter,center:Z.center,lastDistance:Z.lastDistance,distance:Z.distance,shift:Z.shift,originalEvent:Z.originalEvent});return false}function P(aa){var W,Z,X,Y;X=C.now();Y=X-this._lastScrollTime;if(Y>this.minScrollDeltaTime){this._lastScrollTime=X;if(!aa.preventDefaultAction&&this.viewport){W=this.gestureSettingsByDeviceType(aa.pointerType);if(W.scrollToZoom){Z=Math.pow(this.zoomPerScroll,aa.scroll);this.viewport.zoomBy(Z,this.viewport.pointFromPixel(aa.position,true));this.viewport.applyConstraints()}}this.raiseEvent("canvas-scroll",{tracker:aa.eventSource,position:aa.position,scroll:aa.scroll,shift:aa.shift,originalEvent:aa.originalEvent});if(W&&W.scrollToZoom){return false}}else{W=this.gestureSettingsByDeviceType(aa.pointerType);if(W&&W.scrollToZoom){return false}}}function O(W){n[this.hash].mouseInside=true;A(this);this.raiseEvent("container-enter",{tracker:W.eventSource,position:W.position,buttons:W.buttons,pointers:W.pointers,insideElementPressed:W.insideElementPressed,buttonDownAny:W.buttonDownAny,originalEvent:W.originalEvent})}function I(W){if(W.pointers<1){n[this.hash].mouseInside=false;if(!n[this.hash].animating){t(this)}}this.raiseEvent("container-exit",{tracker:W.eventSource,position:W.position,buttons:W.buttons,pointers:W.pointers,insideElementPressed:W.insideElementPressed,buttonDownAny:W.buttonDownAny,originalEvent:W.originalEvent})}function m(W){D(W);if(W.isOpen()){W._updateRequestId=S(W,m)}else{W._updateRequestId=false}}function D(ad){if(ad._opening){return}if(ad.autoResize){var W=w(ad.container);var ac=n[ad.hash].prevContainerSize;if(!W.equals(ac)){var ae=ad.viewport;if(ad.preserveImageSizeOnResize){var Z=ac.x/W.x;var af=ae.getZoom()*Z;var Y=ae.getCenter();ae.resize(W,false);ae.zoomTo(af,null,true);ae.panTo(Y,true)}else{var X=ae.getBounds();ae.resize(W,true);ae.fitBoundsWithConstraints(X,true)}n[ad.hash].prevContainerSize=W;n[ad.hash].forceRedraw=true}}var aa=ad.viewport.update();var ab=ad.world.update()||aa;if(aa){ad.raiseEvent("viewport-change")}if(ad.referenceStrip){ab=ad.referenceStrip.update(ad.viewport)||ab}if(!n[ad.hash].animating&&ab){ad.raiseEvent("animation-start");A(ad)}if(ab||n[ad.hash].forceRedraw||ad.world.needsDraw()){p(ad);ad._drawOverlays();if(ad.navigator){ad.navigator.update(ad.viewport)}n[ad.hash].forceRedraw=false;if(ab){ad.raiseEvent("animation")}}if(n[ad.hash].animating&&!ab){ad.raiseEvent("animation-finish");if(!n[ad.hash].mouseInside){t(ad)}}n[ad.hash].animating=ab}function p(W){W.imageLoader.clear();W.drawer.clear();W.world.draw();W.raiseEvent("update-viewport",{})}function J(X,W){return X?X+W:W}function x(){n[this.hash].lastZoomTime=C.now();n[this.hash].zoomFactor=this.zoomPerSecond;n[this.hash].zooming=true;L(this)}function f(){n[this.hash].lastZoomTime=C.now();n[this.hash].zoomFactor=1/this.zoomPerSecond;n[this.hash].zooming=true;L(this)}function l(){n[this.hash].zooming=false}function L(W){C.requestAnimationFrame(C.delegate(W,V))}function V(){var X,W,Y;if(n[this.hash].zooming&&this.viewport){X=C.now();W=X-n[this.hash].lastZoomTime;Y=Math.pow(n[this.hash].zoomFactor,W/1000);this.viewport.zoomBy(Y);this.viewport.applyConstraints();n[this.hash].lastZoomTime=X;L(this)}}function M(){if(this.viewport){n[this.hash].zooming=false;this.viewport.zoomBy(this.zoomPerClick/1);this.viewport.applyConstraints()}}function u(){if(this.viewport){n[this.hash].zooming=false;this.viewport.zoomBy(1/this.zoomPerClick);this.viewport.applyConstraints()}}function E(){this.buttons.emulateEnter();this.buttons.emulateExit()}function i(){if(this.viewport){this.viewport.goHome()}}function G(){if(this.isFullPage()&&!C.isFullScreen()){this.setFullPage(false)}else{this.setFullScreen(!this.isFullPage())}if(this.buttons){this.buttons.emulateExit()}this.fullPageButton.element.focus();if(this.viewport){this.viewport.applyConstraints()}}function H(){if(this.viewport){var W=this.viewport.getRotation();if(W===0){W=270}else{W-=90}this.viewport.setRotation(W)}}function U(){if(this.viewport){var W=this.viewport.getRotation();if(W===270){W=0}else{W+=90}this.viewport.setRotation(W)}}function e(){var W=this._sequenceIndex-1;if(this.navPrevNextWrap&&W<0){W+=this.tileSources.length}this.goToPage(W)}function c(){var W=this._sequenceIndex+1;if(this.navPrevNextWrap&&W>=this.tileSources.length){W=0}this.goToPage(W)}}(OpenSeadragon));(function(e){e.Navigator=function(h){var l=h.viewer,m=this,j,i;if(!h.id){h.id="navigator-"+e.now();this.element=e.makeNeutralElement("div");h.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:true,autoFade:h.autoFade};if(h.position){if("BOTTOM_RIGHT"==h.position){h.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT}else{if("BOTTOM_LEFT"==h.position){h.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT}else{if("TOP_RIGHT"==h.position){h.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT}else{if("TOP_LEFT"==h.position){h.controlOptions.anchor=e.ControlAnchor.TOP_LEFT}else{if("ABSOLUTE"==h.position){h.controlOptions.anchor=e.ControlAnchor.ABSOLUTE;h.controlOptions.top=h.top;h.controlOptions.left=h.left;h.controlOptions.height=h.height;h.controlOptions.width=h.width}}}}}}}else{this.element=document.getElementById(h.id);h.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:false,autoFade:false}}this.element.id=h.id;this.element.className+=" navigator";h=e.extend(true,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},h,{element:this.element,tabIndex:-1,showNavigator:false,mouseNavEnabled:false,showNavigationControl:false,showSequenceControl:false,immediateRender:true,blendTime:0,animationTime:0,autoResize:h.autoResize,minZoomImageRatio:1});h.minPixelRatio=this.minPixelRatio=l.minPixelRatio;e.setElementTouchActionNone(this.element);this.borderWidth=2;this.fudge=new e.Point(1,1);this.totalBorderWidths=new e.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge);if(h.controlOptions.anchor!=e.ControlAnchor.NONE){(function(o,n){o.margin="0px";o.border=n+"px solid #555";o.padding="0px";o.background="#000";o.opacity=0.8;o.overflow="hidden"}(this.element.style,this.borderWidth))}this.displayRegion=e.makeNeutralElement("div");this.displayRegion.id=this.element.id+"-displayregion";this.displayRegion.className="displayregion";(function(o,n){o.position="relative";o.top="0px";o.left="0px";o.fontSize="0px";o.overflow="hidden";o.border=n+"px solid #900";o.margin="0px";o.padding="0px";o.background="transparent";o["float"]="left";o.cssFloat="left";o.styleFloat="left";o.zIndex=999999999;o.cursor="default"}(this.displayRegion.style,this.borderWidth));this.displayRegionContainer=e.makeNeutralElement("div");this.displayRegionContainer.id=this.element.id+"-displayregioncontainer";this.displayRegionContainer.className="displayregioncontainer";this.displayRegionContainer.style.width="100%";this.displayRegionContainer.style.height="100%";l.addControl(this.element,h.controlOptions);this._resizeWithViewer=h.controlOptions.anchor!=e.ControlAnchor.ABSOLUTE&&h.controlOptions.anchor!=e.ControlAnchor.NONE;if(this._resizeWithViewer){if(h.width&&h.height){this.element.style.height=typeof(h.height)=="number"?(h.height+"px"):h.height;this.element.style.width=typeof(h.width)=="number"?(h.width+"px"):h.width}else{j=e.getElementSize(l.element);this.element.style.height=Math.round(j.y*h.sizeRatio)+"px";this.element.style.width=Math.round(j.x*h.sizeRatio)+"px";this.oldViewerSize=j}i=e.getElementSize(this.element);this.elementArea=i.x*i.y}this.oldContainerSize=new e.Point(0,0);e.Viewer.apply(this,[h]);this.displayRegionContainer.appendChild(this.displayRegion);this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function g(n){b(m.displayRegionContainer,n);b(m.displayRegion,-n);m.viewport.setRotation(n)}if(h.navigatorRotate){var k=h.viewer.viewport?h.viewer.viewport.getRotation():h.viewer.degrees||0;g(k);h.viewer.addHandler("rotate",function(n){g(n.degrees)})}this.innerTracker.destroy();this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,d),clickHandler:e.delegate(this,c),releaseHandler:e.delegate(this,a),scrollHandler:e.delegate(this,f)});this.addHandler("reset-size",function(){if(m.viewport){m.viewport.goHome(true)}});l.world.addHandler("item-index-change",function(o){var n=m.world.getItemAt(o.previousIndex);m.world.setItemIndex(n,o.newIndex)});l.world.addHandler("remove-item",function(p){var n=p.item;var o=m._getMatchingItem(n);if(o){m.world.removeItem(o)}});this.update(l.viewport)};e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var g=new e.Point((this.container.clientWidth===0?1:this.container.clientWidth),(this.container.clientHeight===0?1:this.container.clientHeight));if(!g.equals(this.oldContainerSize)){this.viewport.resize(g,true);this.viewport.goHome(true);this.oldContainerSize=g;this.drawer.clear();this.world.draw()}}},update:function(m){var o,k,h,g,l,n;o=e.getElementSize(this.viewer.element);if(this._resizeWithViewer&&o.x&&o.y&&!o.equals(this.oldViewerSize)){this.oldViewerSize=o;if(this.maintainSizeRatio||!this.elementArea){k=o.x*this.sizeRatio;h=o.y*this.sizeRatio}else{k=Math.sqrt(this.elementArea*(o.x/o.y));h=this.elementArea/k}this.element.style.width=Math.round(k)+"px";this.element.style.height=Math.round(h)+"px";if(!this.elementArea){this.elementArea=k*h}this.updateSize()}if(m&&this.viewport){g=m.getBoundsNoRotate(true);l=this.viewport.pixelFromPointNoRotate(g.getTopLeft(),false);n=this.viewport.pixelFromPointNoRotate(g.getBottomRight(),false).minus(this.totalBorderWidths);var i=this.displayRegion.style;i.display=this.world.getItemCount()?"block":"none";i.top=Math.round(l.y)+"px";i.left=Math.round(l.x)+"px";var j=Math.abs(l.x-n.x);var p=Math.abs(l.y-n.y);i.width=Math.round(Math.max(j,0))+"px";i.height=Math.round(Math.max(p,0))+"px"}},addTiledImage:function(h){var j=this;var i=h.originalTiledImage;delete h.original;var g=e.extend({},h,{success:function(l){var k=l.item;k._originalForNavigator=i;j._matchBounds(k,i,true);i.addHandler("bounds-change",function(){j._matchBounds(k,i)})}});return e.Viewer.prototype.addTiledImage.apply(this,[g])},_getMatchingItem:function(g){var k=this.world.getItemCount();var j;for(var h=0;h<k;h++){j=this.world.getItemAt(h);if(j._originalForNavigator===g){return j}}return null},_matchBounds:function(j,h,g){var i=h.getBounds();j.setPosition(i.getTopLeft(),g);j.setWidth(i.width,g)}});function c(g){if(g.quick&&this.viewer.viewport){this.viewer.viewport.panTo(this.viewport.pointFromPixel(g.position));this.viewer.viewport.applyConstraints()}}function d(g){if(this.viewer.viewport){if(!this.panHorizontal){g.delta.x=0}if(!this.panVertical){g.delta.y=0}this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(g.delta))}}function a(g){if(g.insideElementPressed&&this.viewer.viewport){this.viewer.viewport.applyConstraints()}}function f(g){this.viewer.raiseEvent("navigator-scroll",{tracker:g.eventSource,position:g.position,scroll:g.scroll,shift:g.shift,originalEvent:g.originalEvent});return false}function b(g,h){g.style.webkitTransform="rotate("+h+"deg)";g.style.mozTransform="rotate("+h+"deg)";g.style.msTransform="rotate("+h+"deg)";g.style.oTransform="rotate("+h+"deg)";g.style.transform="rotate("+h+"deg)"}}(OpenSeadragon));(function(b){var a={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right"}};b.extend(b,{getString:function(h){var g=h.split("."),e=null,d=arguments,c=a,f;for(f=0;f<g.length-1;f++){c=c[g[f]]||{}}e=c[g[f]];if(typeof(e)!="string"){b.console.debug("Untranslated source string:",h);e=""}return e.replace(/\{\d+\}/g,function(j){var k=parseInt(j.match(/\d+/),10)+1;return k<d.length?d[k]:""})},setString:function(g,f){var e=g.split("."),c=a,d;for(d=0;d<e.length-1;d++){if(!c[e[d]]){c[e[d]]={}}c=c[e[d]]}c[e[d]]=f}})}(OpenSeadragon));(function(a){a.Point=function(b,c){this.x=typeof(b)=="number"?b:0;this.y=typeof(c)=="number"?c:0};a.Point.prototype={clone:function(){return new a.Point(this.x,this.y)},plus:function(b){return new a.Point(this.x+b.x,this.y+b.y)},minus:function(b){return new a.Point(this.x-b.x,this.y-b.y)},times:function(b){return new a.Point(this.x*b,this.y*b)},divide:function(b){return new a.Point(this.x/b,this.y/b)},negate:function(){return new a.Point(-this.x,-this.y)},distanceTo:function(b){return Math.sqrt(Math.pow(this.x-b.x,2)+Math.pow(this.y-b.y,2))},apply:function(b){return new a.Point(b(this.x),b(this.y))},equals:function(b){return(b instanceof a.Point)&&(this.x===b.x)&&(this.y===b.y)},rotate:function(i,c){c=c||new a.Point(0,0);var f;var e;if(i%90===0){var h=i%360;if(h<0){h+=360}switch(h){case 0:f=1;e=0;break;case 90:f=0;e=1;break;case 180:f=-1;e=0;break;case 270:f=0;e=-1;break}}else{var g=i*Math.PI/180;f=Math.cos(g);e=Math.sin(g)}var b=f*(this.x-c.x)-e*(this.y-c.y)+c.x;var j=e*(this.x-c.x)+f*(this.y-c.y)+c.y;return new a.Point(b,j)},toString:function(){return"("+(Math.round(this.x*100)/100)+","+(Math.round(this.y*100)/100)+")"}}}(OpenSeadragon));(function(a){a.TileSource=function(d,k,l,h,c,j){var f=this;var g=arguments,m,e;if(a.isPlainObject(d)){m=d}else{m={width:g[0],height:g[1],tileSize:g[2],tileOverlap:g[3],minLevel:g[4],maxLevel:g[5]}}a.EventSource.call(this);a.extend(true,this,m);if(!this.success){for(e=0;e<arguments.length;e++){if(a.isFunction(arguments[e])){this.success=arguments[e];break}}}if(this.success){this.addHandler("ready",function(i){f.success(i)})}if("string"==a.type(arguments[0])){this.url=arguments[0]}if(this.url){this.aspectRatio=1;this.dimensions=new a.Point(10,10);this.tileSize=0;this._tileWidth=0;this._tileHeight=0;this.tileOverlap=0;this.minLevel=0;this.maxLevel=0;this.ready=false;this.getImageInfo(this.url)}else{this.ready=true;this.aspectRatio=(m.width&&m.height)?(m.width/m.height):1;this.dimensions=new a.Point(m.width,m.height);this.tileSize=m.tileSize?m.tileSize:0;if(this.tileSize){this._tileWidth=this._tileHeight=this.tileSize}else{if(this.tileWidth){this._tileWidth=this.tileWidth;delete this.tileWidth}else{this._tileWidth=0}if(this.tileHeight){this._tileHeight=this.tileHeight;delete this.tileHeight}else{this._tileHeight=0}}this.tileOverlap=m.tileOverlap?m.tileOverlap:0;this.minLevel=m.minLevel?m.minLevel:0;this.maxLevel=(undefined!==m.maxLevel&&null!==m.maxLevel)?m.maxLevel:((m.width&&m.height)?Math.ceil(Math.log(Math.max(m.width,m.height))/Math.log(2)):0);if(this.success&&a.isFunction(this.success)){this.success(this)}}};a.TileSource.prototype={getTileSize:function(c){a.console.error("[TileSource.getTileSize] is deprecated.Use TileSource.getTileWidth() and TileSource.getTileHeight() instead");return this._tileWidth},getTileWidth:function(c){if(!this._tileWidth){return this.getTileSize(c)}return this._tileWidth},getTileHeight:function(c){if(!this._tileHeight){return this.getTileSize(c)}return this._tileHeight},getLevelScale:function(e){var c={},d;for(d=0;d<=this.maxLevel;d++){c[d]=1/Math.pow(2,this.maxLevel-d)}this.getLevelScale=function(f){return c[f]};return this.getLevelScale(e)},getNumTiles:function(f){var d=this.getLevelScale(f),c=Math.ceil(d*this.dimensions.x/this.getTileWidth(f)),e=Math.ceil(d*this.dimensions.y/this.getTileHeight(f));return new a.Point(c,e)},getPixelRatio:function(f){var e=this.dimensions.times(this.getLevelScale(f)),d=1/e.x,c=1/e.y;return new a.Point(d,c)},getClosestLevel:function(e){var d,f,c;for(d=this.minLevel;d<this.maxLevel;d++){c=this.getNumTiles(d);f=new a.Point(Math.floor(e.x/this.getTileWidth(d)),Math.floor(e.y/this.getTileHeight(d)));if(c.x+1>=f.x&&c.y+1>=f.y){break}}return Math.max(0,d-1)},getTileAtPoint:function(g,d){var f=d.times(this.dimensions.x).times(this.getLevelScale(g)),e=Math.floor(f.x/this.getTileWidth(g)),c=Math.floor(f.y/this.getTileHeight(g));return new a.Point(e,c)},getTileBounds:function(c,l,h){var d=this.dimensions.times(this.getLevelScale(c)),j=this.getTileWidth(c),f=this.getTileHeight(c),m=(l===0)?0:j*l-this.tileOverlap,k=(h===0)?0:f*h-this.tileOverlap,i=j+(l===0?1:2)*this.tileOverlap,g=f+(h===0?1:2)*this.tileOverlap,e=1/d.x;i=Math.min(i,d.x-m);g=Math.min(g,d.y-k);return new a.Rect(m*e,k*e,i*e,g*e)},getImageInfo:function(e){var g=this,i,j,h,k,f,c,d;if(e){f=e.split("/");c=f[f.length-1];d=c.lastIndexOf(".");if(d>-1){f[f.length-1]=c.slice(0,d)}}j=function(m){if(typeof(m)==="string"){m=a.parseXml(m)}var l=a.TileSource.determineType(g,m,e);if(!l){g.raiseEvent("open-failed",{message:"Unable to load TileSource",source:e});return}k=l.prototype.configure.apply(g,[m,e]);if(k.ajaxWithCredentials===undefined){k.ajaxWithCredentials=g.ajaxWithCredentials}h=new l(k);g.ready=true;g.raiseEvent("ready",{tileSource:h})};if(e.match(/\.js$/)){i=e.split("/").pop().replace(".js","");a.jsonp({url:e,async:false,callbackName:i,callback:j})}else{a.makeAjaxRequest({url:e,withCredentials:this.ajaxWithCredentials,success:function(m){var l=b(m);j(l)},error:function(p,l){var o;try{o="HTTP "+p.status+" attempting to load TileSource"}catch(n){var m;if(typeof(l)=="undefined"||!l.toString){m="Unknown error"}else{m=l.toString()}o=m+" attempting to load TileSource"}g.raiseEvent("open-failed",{message:o,source:e})}})}},supports:function(d,c){return false},configure:function(d,c){throw new Error("Method not implemented.")},getTileUrl:function(e,c,d){throw new Error("Method not implemented.")},tileExists:function(f,c,e){var d=this.getNumTiles(f);return f>=this.minLevel&&f<=this.maxLevel&&c>=0&&e>=0&&c<d.x&&e<d.y}};a.extend(true,a.TileSource.prototype,a.EventSource.prototype);function b(i){var f=i.responseText,c=i.status,h,d;if(!i){throw new Error(a.getString("Errors.Security"))}else{if(i.status!==200&&i.status!==0){c=i.status;h=(c==404)?"Not Found":i.statusText;throw new Error(a.getString("Errors.Status",c,h))}}if(f.match(/\s*<.*/)){try{d=(i.responseXML&&i.responseXML.documentElement)?i.responseXML:a.parseXml(f)}catch(g){d=i.responseText}}else{if(f.match(/\s*[\{\[].*/)){d=a.parseJSON(f)}else{d=f}}return d}a.TileSource.determineType=function(f,e,c){var d;for(d in OpenSeadragon){if(d.match(/.+TileSource$/)&&a.isFunction(OpenSeadragon[d])&&a.isFunction(OpenSeadragon[d].prototype.supports)&&OpenSeadragon[d].prototype.supports.call(f,e,c)){return OpenSeadragon[d]}}a.console.error("No TileSource was able to open %s %s",c,e)}}(OpenSeadragon));(function(c){c.DziTileSource=function(f,o,p,l,m,h,k,d,n){var g,j,e,q;if(c.isPlainObject(f)){q=f}else{q={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]}}this._levelRects={};this.tilesUrl=q.tilesUrl;this.fileFormat=q.fileFormat;this.displayRects=q.displayRects;if(this.displayRects){for(g=this.displayRects.length-1;g>=0;g--){j=this.displayRects[g];for(e=j.minLevel;e<=j.maxLevel;e++){if(!this._levelRects[e]){this._levelRects[e]=[]}this._levelRects[e].push(j)}}}c.TileSource.apply(this,[q])};c.extend(c.DziTileSource.prototype,c.TileSource.prototype,{supports:function(f,d){var e;if(f.Image){e=f.Image.xmlns}else{if(f.documentElement){if("Image"==f.documentElement.localName||"Image"==f.documentElement.tagName){e=f.documentElement.namespaceURI}}}return("http://schemas.microsoft.com/deepzoom/2008"==e||"http://schemas.microsoft.com/deepzoom/2009"==e)},configure:function(f,e){var d;if(!c.isPlainObject(f)){d=b(this,f)}else{d=a(this,f)}if(e&&!d.tilesUrl){d.tilesUrl=e.replace(/([^\/]+?)(\.(dzi|xml|js))?\/?(\?.*)?$/,"$1_files/");if(e.search(/\.(dzi|xml|js)\?/)!=-1){d.queryParams=e.match(/\?.*/)}else{d.queryParams=""}}return d},getTileUrl:function(f,d,e){return[this.tilesUrl,f,"/",d,"_",e,".",this.fileFormat,this.queryParams].join("")},tileExists:function(d,m,k){var o=this._levelRects[d],l,g,e,n,j,f,h;if(!o||!o.length){return true}for(h=o.length-1;h>=0;h--){l=o[h];if(d<l.minLevel||d>l.maxLevel){continue}g=this.getLevelScale(d);e=l.x*g;n=l.y*g;j=e+l.width*g;f=n+l.height*g;e=Math.floor(e/this.tileSize);n=Math.floor(n/this.tileSize);j=Math.ceil(j/this.tileSize);f=Math.ceil(f/this.tileSize);if(e<=m&&m<j&&n<=k&&k<f){return true}}return false}});function b(n,t){if(!t||!t.documentElement){throw new Error(c.getString("Errors.Xml"))}var q=t.documentElement,d=q.localName||q.tagName,p=t.documentElement.namespaceURI,h=null,o=[],m,r,g,l,j;if(d=="Image"){try{l=q.getElementsByTagName("Size")[0];if(l===undefined){l=q.getElementsByTagNameNS(p,"Size")[0]}h={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:q.getAttribute("Url"),Format:q.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(q.getAttribute("Overlap"),10),TileSize:parseInt(q.getAttribute("TileSize"),10),Size:{Height:parseInt(l.getAttribute("Height"),10),Width:parseInt(l.getAttribute("Width"),10)}}};if(!c.imageFormatSupported(h.Image.Format)){throw new Error(c.getString("Errors.ImageFormat",h.Image.Format.toUpperCase()))}m=q.getElementsByTagName("DisplayRect");if(m===undefined){m=q.getElementsByTagNameNS(p,"DisplayRect")[0]}for(j=0;j<m.length;j++){r=m[j];g=r.getElementsByTagName("Rect")[0];if(g===undefined){g=r.getElementsByTagNameNS(p,"Rect")[0]}o.push({Rect:{X:parseInt(g.getAttribute("X"),10),Y:parseInt(g.getAttribute("Y"),10),Width:parseInt(g.getAttribute("Width"),10),Height:parseInt(g.getAttribute("Height"),10),MinLevel:parseInt(r.getAttribute("MinLevel"),10),MaxLevel:parseInt(r.getAttribute("MaxLevel"),10)}})}if(o.length){h.Image.DisplayRect=o}return a(n,h)}catch(k){throw (k instanceof Error)?k:new Error(c.getString("Errors.Dzi"))}}else{if(d=="Collection"){throw new Error(c.getString("Errors.Dzc"))}else{if(d=="Error"){var f=q.getElementsByTagName("Message")[0];var s=f.firstChild.nodeValue;throw new Error(s)}}}throw new Error(c.getString("Errors.Dzi"))}function a(k,f){var d=f.Image,n=d.Url,j=d.Format,o=d.Size,r=d.DisplayRect||[],e=parseInt(o.Width,10),p=parseInt(o.Height,10),q=parseInt(d.TileSize,10),m=parseInt(d.Overlap,10),l=[],g,h;for(h=0;h<r.length;h++){g=r[h].Rect;l.push(new c.DisplayRect(parseInt(g.X,10),parseInt(g.Y,10),parseInt(g.Width,10),parseInt(g.Height,10),parseInt(g.MinLevel,10),parseInt(g.MaxLevel,10)))}return c.extend(true,{width:e,height:p,tileSize:q,tileOverlap:m,minLevel:null,maxLevel:null,tilesUrl:n,fileFormat:j,displayRects:l},f)}}(OpenSeadragon));(function(d){d.IIIFTileSource=function(g){d.extend(true,this,g);if(!(this.height&&this.width&&this["@id"])){throw new Error("IIIF required parameters not provided.")}g.tileSizePerScaleFactor={};if(this.tile_width&&this.tile_height){g.tileWidth=this.tile_width;g.tileHeight=this.tile_height}else{if(this.tile_width){g.tileSize=this.tile_width}else{if(this.tile_height){g.tileSize=this.tile_height}else{if(this.tiles){if(this.tiles.length==1){g.tileWidth=this.tiles[0].width;g.tileHeight=this.tiles[0].height||this.tiles[0].width;this.scale_factors=this.tiles[0].scaleFactors}else{this.scale_factors=[];for(var h=0;h<this.tiles.length;h++){for(var j=0;j<this.tiles[h].scaleFactors.length;j++){var i=this.tiles[h].scaleFactors[j];this.scale_factors.push(i);g.tileSizePerScaleFactor[i]={width:this.tiles[h].width,height:this.tiles[h].height||this.tiles[h].width}}}}}else{if(c(g.profile)){var l=Math.min(this.height,this.width),k=[256,512,1024],f=[];for(var m=0;m<k.length;m++){if(k[m]<=l){f.push(k[m])}}if(f.length>0){g.tileSize=Math.max.apply(null,f)}else{g.tileSize=l}}else{if(this.sizes&&this.sizes.length>0){this.emulateLegacyImagePyramid=true;g.levels=b(this);d.extend(true,g,{width:g.levels[g.levels.length-1].width,height:g.levels[g.levels.length-1].height,tileSize:Math.max(g.height,g.width),tileOverlap:0,minLevel:0,maxLevel:g.levels.length-1});this.levels=g.levels}else{d.console.error("Nothing in the info.json to construct image pyramids from")}}}}}}if(!g.maxLevel&&!this.emulateLegacyImagePyramid){if(!this.scale_factors){g.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)))}else{g.maxLevel=Math.floor(Math.pow(Math.max.apply(null,this.scale_factors),0.5))}}d.TileSource.apply(this,[g])};d.extend(d.IIIFTileSource.prototype,d.TileSource.prototype,{supports:function(g,f){if(g.protocol&&g.protocol=="http://iiif.io/api/image"){return true}else{if(g["@context"]&&(g["@context"]=="http://library.stanford.edu/iiif/image-api/1.1/context.json"||g["@context"]=="http://iiif.io/api/image/1/context.json")){return true}else{if(g.profile&&g.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0){return true}else{if(g.identifier&&g.width&&g.height){return true}else{if(g.documentElement&&"info"==g.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"==g.documentElement.namespaceURI){return true}else{return false}}}}}},configure:function(h,g){if(!d.isPlainObject(h)){var f=a(h);f["@context"]="http://iiif.io/api/image/1.0/context.json";f["@id"]=g.replace("/info.xml","");return f}else{if(!h["@context"]){h["@context"]="http://iiif.io/api/image/1.0/context.json";h["@id"]=g.replace("/info.json","");return h}else{return h}}},getTileWidth:function(g){if(this.emulateLegacyImagePyramid){return d.TileSource.prototype.getTileWidth.call(this,g)}var f=Math.pow(2,this.maxLevel-g);if(this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[f]){return this.tileSizePerScaleFactor[f].width}return this._tileWidth},getTileHeight:function(g){if(this.emulateLegacyImagePyramid){return d.TileSource.prototype.getTileHeight.call(this,g)}var f=Math.pow(2,this.maxLevel-g);if(this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[f]){return this.tileSizePerScaleFactor[f].height}return this._tileHeight},getLevelScale:function(g){if(this.emulateLegacyImagePyramid){var f=NaN;if(this.levels.length>0&&g>=this.minLevel&&g<=this.maxLevel){f=this.levels[g].width/this.levels[this.maxLevel].width}return f}return d.TileSource.prototype.getLevelScale.call(this,g)},getNumTiles:function(g){if(this.emulateLegacyImagePyramid){var f=this.getLevelScale(g);if(f){return new d.Point(1,1)}else{return new d.Point(0,0)}}return d.TileSource.prototype.getNumTiles.call(this,g)},getTileAtPoint:function(g,f){if(this.emulateLegacyImagePyramid){return new d.Point(0,0)}return d.TileSource.prototype.getTileAtPoint.call(this,g,f)},getTileUrl:function(g,t,s){if(this.emulateLegacyImagePyramid){var j=null;if(this.levels.length>0&&g>=this.minLevel&&g<=this.maxLevel){j=this.levels[g].url}return j}var h="0",A=Math.pow(0.5,this.maxLevel-g),m=Math.ceil(this.width*A),w=Math.ceil(this.height*A),f,q,r,v,z,o,n,p,u,k,i,l;f=this.getTileWidth(g);q=this.getTileHeight(g);r=Math.ceil(f/A);v=Math.ceil(q/A);if(this["@context"].indexOf("/1.0/context.json")>-1||this["@context"].indexOf("/1.1/context.json")>-1||this["@context"].indexOf("/1/context.json")>-1){i="native.jpg"}else{i="default.jpg"}if(m<f&&w<q){k=m+",";z="full"}else{o=t*r;n=s*v;p=Math.min(r,this.width-o);u=Math.min(v,this.height-n);k=Math.ceil(p*A)+",";z=[o,n,p,u].join(",")}l=[this["@id"],z,k,h,i].join("/");return l}});function c(h){var f=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json"];var g=(f.indexOf(h[0])!=-1);return !g||(h.indexOf("sizeByW")!=-1)}function b(f){var h=[];for(var g=0;g<f.sizes.length;g++){h.push({url:f["@id"]+"/full/"+f.sizes[g].width+",/0/default.jpg",width:f.sizes[g].width,height:f.sizes[g].height})}return h.sort(function(j,i){return j.width-i.width})}function a(g){if(!g||!g.documentElement){throw new Error(d.getString("Errors.Xml"))}var f=g.documentElement,j=f.tagName,i=null;if(j=="info"){try{i={};e(f,i);return i}catch(h){throw (h instanceof Error)?h:new Error(d.getString("Errors.IIIF"))}}throw new Error(d.getString("Errors.IIIF"))}function e(g,k,j){var f,h;if(g.nodeType==3&&j){h=g.nodeValue.trim();if(h.match(/^\d*$/)){h=Number(h)}if(!k[j]){k[j]=h}else{if(!d.isArray(k[j])){k[j]=[k[j]]}k[j].push(h)}}else{if(g.nodeType==1){for(f=0;f<g.childNodes.length;f++){e(g.childNodes[f],k,g.nodeName)}}}}}(OpenSeadragon));(function(a){a.OsmTileSource=function(e,b,g,f,c){var d;if(a.isPlainObject(e)){d=e}else{d={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]}}if(!d.width||!d.height){d.width=65572864;d.height=65572864}if(!d.tileSize){d.tileSize=256;d.tileOverlap=0}if(!d.tilesUrl){d.tilesUrl="http://tile.openstreetmap.org/"}d.minLevel=8;a.TileSource.apply(this,[d])};a.extend(a.OsmTileSource.prototype,a.TileSource.prototype,{supports:function(c,b){return(c.type&&"openstreetmaps"==c.type)},configure:function(c,b){return c},getTileUrl:function(d,b,c){return this.tilesUrl+(d-8)+"/"+b+"/"+c+".png"}})}(OpenSeadragon));(function(a){a.TmsTileSource=function(b,g,i,d,e){var j;if(a.isPlainObject(b)){j=b}else{j={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]}}var f=Math.ceil(j.width/256)*256,h=Math.ceil(j.height/256)*256,c;if(f>h){c=f/256}else{c=h/256}j.maxLevel=Math.ceil(Math.log(c)/Math.log(2))-1;j.tileSize=256;j.width=f;j.height=h;a.TileSource.apply(this,[j])};a.extend(a.TmsTileSource.prototype,a.TileSource.prototype,{supports:function(c,b){return(c.type&&"tiledmapservice"==c.type)},configure:function(c,b){return c},getTileUrl:function(e,b,d){var c=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+b+"/"+(c-d)+".png"}})}(OpenSeadragon));(function(c){c.LegacyTileSource=function(h){var f,g,e;if(c.isArray(h)){f={type:"legacy-image-pyramid",levels:h}}f.levels=d(f.levels);if(f.levels.length>0){g=f.levels[f.levels.length-1].width;e=f.levels[f.levels.length-1].height}else{g=0;e=0;c.console.error("No supported image formats found")}c.extend(true,f,{width:g,height:e,tileSize:Math.max(e,g),tileOverlap:0,minLevel:0,maxLevel:f.levels.length>0?f.levels.length-1:0});c.TileSource.apply(this,[f]);this.levels=f.levels};c.extend(c.LegacyTileSource.prototype,c.TileSource.prototype,{supports:function(f,e){return(f.type&&"legacy-image-pyramid"==f.type)||(f.documentElement&&"legacy-image-pyramid"==f.documentElement.getAttribute("type"))},configure:function(g,f){var e;if(!c.isPlainObject(g)){e=b(this,g)}else{e=a(this,g)}return e},getLevelScale:function(f){var e=NaN;if(this.levels.length>0&&f>=this.minLevel&&f<=this.maxLevel){e=this.levels[f].width/this.levels[this.maxLevel].width}return e},getNumTiles:function(f){var e=this.getLevelScale(f);if(e){return new c.Point(1,1)}else{return new c.Point(0,0)}},getTileAtPoint:function(f,e){return new c.Point(0,0)},getTileUrl:function(h,e,g){var f=null;if(this.levels.length>0&&h>=this.minLevel&&h<=this.maxLevel){f=this.levels[h].url}return f}});function d(h){var e=[],g,f;for(f=0;f<h.length;f++){g=h[f];if(g.height&&g.width&&g.url&&(g.url.toLowerCase().match(/^.*\.(png|jpg|jpeg|gif)(?:\?.*)?$/)||(g.mimetype&&g.mimetype.toLowerCase().match(/^.*\/(png|jpg|jpeg|gif)$/)))){e.push({url:g.url,width:Number(g.width),height:Number(g.height)})}else{c.console.error("Unsupported image format: %s",g.url?g.url:"<no URL>")}}return e.sort(function(j,i){return j.height-i.height})}function b(l,o){if(!o||!o.documentElement){throw new Error(c.getString("Errors.Xml"))}var m=o.documentElement,f=m.tagName,k=null,n=[],g,h;if(f=="image"){try{k={type:m.getAttribute("type"),levels:[]};n=m.getElementsByTagName("level");for(h=0;h<n.length;h++){g=n[h];k.levels.push({url:g.getAttribute("url"),width:parseInt(g.getAttribute("width"),10),height:parseInt(g.getAttribute("height"),10)})}return a(l,k)}catch(j){throw (j instanceof Error)?j:new Error("Unknown error parsing Legacy Image Pyramid XML.")}}else{if(f=="collection"){throw new Error("Legacy Image Pyramid Collections not yet supported.")}else{if(f=="error"){throw new Error("Error: "+o)}}}throw new Error("Unknown element "+f)}function a(e,f){return f.levels}}(OpenSeadragon));(function(a){a.ImageTileSource=function(b){b=a.extend({buildPyramid:true,crossOriginPolicy:false,ajaxWithCredentials:false,useCanvas:true},b);a.TileSource.apply(this,[b])};a.extend(a.ImageTileSource.prototype,a.TileSource.prototype,{supports:function(c,b){return c.type&&c.type==="image"},configure:function(b,c){return b},getImageInfo:function(b){var c=this._image=new Image();var d=this;if(this.crossOriginPolicy){c.crossOrigin=this.crossOriginPolicy}if(this.ajaxWithCredentials){c.useCredentials=this.ajaxWithCredentials}a.addEvent(c,"load",function(){d.width=c.naturalWidth;d.height=c.naturalHeight;d.aspectRatio=d.width/d.height;d.dimensions=new a.Point(d.width,d.height);d._tileWidth=d.width;d._tileHeight=d.height;d.tileOverlap=0;d.minLevel=0;d.levels=d._buildLevels();d.maxLevel=d.levels.length-1;d.ready=true;d.raiseEvent("ready",{tileSource:d})});a.addEvent(c,"error",function(){d.raiseEvent("open-failed",{message:"Error loading image at "+b,source:b})});c.src=b},getLevelScale:function(c){var b=NaN;if(c>=this.minLevel&&c<=this.maxLevel){b=this.levels[c].width/this.levels[this.maxLevel].width}return b},getNumTiles:function(c){var b=this.getLevelScale(c);if(b){return new a.Point(1,1)}else{return new a.Point(0,0)}},getTileAtPoint:function(c,b){return new a.Point(0,0)},getTileUrl:function(e,b,d){var c=null;if(e>=this.minLevel&&e<=this.maxLevel){c=this.levels[e].url}return c},getContext2D:function(e,b,d){var c=null;if(e>=this.minLevel&&e<=this.maxLevel){c=this.levels[e].context2D}return c},_buildLevels:function(){var e=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!a.supportsCanvas||!this.useCanvas){delete this._image;return e}var c=this._image.naturalWidth;var f=this._image.naturalHeight;var h=document.createElement("canvas");var d=h.getContext("2d");h.width=c;h.height=f;d.drawImage(this._image,0,0,c,f);e[0].context2D=d;delete this._image;if(a.isCanvasTainted(h)){return e}while(c>=2&&f>=2){c=Math.floor(c/2);f=Math.floor(f/2);var b=document.createElement("canvas");var g=b.getContext("2d");b.width=c;b.height=f;g.drawImage(h,0,0,c,f);e.splice(0,0,{context2D:g,width:c,height:f});h=b;d=g}return e}})}(OpenSeadragon));(function(a){a.TileSourceCollection=function(d,e,c,b){a.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon));(function(g){g.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3};g.Button=function(h){var i=this;g.EventSource.call(this);g.extend(true,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:g.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:g.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2000,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},h);this.element=h.element||g.makeNeutralElement("div");if(!h.element){this.imgRest=g.makeTransparentImage(this.srcRest);this.imgGroup=g.makeTransparentImage(this.srcGroup);this.imgHover=g.makeTransparentImage(this.srcHover);this.imgDown=g.makeTransparentImage(this.srcDown);this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip;this.element.style.position="relative";g.setElementTouchActionNone(this.element);this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute";this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px";this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px";this.imgHover.style.visibility=this.imgDown.style.visibility="hidden";if(g.Browser.vendor==g.BROWSERS.FIREFOX&&g.Browser.version<3){this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""}this.element.appendChild(this.imgRest);this.element.appendChild(this.imgGroup);this.element.appendChild(this.imgHover);this.element.appendChild(this.imgDown)}this.addHandler("press",this.onPress);this.addHandler("release",this.onRelease);this.addHandler("click",this.onClick);this.addHandler("enter",this.onEnter);this.addHandler("exit",this.onExit);this.addHandler("focus",this.onFocus);this.addHandler("blur",this.onBlur);this.currentState=g.ButtonState.GROUP;this.fadeBeginTime=null;this.shouldFade=false;this.element.style.display="inline-block";this.element.style.position="relative";this.element.title=this.tooltip;this.tracker=new g.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(j){if(j.insideElementPressed){d(i,g.ButtonState.DOWN);i.raiseEvent("enter",{originalEvent:j.originalEvent})}else{if(!j.buttonDownAny){d(i,g.ButtonState.HOVER)}}},focusHandler:function(j){this.enterHandler(j);i.raiseEvent("focus",{originalEvent:j.originalEvent})},exitHandler:function(j){f(i,g.ButtonState.GROUP);if(j.insideElementPressed){i.raiseEvent("exit",{originalEvent:j.originalEvent})}},blurHandler:function(j){this.exitHandler(j);i.raiseEvent("blur",{originalEvent:j.originalEvent})},pressHandler:function(j){d(i,g.ButtonState.DOWN);i.raiseEvent("press",{originalEvent:j.originalEvent})},releaseHandler:function(j){if(j.insideElementPressed&&j.insideElementReleased){f(i,g.ButtonState.HOVER);i.raiseEvent("release",{originalEvent:j.originalEvent})}else{if(j.insideElementPressed){f(i,g.ButtonState.GROUP)}else{d(i,g.ButtonState.HOVER)}}},clickHandler:function(j){if(j.quick){i.raiseEvent("click",{originalEvent:j.originalEvent})}},keyHandler:function(j){if(13===j.keyCode){i.raiseEvent("click",{originalEvent:j.originalEvent});i.raiseEvent("release",{originalEvent:j.originalEvent});return false}return true}});f(this,g.ButtonState.REST)};g.extend(g.Button.prototype,g.EventSource.prototype,{notifyGroupEnter:function(){d(this,g.ButtonState.GROUP)},notifyGroupExit:function(){f(this,g.ButtonState.REST)},disable:function(){this.notifyGroupExit();this.element.disabled=true;g.setElementOpacity(this.element,0.2,true)},enable:function(){this.element.disabled=false;g.setElementOpacity(this.element,1,true);this.notifyGroupEnter()}});function c(h){g.requestAnimationFrame(function(){e(h)})}function e(j){var k,h,i;if(j.shouldFade){k=g.now();h=k-j.fadeBeginTime;i=1-h/j.fadeLength;i=Math.min(1,i);i=Math.max(0,i);if(j.imgGroup){g.setElementOpacity(j.imgGroup,i,true)}if(i>0){c(j)}}}function b(h){h.shouldFade=true;h.fadeBeginTime=g.now()+h.fadeDelay;window.setTimeout(function(){c(h)},h.fadeDelay)}function a(h){h.shouldFade=false;if(h.imgGroup){g.setElementOpacity(h.imgGroup,1,true)}}function d(h,i){if(h.element.disabled){return}if(i>=g.ButtonState.GROUP&&h.currentState==g.ButtonState.REST){a(h);h.currentState=g.ButtonState.GROUP}if(i>=g.ButtonState.HOVER&&h.currentState==g.ButtonState.GROUP){if(h.imgHover){h.imgHover.style.visibility=""}h.currentState=g.ButtonState.HOVER}if(i>=g.ButtonState.DOWN&&h.currentState==g.ButtonState.HOVER){if(h.imgDown){h.imgDown.style.visibility=""}h.currentState=g.ButtonState.DOWN}}function f(h,i){if(h.element.disabled){return}if(i<=g.ButtonState.HOVER&&h.currentState==g.ButtonState.DOWN){if(h.imgDown){h.imgDown.style.visibility="hidden"}h.currentState=g.ButtonState.HOVER}if(i<=g.ButtonState.GROUP&&h.currentState==g.ButtonState.HOVER){if(h.imgHover){h.imgHover.style.visibility="hidden"}h.currentState=g.ButtonState.GROUP}if(i<=g.ButtonState.REST&&h.currentState==g.ButtonState.GROUP){b(h);h.currentState=g.ButtonState.REST}}}(OpenSeadragon));(function(a){a.ButtonGroup=function(b){a.extend(true,this,{buttons:[],clickTimeThreshold:a.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:a.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},b);var d=this.buttons.concat([]),e=this,c;this.element=b.element||a.makeNeutralElement("div");if(!b.group){this.label=a.makeNeutralElement("label");this.element.style.display="inline-block";this.element.appendChild(this.label);for(c=0;c<d.length;c++){this.element.appendChild(d[c].element)}}a.setElementTouchActionNone(this.element);this.tracker=new a.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(g){var f;for(f=0;f<e.buttons.length;f++){e.buttons[f].notifyGroupEnter()}},exitHandler:function(g){var f;if(!g.insideElementPressed){for(f=0;f<e.buttons.length;f++){e.buttons[f].notifyGroupExit()}}},})};a.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon));(function(a){a.Rect=function(d,h,e,c,g){this.x=typeof(d)==="number"?d:0;this.y=typeof(h)==="number"?h:0;this.width=typeof(e)==="number"?e:0;this.height=typeof(c)==="number"?c:0;this.degrees=typeof(g)==="number"?g:0;this.degrees=this.degrees%360;if(this.degrees<0){this.degrees+=360}var b,f;if(this.degrees>=270){b=this.getTopRight();this.x=b.x;this.y=b.y;f=this.height;this.height=this.width;this.width=f;this.degrees-=270}else{if(this.degrees>=180){b=this.getBottomRight();this.x=b.x;this.y=b.y;this.degrees-=180}else{if(this.degrees>=90){b=this.getBottomLeft();this.x=b.x;this.y=b.y;f=this.height;this.height=this.width;this.width=f;this.degrees-=90}}}};a.Rect.fromSummits=function(f,e,c){var d=f.distanceTo(e);var b=f.distanceTo(c);var h=e.minus(f);var g=Math.atan(h.y/h.x);if(h.x<0){g+=Math.PI}else{if(h.y<0){g+=2*Math.PI}}return new a.Rect(f.x,f.y,d,b,g/Math.PI*180)};a.Rect.prototype={clone:function(){return new a.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new a.Point(this.x,this.y)},getBottomRight:function(){return new a.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new a.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new a.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new a.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new a.Point(this.width,this.height)},equals:function(b){return(b instanceof a.Rect)&&this.x===b.x&&this.y===b.y&&this.width===b.width&&this.height===b.height&&this.degrees===b.degrees},times:function(b){return new a.Rect(this.x*b,this.y*b,this.width*b,this.height*b,this.degrees)},translate:function(b){return new a.Rect(this.x+b.x,this.y+b.y,this.width,this.height,this.degrees)},union:function(e){var d=this.getBoundingBox();var h=e.getBoundingBox();var g=Math.min(d.x,h.x);var f=Math.min(d.y,h.y);var c=Math.max(d.x+d.width,h.x+h.width);var b=Math.max(d.y+d.height,h.y+h.height);return new a.Rect(g,f,c-g,b-f)},intersection:function(c){var f=1e-10;var g=[];var A=this.getTopLeft();if(c.containsPoint(A,f)){g.push(A)}var p=this.getTopRight();if(c.containsPoint(p,f)){g.push(p)}var z=this.getBottomLeft();if(c.containsPoint(z,f)){g.push(z)}var q=this.getBottomRight();if(c.containsPoint(q,f)){g.push(q)}var e=c.getTopLeft();if(this.containsPoint(e,f)){g.push(e)}var B=c.getTopRight();if(this.containsPoint(B,f)){g.push(B)}var b=c.getBottomLeft();if(this.containsPoint(b,f)){g.push(b)}var d=c.getBottomRight();if(this.containsPoint(d,f)){g.push(d)}var u=this._getSegments();var C=c._getSegments();for(var n=0;n<u.length;n++){var o=u[n];for(var m=0;m<C.length;m++){var t=C[m];var s=y(o[0],o[1],t[0],t[1]);if(s){g.push(s)}}}function y(G,E,D,k){var i=E.minus(G);var F=k.minus(D);var j=-F.x*i.y+i.x*F.y;if(j===0){return null}var I=(i.x*(G.y-D.y)-i.y*(G.x-D.x))/j;var H=(F.x*(G.y-D.y)-F.y*(G.x-D.x))/j;if(-f<=I&&I<=1-f&&-f<=H&&H<=1-f){return new a.Point(G.x+H*i.x,G.y+H*i.y)}return null}if(g.length===0){return null}var x=g[0].x;var w=g[0].x;var v=g[0].y;var r=g[0].y;for(var l=1;l<g.length;l++){var h=g[l];if(h.x<x){x=h.x}if(h.x>w){w=h.x}if(h.y<v){v=h.y}if(h.y>r){r=h.y}}return new a.Rect(x,v,w-x,r-v)},_getSegments:function(){var e=this.getTopLeft();var d=this.getTopRight();var b=this.getBottomLeft();var c=this.getBottomRight();return[[e,d],[d,c],[c,b],[b,e]]},rotate:function(g,d){g=g%360;if(g===0){return this.clone()}if(g<0){g+=360}d=d||this.getCenter();var c=this.getTopLeft().rotate(g,d);var b=this.getTopRight().rotate(g,d);var f=b.minus(c);var e=Math.atan(f.y/f.x);if(f.x<0){e+=Math.PI}else{if(f.y<0){e+=2*Math.PI}}return new a.Rect(c.x,c.y,this.width,this.height,e/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0){return this.clone()}var f=this.getTopLeft();var e=this.getTopRight();var c=this.getBottomLeft();var d=this.getBottomRight();var b=Math.min(f.x,e.x,c.x,d.x);var h=Math.max(f.x,e.x,c.x,d.x);var i=Math.min(f.y,e.y,c.y,d.y);var g=Math.max(f.y,e.y,c.y,d.y);return new a.Rect(b,i,h-b,g-i)},getIntegerBoundingBox:function(){var d=this.getBoundingBox();var c=Math.floor(d.x);var f=Math.floor(d.y);var e=Math.ceil(d.width+d.x-c);var b=Math.ceil(d.height+d.y-f);return new a.Rect(c,f,e,b)},containsPoint:function(b,h){h=h||0;var f=this.getTopLeft();var e=this.getTopRight();var c=this.getBottomLeft();var d=e.minus(f);var g=c.minus(f);return((b.x-f.x)*d.x+(b.y-f.y)*d.y>=-h)&&((b.x-e.x)*d.x+(b.y-e.y)*d.y<=h)&&((b.x-f.x)*g.x+(b.y-f.y)*g.y>=-h)&&((b.x-c.x)*g.x+(b.y-c.y)*g.y<=h)},toString:function(){return"["+(Math.round(this.x*100)/100)+", "+(Math.round(this.y*100)/100)+", "+(Math.round(this.width*100)/100)+"x"+(Math.round(this.height*100)/100)+", "+(Math.round(this.degrees*100)/100)+"deg]"}}}(OpenSeadragon));(function(b){var e={};b.ReferenceStrip=function(j){var p=this,o=j.viewer,n=b.getElementSize(o.element),l,m,k;if(!j.id){j.id="referencestrip-"+b.now();this.element=b.makeNeutralElement("div");this.element.id=j.id;this.element.className="referencestrip"}j=b.extend(true,{sizeRatio:b.DEFAULT_SETTINGS.referenceStripSizeRatio,position:b.DEFAULT_SETTINGS.referenceStripPosition,scroll:b.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:b.DEFAULT_SETTINGS.clickTimeThreshold},j,{element:this.element,showNavigator:false,mouseNavEnabled:false,showNavigationControl:false,showSequenceControl:false});b.extend(this,j);e[this.id]={animating:false};this.minPixelRatio=this.viewer.minPixelRatio;m=this.element.style;m.marginTop="0px";m.marginRight="0px";m.marginBottom="0px";m.marginLeft="0px";m.left="0px";m.bottom="0px";m.border="0px";m.background="#000";m.position="relative";b.setElementTouchActionNone(this.element);b.setElementOpacity(this.element,0.8);this.viewer=o;this.innerTracker=new b.MouseTracker({element:this.element,dragHandler:b.delegate(this,a),scrollHandler:b.delegate(this,d),enterHandler:b.delegate(this,i),exitHandler:b.delegate(this,h),keyDownHandler:b.delegate(this,c),keyHandler:b.delegate(this,f)});if(j.width&&j.height){this.element.style.width=j.width+"px";this.element.style.height=j.height+"px";o.addControl(this.element,{anchor:b.ControlAnchor.BOTTOM_LEFT})}else{if("horizontal"==j.scroll){this.element.style.width=(n.x*j.sizeRatio*o.tileSources.length)+(12*o.tileSources.length)+"px";this.element.style.height=(n.y*j.sizeRatio)+"px";o.addControl(this.element,{anchor:b.ControlAnchor.BOTTOM_LEFT})}else{this.element.style.height=(n.y*j.sizeRatio*o.tileSources.length)+(12*o.tileSources.length)+"px";this.element.style.width=(n.x*j.sizeRatio)+"px";o.addControl(this.element,{anchor:b.ControlAnchor.TOP_LEFT})}}this.panelWidth=(n.x*this.sizeRatio)+8;this.panelHeight=(n.y*this.sizeRatio)+8;this.panels=[];for(k=0;k<o.tileSources.length;k++){l=b.makeNeutralElement("div");l.id=this.element.id+"-"+k;l.style.width=p.panelWidth+"px";l.style.height=p.panelHeight+"px";l.style.display="inline";l.style["float"]="left";l.style.cssFloat="left";l.style.styleFloat="left";l.style.padding="2px";b.setElementTouchActionNone(l);l.innerTracker=new b.MouseTracker({element:l,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(q){q.eventSource.dragging=b.now()},releaseHandler:function(s){var r=s.eventSource,u=r.element.id,t=Number(u.split("-")[2]),q=b.now();if(s.insideElementPressed&&s.insideElementReleased&&r.dragging&&(q-r.dragging)<r.clickTimeThreshold){r.dragging=null;o.goToPage(t)}}});this.element.appendChild(l);l.activePanel=false;this.panels.push(l)}g(this,this.scroll=="vertical"?n.y:n.x,0);this.setFocus(0)};b.extend(b.ReferenceStrip.prototype,b.EventSource.prototype,b.Viewer.prototype,{setFocus:function(p){var k=b.getElement(this.element.id+"-"+p),o=b.getElementSize(this.viewer.canvas),j=Number(this.element.style.width.replace("px","")),m=Number(this.element.style.height.replace("px","")),n=-Number(this.element.style.marginLeft.replace("px","")),l=-Number(this.element.style.marginTop.replace("px","")),q;if(this.currentSelected!==k){if(this.currentSelected){this.currentSelected.style.background="#000"}this.currentSelected=k;this.currentSelected.style.background="#999";if("horizontal"==this.scroll){q=(Number(p))*(this.panelWidth+3);if(q>n+o.x-this.panelWidth){q=Math.min(q,(j-o.x));this.element.style.marginLeft=-q+"px";g(this,o.x,-q)}else{if(q<n){q=Math.max(0,q-o.x/2);this.element.style.marginLeft=-q+"px";g(this,o.x,-q)}}}else{q=(Number(p))*(this.panelHeight+3);if(q>l+o.y-this.panelHeight){q=Math.min(q,(m-o.y));this.element.style.marginTop=-q+"px";g(this,o.y,-q)}else{if(q<l){q=Math.max(0,q-o.y/2);this.element.style.marginTop=-q+"px";g(this,o.y,-q)}}}this.currentPage=p;i.call(this,{eventSource:this.innerTracker})}},update:function(){if(e[this.id].animating){b.console.log("image reference strip update");return true}return false},destroy:function(){if(this.element){this.element.parentNode.removeChild(this.element)}}});function a(m){var o=Number(this.element.style.marginLeft.replace("px","")),l=Number(this.element.style.marginTop.replace("px","")),j=Number(this.element.style.width.replace("px","")),k=Number(this.element.style.height.replace("px","")),n=b.getElementSize(this.viewer.canvas);this.dragging=true;if(this.element){if("horizontal"==this.scroll){if(-m.delta.x>0){if(o>-(j-n.x)){this.element.style.marginLeft=(o+(m.delta.x*2))+"px";g(this,n.x,o+(m.delta.x*2))}}else{if(-m.delta.x<0){if(o<0){this.element.style.marginLeft=(o+(m.delta.x*2))+"px";g(this,n.x,o+(m.delta.x*2))}}}}else{if(-m.delta.y>0){if(l>-(k-n.y)){this.element.style.marginTop=(l+(m.delta.y*2))+"px";g(this,n.y,l+(m.delta.y*2))}}else{if(-m.delta.y<0){if(l<0){this.element.style.marginTop=(l+(m.delta.y*2))+"px";g(this,n.y,l+(m.delta.y*2))}}}}}return false}function d(m){var o=Number(this.element.style.marginLeft.replace("px","")),l=Number(this.element.style.marginTop.replace("px","")),j=Number(this.element.style.width.replace("px","")),k=Number(this.element.style.height.replace("px","")),n=b.getElementSize(this.viewer.canvas);if(this.element){if("horizontal"==this.scroll){if(m.scroll>0){if(o>-(j-n.x)){this.element.style.marginLeft=(o-(m.scroll*60))+"px";g(this,n.x,o-(m.scroll*60))}}else{if(m.scroll<0){if(o<0){this.element.style.marginLeft=(o-(m.scroll*60))+"px";g(this,n.x,o-(m.scroll*60))}}}}else{if(m.scroll<0){if(l>n.y-k){this.element.style.marginTop=(l+(m.scroll*60))+"px";g(this,n.y,l+(m.scroll*60))}}else{if(m.scroll>0){if(l<0){this.element.style.marginTop=(l+(m.scroll*60))+"px";g(this,n.y,l+(m.scroll*60))}}}}}return false}function g(l,r,s){var p,o,q,j,k,n,m;if("horizontal"==l.scroll){p=l.panelWidth}else{p=l.panelHeight}o=Math.ceil(r/p)+5;q=Math.ceil((Math.abs(s)+r)/p)+1;o=q-o;o=o<0?0:o;for(n=o;n<q&&n<l.panels.length;n++){m=l.panels[n];if(!m.activePanel){j=new b.Viewer({id:m.id,tileSources:[l.viewer.tileSources[n]],element:m,navigatorSizeRatio:l.sizeRatio,showNavigator:false,mouseNavEnabled:false,showNavigationControl:false,showSequenceControl:false,immediateRender:true,blendTime:0,animationTime:0});j.displayRegion=b.makeNeutralElement("div");j.displayRegion.id=m.id+"-displayregion";j.displayRegion.className="displayregion";k=j.displayRegion.style;k.position="relative";k.top="0px";k.left="0px";k.fontSize="0px";k.overflow="hidden";k["float"]="left";k.cssFloat="left";k.styleFloat="left";k.zIndex=999999999;k.cursor="default";k.width=(l.panelWidth-4)+"px";k.height=(l.panelHeight-4)+"px";j.displayRegion.innerTracker=new b.MouseTracker({element:j.displayRegion,startDisabled:true});m.getElementsByTagName("div")[0].appendChild(j.displayRegion);m.activePanel=true}}}function i(k){var j=k.eventSource.element;if("horizontal"==this.scroll){j.style.marginBottom="0px"}else{j.style.marginLeft="0px"}return false}function h(k){var j=k.eventSource.element;if("horizontal"==this.scroll){j.style.marginBottom="-"+(b.getElementSize(j).y/2)+"px"}else{j.style.marginLeft="-"+(b.getElementSize(j).x/2)+"px"}return false}function c(j){if(!j.preventDefaultAction&&!j.ctrl&&!j.alt&&!j.meta){switch(j.keyCode){case 38:d.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null});return false;case 40:d.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null});return false;case 37:d.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null});return false;case 39:d.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null});return false;default:return true}}else{return true}}function f(j){if(!j.preventDefaultAction&&!j.ctrl&&!j.alt&&!j.meta){switch(j.keyCode){case 61:d.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null});return false;case 45:d.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null});return false;case 48:case 119:case 87:d.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null});return false;case 115:case 83:d.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null});return false;case 97:d.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null});return false;case 100:d.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null});return false;default:return true}}else{return true}}}(OpenSeadragon));(function(a){a.DisplayRect=function(d,g,e,c,f,b){a.Rect.apply(this,[d,g,e,c]);this.minLevel=f;this.maxLevel=b};a.extend(a.DisplayRect.prototype,a.Rect.prototype)}(OpenSeadragon));(function(b){b.Spring=function(d){var c=arguments;if(typeof(d)!="object"){d={initial:c.length&&typeof(c[0])=="number"?c[0]:undefined,springStiffness:c.length>1?c[1].springStiffness:5,animationTime:c.length>1?c[1].animationTime:1.5}}b.console.assert(typeof d.springStiffness==="number"&&d.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number");b.console.assert(typeof d.animationTime==="number"&&d.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0");if(d.exponential){this._exponential=true;delete d.exponential}b.extend(true,this,d);this.current={value:typeof(this.initial)=="number"?this.initial:(this._exponential?0:1),time:b.now()};b.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs");this.start={value:this.current.value,time:this.current.time};this.target={value:this.current.value,time:this.current.time};if(this._exponential){this.start._logValue=Math.log(this.start.value);this.target._logValue=Math.log(this.target.value);this.current._logValue=Math.log(this.current.value)}};b.Spring.prototype={resetTo:function(c){b.console.assert(!this._exponential||c!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs");this.start.value=this.target.value=this.current.value=c;this.start.time=this.target.time=this.current.time=b.now();if(this._exponential){this.start._logValue=Math.log(this.start.value);this.target._logValue=Math.log(this.target.value);this.current._logValue=Math.log(this.current.value)}},springTo:function(c){b.console.assert(!this._exponential||c!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs");this.start.value=this.current.value;this.start.time=this.current.time;this.target.value=c;this.target.time=this.start.time+1000*this.animationTime;if(this._exponential){this.start._logValue=Math.log(this.start.value);this.target._logValue=Math.log(this.target.value)}},shiftBy:function(c){this.start.value+=c;this.target.value+=c;if(this._exponential){b.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs");this.start._logValue=Math.log(this.start.value);this.target._logValue=Math.log(this.target.value)}},setExponential:function(c){this._exponential=c;if(this._exponential){b.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs");this.start._logValue=Math.log(this.start.value);this.target._logValue=Math.log(this.target.value);this.current._logValue=Math.log(this.current.value)}},update:function(){this.current.time=b.now();var c,e;if(this._exponential){c=this.start._logValue;e=this.target._logValue}else{c=this.start.value;e=this.target.value}var d=(this.current.time>=this.target.time)?e:c+(e-c)*a(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time));if(this._exponential){this.current.value=Math.exp(d)}else{this.current.value=d}},isAtTargetValue:function(){return this.current.value===this.target.value}};function a(d,c){return(1-Math.exp(d*-c))/(1-Math.exp(-d))}}(OpenSeadragon));(function(b){function c(d){b.extend(true,this,{timeout:b.DEFAULT_SETTINGS.timeout,jobId:null},d);this.image=null}c.prototype={errorMsg:null,start:function(){var d=this;this.image=new Image();if(this.crossOriginPolicy!==false){this.image.crossOrigin=this.crossOriginPolicy}this.image.onload=function(){d.finish(true)};this.image.onabort=this.image.onerror=function(){d.errorMsg="Image load aborted";d.finish(false)};this.jobId=window.setTimeout(function(){d.errorMsg="Image load exceeded timeout";d.finish(false)},this.timeout);this.image.src=this.src},finish:function(d){this.image.onload=this.image.onerror=this.image.onabort=null;if(!d){this.image=null}if(this.jobId){window.clearTimeout(this.jobId)}this.callback(this)}};b.ImageLoader=function(d){b.extend(true,this,{jobLimit:b.DEFAULT_SETTINGS.imageLoaderLimit,jobQueue:[],jobsInProgress:0},d)};b.ImageLoader.prototype={addJob:function(f){var h=this,e=function(i){a(h,i,f.callback)},g={src:f.src,crossOriginPolicy:f.crossOriginPolicy,callback:e,abort:f.abort},d=new c(g);if(!this.jobLimit||this.jobsInProgress<this.jobLimit){d.start();this.jobsInProgress++}else{this.jobQueue.push(d)}},clear:function(){for(var d=0;d<this.jobQueue.length;d++){var e=this.jobQueue[d];if(typeof e.abort==="function"){e.abort()}}this.jobQueue=[]}};function a(d,f,g){var e;d.jobsInProgress--;if((!d.jobLimit||d.jobsInProgress<d.jobLimit)&&d.jobQueue.length>0){e=d.jobQueue.shift();e.start();d.jobsInProgress++}g(f.image,f.errorMsg)}}(OpenSeadragon));(function(a){a.Tile=function(h,b,g,e,d,c,f){this.level=h;this.x=b;this.y=g;this.bounds=e;this.exists=d;this.url=c;this.context2D=f;this.loaded=false;this.loading=false;this.element=null;this.imgElement=null;this.image=null;this.style=null;this.position=null;this.size=null;this.blendStart=null;this.opacity=null;this.distance=null;this.visibility=null;this.beingDrawn=false;this.lastTouchTime=0};a.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return !!this.context2D||this.url.match(".png")},drawHTML:function(b){if(!this.cacheImageRecord){a.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){a.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}if(!this.element){this.element=a.makeNeutralElement("div");this.imgElement=this.cacheImageRecord.getImage().cloneNode();this.imgElement.style.msInterpolationMode="nearest-neighbor";this.imgElement.style.width="100%";this.imgElement.style.height="100%";this.style=this.element.style;this.style.position="absolute"}if(this.element.parentNode!=b){b.appendChild(this.element)}if(this.imgElement.parentNode!=this.element){this.element.appendChild(this.imgElement)}this.style.top=this.position.y+"px";this.style.left=this.position.x+"px";this.style.height=this.size.y+"px";this.style.width=this.size.x+"px";a.setElementOpacity(this.element,this.opacity)},drawCanvas:function(e,d,g,f){var b=this.position.times(a.pixelDensityRatio),c=this.size.times(a.pixelDensityRatio),h;if(!this.context2D&&!this.cacheImageRecord){a.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}h=this.context2D||this.cacheImageRecord.getRenderedContext();if(!this.loaded||!h){a.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}e.save();e.globalAlpha=this.opacity;if(typeof g==="number"&&g!==1){b=b.times(g);c=c.times(g)}if(f instanceof a.Point){b=b.plus(f)}if(e.globalAlpha===1&&this._hasTransparencyChannel()){e.clearRect(b.x+1,b.y+1,c.x-2,c.y-2)}d({context:e,tile:this,rendered:h});e.drawImage(h.canvas,0,0,h.canvas.width,h.canvas.height,b.x,b.y,c.x,c.y);if(a.DEBUG_DRAWING){e.strokeStyle="red";e.font="10px sans-serif";e.textAlign="left";e.textBaseline="top";e.fillText(this.url,b.x+10,b.y+10);e.strokeRect(b.x,b.y,c.x,c.y)}e.restore()},getScaleForEdgeSmoothing:function(){var b;if(this.cacheImageRecord){b=this.cacheImageRecord.getRenderedContext()}else{if(this.context2D){b=this.context2D}else{a.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString());return 1}}return b.canvas.width/(this.size.x*a.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(e,c,d){var b=Math.max(1,Math.ceil((d.x-c.x)/2));var f=Math.max(1,Math.ceil((d.y-c.y)/2));return new a.Point(b,f).minus(this.position.times(a.pixelDensityRatio).times(e||1).apply(function(g){return g%1}))},unload:function(){if(this.imgElement&&this.imgElement.parentNode){this.imgElement.parentNode.removeChild(this.imgElement)}if(this.element&&this.element.parentNode){this.element.parentNode.removeChild(this.element)}this.element=null;this.imgElement=null;this.loaded=false;this.loading=false}}}(OpenSeadragon));(function(a){a.OverlayPlacement=a.Placement;a.OverlayRotationMode=a.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3});a.Overlay=function(e,b,d){var c;if(a.isPlainObject(e)){c=e}else{c={element:e,location:b,placement:d}}this.element=c.element;this.style=c.element.style;this._init(c)};a.Overlay.prototype={_init:function(b){this.location=b.location;this.placement=b.placement===undefined?a.Placement.TOP_LEFT:b.placement;this.onDraw=b.onDraw;this.checkResize=b.checkResize===undefined?true:b.checkResize;this.width=b.width===undefined?null:b.width;this.height=b.height===undefined?null:b.height;this.rotationMode=b.rotationMode||a.OverlayRotationMode.EXACT;if(this.location instanceof a.Rect){this.width=this.location.width;this.height=this.location.height;this.location=this.location.getTopLeft();this.placement=a.Placement.TOP_LEFT}this.scales=this.width!==null&&this.height!==null;this.bounds=new a.Rect(this.location.x,this.location.y,this.width,this.height);this.position=this.location},adjust:function(b,d){var c=a.Placement.properties[this.placement];if(!c){return}if(c.isHorizontallyCentered){b.x-=d.x/2}else{if(c.isRight){b.x-=d.x}}if(c.isVerticallyCentered){b.y-=d.y/2}else{if(c.isBottom){b.y-=d.y}}},destroy:function(){var c=this.element;var d=this.style;if(c.parentNode){c.parentNode.removeChild(c);if(c.prevElementParent){d.display="none";document.body.appendChild(c)}}this.onDraw=null;d.top="";d.left="";d.position="";if(this.width!==null){d.width=""}if(this.height!==null){d.height=""}var e=a.getCssPropertyWithVendorPrefix("transformOrigin");var b=a.getCssPropertyWithVendorPrefix("transform");if(e&&b){d[e]="";d[b]=""}},drawHTML:function(c,h){var e=this.element;if(e.parentNode!==c){e.prevElementParent=e.parentNode;e.prevNextSibling=e.nextSibling;c.appendChild(e);this.size=a.getElementSize(e)}var g=this._getOverlayPositionAndSize(h);var f=g.position;var k=this.size=g.size;var d=g.rotate;if(this.onDraw){this.onDraw(f,k,this.element)}else{var b=this.style;b.left=f.x+"px";b.top=f.y+"px";if(this.width!==null){b.width=k.x+"px"}if(this.height!==null){b.height=k.y+"px"}var j=a.getCssPropertyWithVendorPrefix("transformOrigin");var i=a.getCssPropertyWithVendorPrefix("transform");if(j&&i){if(d){b[j]=this._getTransformOrigin();b[i]="rotate("+d+"deg)"}else{b[j]="";b[i]=""}}b.position="absolute";if(b.display!=="none"){b.display="block"}}},_getOverlayPositionAndSize:function(c){var b=c.pixelFromPoint(this.location,true);var f=this._getSizeInPixels(c);this.adjust(b,f);var e=0;if(c.degrees&&this.rotationMode!==a.OverlayRotationMode.NO_ROTATION){if(this.rotationMode===a.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var g=new a.Rect(b.x,b.y,f.x,f.y);var d=this._getBoundingBox(g,c.degrees);b=d.getTopLeft();f=d.getSize()}else{e=c.degrees}}return{position:b,size:f,rotate:e}},_getSizeInPixels:function(c){var e=this.size.x;var b=this.size.y;if(this.width!==null||this.height!==null){var d=c.deltaPixelsFromPointsNoRotate(new a.Point(this.width||0,this.height||0),true);if(this.width!==null){e=d.x}if(this.height!==null){b=d.y}}if(this.checkResize&&(this.width===null||this.height===null)){var f=this.size=a.getElementSize(this.element);if(this.width===null){e=f.x}if(this.height===null){b=f.y}}return new a.Point(e,b)},_getBoundingBox:function(c,d){var b=this._getPlacementPoint(c);return c.rotate(d,b).getBoundingBox()},_getPlacementPoint:function(d){var b=new a.Point(d.x,d.y);var c=a.Placement.properties[this.placement];if(c){if(c.isHorizontallyCentered){b.x+=d.width/2}else{if(c.isRight){b.x+=d.width}}if(c.isVerticallyCentered){b.y+=d.height/2}else{if(c.isBottom){b.y+=d.height}}}return b},_getTransformOrigin:function(){var b="";var c=a.Placement.properties[this.placement];if(!c){return b}if(c.isLeft){b="left"}else{if(c.isRight){b="right"}}if(c.isTop){b+=" top"}else{if(c.isBottom){b+=" bottom"}}return b},update:function(b,d){var c=a.isPlainObject(b)?b:{location:b,placement:d};this._init({location:c.location||this.location,placement:c.placement!==undefined?c.placement:this.placement,onDraw:c.onDraw||this.onDraw,checkResize:c.checkResize||this.checkResize,width:c.width!==undefined?c.width:this.width,height:c.height!==undefined?c.height:this.height,rotationMode:c.rotationMode||this.rotationMode})},getBounds:function(c){a.console.assert(c,"A viewport must now be passed to Overlay.getBounds.");var f=this.width;var b=this.height;if(f===null||b===null){var e=c.deltaPointsFromPixelsNoRotate(this.size,true);if(f===null){f=e.x}if(b===null){b=e.y}}var d=this.location.clone();this.adjust(d,new a.Point(f,b));return this._adjustBoundsForRotation(c,new a.Rect(d.x,d.y,f,b))},_adjustBoundsForRotation:function(c,d){if(!c||c.degrees===0||this.rotationMode===a.OverlayRotationMode.EXACT){return d}if(this.rotationMode===a.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null){return d}var b=this._getOverlayPositionAndSize(c);return c.viewerElementToViewportRectangle(new a.Rect(b.position.x,b.position.y,b.size.x,b.size.y))}return d.rotate(-c.degrees,this._getPlacementPoint(d))}}}(OpenSeadragon));(function(a){a.Drawer=function(d){a.console.assert(d.viewer,"[Drawer] options.viewer is required");var c=arguments;if(!a.isPlainObject(d)){d={source:c[0],viewport:c[1],element:c[2]}}a.console.assert(d.viewport,"[Drawer] options.viewport is required");a.console.assert(d.element,"[Drawer] options.element is required");if(d.source){a.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead")}this.viewer=d.viewer;this.viewport=d.viewport;this.debugGridColor=d.debugGridColor||a.DEFAULT_SETTINGS.debugGridColor;if(d.opacity){a.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead")}this.useCanvas=a.supportsCanvas&&(this.viewer?this.viewer.useCanvas:true);this.container=a.getElement(d.element);this.canvas=a.makeNeutralElement(this.useCanvas?"canvas":"div");this.context=this.useCanvas?this.canvas.getContext("2d"):null;this.sketchCanvas=null;this.sketchContext=null;this.element=this.container;this.container.dir="ltr";if(this.useCanvas){var b=this._calculateCanvasSize();this.canvas.width=b.x;this.canvas.height=b.y}this.canvas.style.width="100%";this.canvas.style.height="100%";this.canvas.style.position="absolute";a.setElementOpacity(this.canvas,this.opacity,true);this.container.style.textAlign="left";this.container.appendChild(this.canvas)};a.Drawer.prototype={addOverlay:function(d,b,c,e){a.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead.");this.viewer.addOverlay(d,b,c,e);return this},updateOverlay:function(d,b,c){a.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead.");this.viewer.updateOverlay(d,b,c);return this},removeOverlay:function(b){a.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead.");this.viewer.removeOverlay(b);return this},clearOverlays:function(){a.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead.");this.viewer.clearOverlays();return this},setOpacity:function(b){a.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");var d=this.viewer.world;for(var c=0;c<d.getItemCount();c++){d.getItemAt(c).setOpacity(b)}return this},getOpacity:function(){a.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");var d=this.viewer.world;var e=0;for(var c=0;c<d.getItemCount();c++){var b=d.getItemAt(c).getOpacity();if(b>e){e=b}}return e},needsUpdate:function(){a.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead.");return this.viewer.world.needsDraw()},numTilesLoaded:function(){a.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead.");return this.viewer.tileCache.numTilesLoaded()},reset:function(){a.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead.");this.viewer.world.resetItems();return this},update:function(){a.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead.");this.clear();this.viewer.world.draw();return this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1;this.canvas.height=1;this.sketchCanvas=null;this.sketchContext=null},clear:function(){this.canvas.innerHTML="";if(this.useCanvas){var b=this._calculateCanvasSize();if(this.canvas.width!=b.x||this.canvas.height!=b.y){this.canvas.width=b.x;this.canvas.height=b.y;if(this.sketchCanvas!==null){var c=this._calculateSketchCanvasSize();this.sketchCanvas.width=c.x;this.sketchCanvas.height=c.y}}this._clear()}},_clear:function(d,e){if(!this.useCanvas){return}var c=this._getContext(d);if(e){c.clearRect(e.x,e.y,e.width,e.height)}else{var b=c.canvas;c.clearRect(0,0,b.width,b.height)}},viewportToDrawerRectangle:function(c){var d=this.viewport.pixelFromPointNoRotate(c.getTopLeft(),true);var b=this.viewport.deltaPixelsFromPointsNoRotate(c.getSize(),true);return new a.Rect(d.x*a.pixelDensityRatio,d.y*a.pixelDensityRatio,b.x*a.pixelDensityRatio,b.y*a.pixelDensityRatio)},drawTile:function(e,d,c,g,f){a.console.assert(e,"[Drawer.drawTile] tile is required");a.console.assert(d,"[Drawer.drawTile] drawingHandler is required");if(this.useCanvas){var b=this._getContext(c);g=g||1;e.drawCanvas(b,d,g,f)}else{e.drawHTML(this.canvas)}},_getContext:function(f){var e=this.context;if(f){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var d=this._calculateSketchCanvasSize();this.sketchCanvas.width=d.x;this.sketchCanvas.height=d.y;this.sketchContext=this.sketchCanvas.getContext("2d");if(this.viewport.getRotation()===0){var c=this;this.viewer.addHandler("rotate",function b(){c.viewer.removeHandler("rotate",b);var g=c._calculateSketchCanvasSize();c.sketchCanvas.width=g.x;c.sketchCanvas.height=g.y})}}e=this.sketchContext}return e},saveContext:function(b){if(!this.useCanvas){return}this._getContext(b).save()},restoreContext:function(b){if(!this.useCanvas){return}this._getContext(b).restore()},setClip:function(d,c){if(!this.useCanvas){return}var b=this._getContext(c);b.beginPath();b.rect(d.x,d.y,d.width,d.height);b.clip()},drawRectangle:function(e,b,d){if(!this.useCanvas){return}var c=this._getContext(d);c.save();c.fillStyle=b;c.fillRect(e.x,e.y,e.width,e.height);c.restore()},blendSketch:function(l,f,c,k){var n=l;if(!a.isPlainObject(n)){n={opacity:l,scale:f,translate:c,compositeOperation:k}}if(!this.useCanvas||!this.sketchCanvas){return}l=n.opacity;k=n.compositeOperation;var b=n.bounds;this.context.save();this.context.globalAlpha=l;if(k){this.context.globalCompositeOperation=k}if(b){try{this.context.drawImage(this.sketchCanvas,b.x,b.y,b.width,b.height,b.x,b.y,b.width,b.height)}catch(m){}}else{f=n.scale||1;c=n.translate;var j=c instanceof a.Point?c:new a.Point(0,0);var d=0;var h=0;if(c){var i=this.sketchCanvas.width-this.canvas.width;var g=this.sketchCanvas.height-this.canvas.height;d=Math.round(i/2);h=Math.round(g/2)}this.context.drawImage(this.sketchCanvas,j.x-d*f,j.y-h*f,(this.canvas.width+2*d)*f,(this.canvas.height+2*h)*f,-d,-h,this.canvas.width+2*d,this.canvas.height+2*h)}this.context.restore()},drawDebugInfo:function(g,f,e){if(!this.useCanvas){return}var d=this.context;d.save();d.lineWidth=2*a.pixelDensityRatio;d.font="small-caps bold "+(13*a.pixelDensityRatio)+"px arial";d.strokeStyle=this.debugGridColor;d.fillStyle=this.debugGridColor;if(this.viewport.degrees!==0){this._offsetForRotation(this.viewport.degrees)}d.strokeRect(g.position.x*a.pixelDensityRatio,g.position.y*a.pixelDensityRatio,g.size.x*a.pixelDensityRatio,g.size.y*a.pixelDensityRatio);var c=(g.position.x+(g.size.x/2))*a.pixelDensityRatio;var b=(g.position.y+(g.size.y/2))*a.pixelDensityRatio;d.translate(c,b);d.rotate(Math.PI/180*-this.viewport.degrees);d.translate(-c,-b);if(g.x===0&&g.y===0){d.fillText("Zoom: "+this.viewport.getZoom(),g.position.x*a.pixelDensityRatio,(g.position.y-30)*a.pixelDensityRatio);d.fillText("Pan: "+this.viewport.getBounds().toString(),g.position.x*a.pixelDensityRatio,(g.position.y-20)*a.pixelDensityRatio)}d.fillText("Level: "+g.level,(g.position.x+10)*a.pixelDensityRatio,(g.position.y+20)*a.pixelDensityRatio);d.fillText("Column: "+g.x,(g.position.x+10)*a.pixelDensityRatio,(g.position.y+30)*a.pixelDensityRatio);d.fillText("Row: "+g.y,(g.position.x+10)*a.pixelDensityRatio,(g.position.y+40)*a.pixelDensityRatio);d.fillText("Order: "+e+" of "+f,(g.position.x+10)*a.pixelDensityRatio,(g.position.y+50)*a.pixelDensityRatio);d.fillText("Size: "+g.size.toString(),(g.position.x+10)*a.pixelDensityRatio,(g.position.y+60)*a.pixelDensityRatio);d.fillText("Position: "+g.position.toString(),(g.position.x+10)*a.pixelDensityRatio,(g.position.y+70)*a.pixelDensityRatio);if(this.viewport.degrees!==0){this._restoreRotationChanges()}d.restore()},debugRect:function(c){if(this.useCanvas){var b=this.context;b.save();b.lineWidth=2*a.pixelDensityRatio;b.strokeStyle=this.debugGridColor;b.fillStyle=this.debugGridColor;b.strokeRect(c.x*a.pixelDensityRatio,c.y*a.pixelDensityRatio,c.width*a.pixelDensityRatio,c.height*a.pixelDensityRatio);b.restore()}},getCanvasSize:function(c){var b=this._getContext(c).canvas;return new a.Point(b.width,b.height)},_offsetForRotation:function(e,d){var b=this.canvas.width/2;var f=this.canvas.height/2;var c=this._getContext(d);c.save();c.translate(b,f);c.rotate(Math.PI/180*e);c.translate(-b,-f)},_restoreRotationChanges:function(c){var b=this._getContext(c);b.restore()},_calculateCanvasSize:function(){var c=a.pixelDensityRatio;var b=this.viewport.getContainerSize();return{x:b.x*c,y:b.y*c}},_calculateSketchCanvasSize:function(){var b=this._calculateCanvasSize();if(this.viewport.getRotation()===0){return b}var c=Math.ceil(Math.sqrt(b.x*b.x+b.y*b.y));return{x:c,y:c}}}}(OpenSeadragon));(function(a){a.Viewport=function(c){var b=arguments;if(b.length&&b[0] instanceof a.Point){c={containerSize:b[0],contentSize:b[1],config:b[2]}}if(c.config){a.extend(true,c,c.config);delete c.config}this._margins=a.extend({left:0,top:0,right:0,bottom:0},c.margins||{});delete c.margins;a.extend(true,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:a.DEFAULT_SETTINGS.springStiffness,animationTime:a.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:a.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:a.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:a.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:a.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:a.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:a.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:a.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:a.DEFAULT_SETTINGS.maxZoomLevel,degrees:a.DEFAULT_SETTINGS.degrees,homeFillsViewer:a.DEFAULT_SETTINGS.homeFillsViewer},c);this._updateContainerInnerSize();this.centerSpringX=new a.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime});this.centerSpringY=new a.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime});this.zoomSpring=new a.Spring({exponential:true,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime});this._oldCenterX=this.centerSpringX.current.value;this._oldCenterY=this.centerSpringY.current.value;this._oldZoom=this.zoomSpring.current.value;this._setContentBounds(new a.Rect(0,0,1,1),1);this.goHome(true);this.update()};a.Viewport.prototype={resetContentSize:function(b){a.console.assert(b,"[Viewport.resetContentSize] contentSize is required");a.console.assert(b instanceof a.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point");a.console.assert(b.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0");a.console.assert(b.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0");this._setContentBounds(new a.Rect(0,0,1,b.y/b.x),b.x);return this},setHomeBounds:function(b,c){a.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually.");this._setContentBounds(b,c)},_setContentBounds:function(b,c){a.console.assert(b,"[Viewport._setContentBounds] bounds is required");a.console.assert(b instanceof a.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect");a.console.assert(b.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0");a.console.assert(b.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0");this._contentBoundsNoRotate=b.clone();this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(c);this._contentBounds=b.rotate(this.degrees).getBoundingBox();this._contentSize=this._contentBounds.getSize().times(c);this._contentAspectRatio=this._contentSize.x/this._contentSize.y;if(this.viewer){this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:c,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})}},getHomeZoom:function(){if(this.defaultZoomLevel){return this.defaultZoomLevel}var c=this._contentAspectRatio/this.getAspectRatio();var b;if(this.homeFillsViewer){b=c>=1?c:1}else{b=c>=1?1:c}return b/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var c=this._contentBounds.getCenter();var d=1/this.getHomeZoom();var b=d/this.getAspectRatio();return new a.Rect(c.x-(d/2),c.y-(b/2),d,b)},goHome:function(b){if(this.viewer){this.viewer.raiseEvent("home",{immediately:b})}return this.fitBounds(this.getHomeBounds(),b)},getMinZoom:function(){var c=this.getHomeZoom(),b=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*c;return b},getMaxZoom:function(){var b=this.maxZoomLevel;if(!b){b=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x;b/=this._contentBounds.width}return Math.max(b,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new a.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return a.extend({},this._margins)},setMargins:function(b){a.console.assert(a.type(b)==="object","[Viewport.setMargins] margins must be an object");this._margins=a.extend({left:0,top:0,right:0,bottom:0},b);this._updateContainerInnerSize();if(this.viewer){this.viewer.forceRedraw()}},getBounds:function(b){return this.getBoundsNoRotate(b).rotate(-this.getRotation())},getBoundsNoRotate:function(e){var c=this.getCenter(e);var d=1/this.getZoom(e);var b=d/this.getAspectRatio();return new a.Rect(c.x-(d/2),c.y-(b/2),d,b)},getBoundsWithMargins:function(b){return this.getBoundsNoRotateWithMargins(b).rotate(-this.getRotation(),this.getCenter(b))},getBoundsNoRotateWithMargins:function(d){var c=this.getBoundsNoRotate(d);var b=this._containerInnerSize.x*this.getZoom(d);c.x-=this._margins.left/b;c.y-=this._margins.top/b;c.width+=(this._margins.left+this._margins.right)/b;c.height+=(this._margins.top+this._margins.bottom)/b;return c},getCenter:function(h){var f=new a.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),j=new a.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),g,k,c,i,b,d,e,l;if(h){return f}else{if(!this.zoomPoint){return j}}g=this.pixelFromPoint(this.zoomPoint,true);k=this.getZoom();c=1/k;i=c/this.getAspectRatio();b=new a.Rect(f.x-c/2,f.y-i/2,c,i);d=this._pixelFromPoint(this.zoomPoint,b);e=d.minus(g);l=e.divide(this._containerInnerSize.x*k);return j.plus(l)},getZoom:function(b){if(b){return this.zoomSpring.current.value}else{return this.zoomSpring.target.value}},_applyZoomConstraints:function(b){return Math.max(Math.min(b,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(b,h){var f=new a.Rect(b.x,b.y,b.width,b.height);if(this.wrapHorizontal){}else{var j=this.visibilityRatio*f.width;var n=f.x+f.width;var k=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width;var d=this._contentBoundsNoRotate.x-n+j;var g=k-f.x-j;if(j>this._contentBoundsNoRotate.width){f.x+=(d+g)/2}else{if(g<0){f.x+=g}else{if(d>0){f.x+=d}}}}if(this.wrapVertical){}else{var e=this.visibilityRatio*f.height;var m=f.y+f.height;var l=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height;var i=this._contentBoundsNoRotate.y-m+e;var c=l-f.y-e;if(e>this._contentBoundsNoRotate.height){f.y+=(i+c)/2}else{if(c<0){f.y+=c}else{if(i>0){f.y+=i}}}}if(this.viewer){this.viewer.raiseEvent("constrain",{immediately:h})}return f},applyConstraints:function(b){var f=this.getZoom();var d=this._applyZoomConstraints(f);if(f!==d){this.zoomTo(d,this.zoomPoint,b)}var e=this.getBoundsNoRotate();var c=this._applyBoundaryConstraints(e,b);if(e.x!==c.x||e.y!==c.y||b){this.fitBounds(c.rotate(-this.getRotation()),b)}return this},ensureVisible:function(b){return this.applyConstraints(b)},_fitBounds:function(c,n){n=n||{};var g=n.immediately||false;var h=n.constraints||false;var d=this.getAspectRatio();var e=c.getCenter();var f=new a.Rect(c.x,c.y,c.width,c.height,c.degrees+this.getRotation()).getBoundingBox();if(f.getAspectRatio()>=d){f.height=f.width/d}else{f.width=f.height*d}f.x=e.x-f.width/2;f.y=e.y-f.height/2;var i=1/f.width;if(h){var j=f.getAspectRatio();var k=this._applyZoomConstraints(i);if(i!==k){i=k;f.width=1/i;f.x=e.x-f.width/2;f.height=f.width/j;f.y=e.y-f.height/2}f=this._applyBoundaryConstraints(f,g);e=f.getCenter()}if(g){this.panTo(e,true);return this.zoomTo(i,null,true)}this.panTo(this.getCenter(true),true);this.zoomTo(this.getZoom(true),null,true);var b=this.getBounds();var m=this.getZoom();if(m===0||Math.abs(i/m-1)<1e-8){this.zoomTo(i,true);return this.panTo(e,g)}f=f.rotate(-this.getRotation());var l=f.getTopLeft().times(i).minus(b.getTopLeft().times(m)).divide(i-m);return this.zoomTo(i,l,g)},fitBounds:function(c,b){return this._fitBounds(c,{immediately:b,constraints:false})},fitBoundsWithConstraints:function(c,b){return this._fitBounds(c,{immediately:b,constraints:true})},fitVertically:function(b){var c=new a.Rect(this._contentBounds.x+(this._contentBounds.width/2),this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(c,b)},fitHorizontally:function(b){var c=new a.Rect(this._contentBounds.x,this._contentBounds.y+(this._contentBounds.height/2),this._contentBounds.width,0);return this.fitBounds(c,b)},panBy:function(d,c){var b=new a.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(b.plus(d),c)},panTo:function(b,c){if(c){this.centerSpringX.resetTo(b.x);this.centerSpringY.resetTo(b.y)}else{this.centerSpringX.springTo(b.x);this.centerSpringY.springTo(b.y)}if(this.viewer){this.viewer.raiseEvent("pan",{center:b,immediately:c})}return this},zoomBy:function(c,d,b){return this.zoomTo(this.zoomSpring.target.value*c,d,b)},zoomTo:function(d,c,b){this.zoomPoint=c instanceof a.Point&&!isNaN(c.x)&&!isNaN(c.y)?c:null;if(b){this.zoomSpring.resetTo(d)}else{this.zoomSpring.springTo(d)}if(this.viewer){this.viewer.raiseEvent("zoom",{zoom:d,refPoint:c,immediately:b})}return this},setRotation:function(b){if(!this.viewer||!this.viewer.drawer.canRotate()){return this}b=b%360;if(b<0){b+=360}this.degrees=b;this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor());this.viewer.forceRedraw();this.viewer.raiseEvent("rotate",{degrees:b});return this},getRotation:function(){return this.degrees},resize:function(c,f){var b=this.getBoundsNoRotate(),d=b,e;this.containerSize.x=c.x;this.containerSize.y=c.y;this._updateContainerInnerSize();if(f){e=c.x/this.containerSize.x;d.width=b.width*e;d.height=d.width/this.getAspectRatio()}if(this.viewer){this.viewer.raiseEvent("resize",{newContainerSize:c,maintain:f})}return this.fitBounds(d,true)},_updateContainerInnerSize:function(){this._containerInnerSize=new a.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){if(this.zoomPoint){var f=this.pixelFromPoint(this.zoomPoint,true);this.zoomSpring.update();var d=this.pixelFromPoint(this.zoomPoint,true);var c=d.minus(f);var b=this.deltaPointsFromPixels(c,true);this.centerSpringX.shiftBy(b.x);this.centerSpringY.shiftBy(b.y);if(this.zoomSpring.isAtTargetValue()){this.zoomPoint=null}}else{this.zoomSpring.update()}this.centerSpringX.update();this.centerSpringY.update();var e=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;this._oldCenterX=this.centerSpringX.current.value;this._oldCenterY=this.centerSpringY.current.value;this._oldZoom=this.zoomSpring.current.value;return e},deltaPixelsFromPointsNoRotate:function(b,c){return b.times(this._containerInnerSize.x*this.getZoom(c))},deltaPixelsFromPoints:function(b,c){return this.deltaPixelsFromPointsNoRotate(b.rotate(this.getRotation()),c)},deltaPointsFromPixelsNoRotate:function(c,b){return c.divide(this._containerInnerSize.x*this.getZoom(b))},deltaPointsFromPixels:function(c,b){return this.deltaPointsFromPixelsNoRotate(c,b).rotate(-this.getRotation())},pixelFromPointNoRotate:function(b,c){return this._pixelFromPointNoRotate(b,this.getBoundsNoRotate(c))},pixelFromPoint:function(b,c){return this._pixelFromPoint(b,this.getBoundsNoRotate(c))},_pixelFromPointNoRotate:function(b,c){return b.minus(c.getTopLeft()).times(this._containerInnerSize.x/c.width).plus(new a.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(b,c){return this._pixelFromPointNoRotate(b.rotate(this.getRotation(),this.getCenter(true)),c)},pointFromPixelNoRotate:function(b,d){var c=this.getBoundsNoRotate(d);return b.minus(new a.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/c.width).plus(c.getTopLeft())},pointFromPixel:function(b,c){return this.pointFromPixelNoRotate(b,c).rotate(-this.getRotation(),this.getCenter(true))},_viewportToImageDelta:function(c,b){var d=this._contentBoundsNoRotate.width;return new a.Point(c*this._contentSizeNoRotate.x/d,b*this._contentSizeNoRotate.x/d)},viewportToImageCoordinates:function(e,b){if(e instanceof a.Point){return this.viewportToImageCoordinates(e.x,e.y)}if(this.viewer){var d=this.viewer.world.getItemCount();if(d>1){a.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.")}else{if(d===1){var c=this.viewer.world.getItemAt(0);return c.viewportToImageCoordinates(e,b,true)}}}return this._viewportToImageDelta(e-this._contentBoundsNoRotate.x,b-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(c,b){var d=this._contentBoundsNoRotate.width;return new a.Point(c/this._contentSizeNoRotate.x*d,b/this._contentSizeNoRotate.x*d)},imageToViewportCoordinates:function(d,c){if(d instanceof a.Point){return this.imageToViewportCoordinates(d.x,d.y)}if(this.viewer){var f=this.viewer.world.getItemCount();if(f>1){a.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.")}else{if(f===1){var e=this.viewer.world.getItemAt(0);return e.imageToViewportCoordinates(d,c,true)}}}var b=this._imageToViewportDelta(d,c);b.x+=this._contentBoundsNoRotate.x;b.y+=this._contentBoundsNoRotate.y;return b},imageToViewportRectangle:function(g,f,d,b){var e=g;if(!(e instanceof a.Rect)){e=new a.Rect(g,f,d,b)}if(this.viewer){var c=this.viewer.world.getItemCount();if(c>1){a.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.")}else{if(c===1){var i=this.viewer.world.getItemAt(0);return i.imageToViewportRectangle(g,f,d,b,true)}}}var j=this.imageToViewportCoordinates(e.x,e.y);var h=this._imageToViewportDelta(e.width,e.height);return new a.Rect(j.x,j.y,h.x,h.y,e.degrees)},viewportToImageRectangle:function(h,g,b,e){var d=h;if(!(d instanceof a.Rect)){d=new a.Rect(h,g,b,e)}if(this.viewer){var c=this.viewer.world.getItemCount();if(c>1){a.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.")}else{if(c===1){var i=this.viewer.world.getItemAt(0);return i.viewportToImageRectangle(h,g,b,e,true)}}}var j=this.viewportToImageCoordinates(d.x,d.y);var f=this._viewportToImageDelta(d.width,d.height);return new a.Rect(j.x,j.y,f.x,f.y,d.degrees)},viewerElementToImageCoordinates:function(c){var b=this.pointFromPixel(c,true);return this.viewportToImageCoordinates(b)},imageToViewerElementCoordinates:function(c){var b=this.imageToViewportCoordinates(c);return this.pixelFromPoint(b,true)},windowToImageCoordinates:function(b){a.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var c=b.minus(a.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(c)},imageToWindowCoordinates:function(b){a.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var c=this.imageToViewerElementCoordinates(b);return c.plus(a.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(b){return this.pointFromPixel(b,true)},viewportToViewerElementCoordinates:function(b){return this.pixelFromPoint(b,true)},viewerElementToViewportRectangle:function(b){return a.Rect.fromSummits(this.pointFromPixel(b.getTopLeft(),true),this.pointFromPixel(b.getTopRight(),true),this.pointFromPixel(b.getBottomLeft(),true))},viewportToViewerElementRectangle:function(b){return a.Rect.fromSummits(this.pixelFromPoint(b.getTopLeft(),true),this.pixelFromPoint(b.getTopRight(),true),this.pixelFromPoint(b.getBottomLeft(),true))},windowToViewportCoordinates:function(b){a.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var c=b.minus(a.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(c)},viewportToWindowCoordinates:function(b){a.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var c=this.viewportToViewerElementCoordinates(b);return c.plus(a.getElementPosition(this.viewer.element))},viewportToImageZoom:function(c){if(this.viewer){var f=this.viewer.world.getItemCount();if(f>1){a.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.")}else{if(f===1){var e=this.viewer.world.getItemAt(0);return e.viewportToImageZoom(c)}}}var b=this._contentSizeNoRotate.x;var g=this._containerInnerSize.x;var h=this._contentBoundsNoRotate.width;var d=(g/b)*h;return c*d},imageToViewportZoom:function(h){if(this.viewer){var e=this.viewer.world.getItemCount();if(e>1){a.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.")}else{if(e===1){var d=this.viewer.world.getItemAt(0);return d.imageToViewportZoom(h)}}}var b=this._contentSizeNoRotate.x;var f=this._containerInnerSize.x;var g=this._contentBoundsNoRotate.width;var c=(b/f)/g;return h*c}}}(OpenSeadragon));(function(d){d.TiledImage=function(t){var z=this;d.console.assert(t.tileCache,"[TiledImage] options.tileCache is required");d.console.assert(t.drawer,"[TiledImage] options.drawer is required");d.console.assert(t.viewer,"[TiledImage] options.viewer is required");d.console.assert(t.imageLoader,"[TiledImage] options.imageLoader is required");d.console.assert(t.source,"[TiledImage] options.source is required");d.console.assert(!t.clip||t.clip instanceof d.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present");d.EventSource.call(this);this._tileCache=t.tileCache;delete t.tileCache;this._drawer=t.drawer;delete t.drawer;this._imageLoader=t.imageLoader;delete t.imageLoader;if(t.clip instanceof d.Rect){this._clip=t.clip.clone()}delete t.clip;var r=t.x||0;delete t.x;var w=t.y||0;delete t.y;this.normHeight=t.source.dimensions.y/t.source.dimensions.x;this.contentAspectX=t.source.dimensions.x/t.source.dimensions.y;var v=1;if(t.width){v=t.width;delete t.width;if(t.height){d.console.error("specifying both width and height to a tiledImage is not supported");delete t.height}}else{if(t.height){v=t.height/this.normHeight;delete t.height}}var s=t.fitBounds;delete t.fitBounds;var u=t.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete t.fitBoundsPlacement;d.extend(true,this,{viewer:null,tilesMatrix:{},coverage:{},lastDrawn:[],lastResetTime:0,_midDraw:false,_needsDraw:true,_hasOpaqueTile:false,springStiffness:d.DEFAULT_SETTINGS.springStiffness,animationTime:d.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:d.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:d.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:d.DEFAULT_SETTINGS.wrapVertical,immediateRender:d.DEFAULT_SETTINGS.immediateRender,blendTime:d.DEFAULT_SETTINGS.blendTime,alwaysBlend:d.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:d.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:d.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:d.DEFAULT_SETTINGS.iOSDevice,debugMode:d.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:d.DEFAULT_SETTINGS.crossOriginPolicy,placeholderFillStyle:d.DEFAULT_SETTINGS.placeholderFillStyle,opacity:d.DEFAULT_SETTINGS.opacity,compositeOperation:d.DEFAULT_SETTINGS.compositeOperation},t);this._xSpring=new d.Spring({initial:r,springStiffness:this.springStiffness,animationTime:this.animationTime});this._ySpring=new d.Spring({initial:w,springStiffness:this.springStiffness,animationTime:this.animationTime});this._scaleSpring=new d.Spring({initial:v,springStiffness:this.springStiffness,animationTime:this.animationTime});this._updateForScale();if(s){this.fitBounds(s,u,true)}this._drawingHandler=function(x){z.viewer.raiseEvent("tile-drawing",d.extend({tiledImage:z},x))}};d.extend(d.TiledImage.prototype,d.EventSource.prototype,{needsDraw:function(){return this._needsDraw},reset:function(){this._tileCache.clearTilesFor(this);this.lastResetTime=d.now();this._needsDraw=true},update:function(){var t=this._xSpring.current.value;var s=this._ySpring.current.value;var r=this._scaleSpring.current.value;this._xSpring.update();this._ySpring.update();this._scaleSpring.update();if(this._xSpring.current.value!==t||this._ySpring.current.value!==s||this._scaleSpring.current.value!==r){this._updateForScale();this._needsDraw=true;return true}return false},draw:function(){if(this.opacity!==0){this._midDraw=true;i(this);this._midDraw=false}},destroy:function(){this.reset()},getBounds:function(r){if(r){return new d.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent)}return new d.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){d.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead");return this.getBounds()},getClippedBounds:function(u){var t=this.getBounds(u);if(this._clip){var r=this._worldWidthCurrent/this.source.dimensions.x;var s=this._clip.times(r);t=new d.Rect(t.x+s.x,t.y+s.y,s.width,s.height)}return t},getContentSize:function(){return new d.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(s,r,t){var u=(t?this._scaleSpring.current.value:this._scaleSpring.target.value);return new d.Point(s*(this.source.dimensions.x/u),r*((this.source.dimensions.y*this.contentAspectX)/u))},viewportToImageCoordinates:function(s,r,t){if(s instanceof d.Point){t=r;r=s.y;s=s.x}if(t){return this._viewportToImageDelta(s-this._xSpring.current.value,r-this._ySpring.current.value)}return this._viewportToImageDelta(s-this._xSpring.target.value,r-this._ySpring.target.value)},_imageToViewportDelta:function(s,r,t){var u=(t?this._scaleSpring.current.value:this._scaleSpring.target.value);return new d.Point((s/this.source.dimensions.x)*u,(r/this.source.dimensions.y/this.contentAspectX)*u)},imageToViewportCoordinates:function(t,s,u){if(t instanceof d.Point){u=s;s=t.y;t=t.x}var r=this._imageToViewportDelta(t,s);if(u){r.x+=this._xSpring.current.value;r.y+=this._ySpring.current.value}else{r.x+=this._xSpring.target.value;r.y+=this._ySpring.target.value}return r},imageToViewportRectangle:function(v,u,y,t,x){var w=v;if(w instanceof d.Rect){x=u}else{w=new d.Rect(v,u,y,t)}var s=this.imageToViewportCoordinates(w.getTopLeft(),x);var r=this._imageToViewportDelta(w.width,w.height,x);return new d.Rect(s.x,s.y,r.x,r.y,w.degrees)},viewportToImageRectangle:function(w,u,y,t,x){var v=w;if(w instanceof d.Rect){x=u}else{v=new d.Rect(w,u,y,t)}var s=this.viewportToImageCoordinates(v.getTopLeft(),x);var r=this._viewportToImageDelta(v.width,v.height,x);return new d.Rect(s.x,s.y,r.x,r.y,v.degrees)},viewerElementToImageCoordinates:function(s){var r=this.viewport.pointFromPixel(s,true);return this.viewportToImageCoordinates(r)},imageToViewerElementCoordinates:function(s){var r=this.imageToViewportCoordinates(s);return this.viewport.pixelFromPoint(r,true)},windowToImageCoordinates:function(r){var s=r.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(s)},imageToWindowCoordinates:function(r){var s=this.imageToViewerElementCoordinates(r);return s.plus(OpenSeadragon.getElementPosition(this.viewer.element))},viewportToImageZoom:function(r){var s=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return s*r},imageToViewportZoom:function(s){var r=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return s/r},setPosition:function(r,s){var t=(this._xSpring.target.value===r.x&&this._ySpring.target.value===r.y);if(s){if(t&&this._xSpring.current.value===r.x&&this._ySpring.current.value===r.y){return}this._xSpring.resetTo(r.x);this._ySpring.resetTo(r.y);this._needsDraw=true}else{if(t){return}this._xSpring.springTo(r.x);this._ySpring.springTo(r.y);this._needsDraw=true}if(!t){this._raiseBoundsChange()}},setWidth:function(s,r){this._setScale(s,r)},setHeight:function(r,s){this._setScale(r/this.normHeight,s)},fitBounds:function(r,z,y){z=z||d.Placement.CENTER;var x=d.Placement.properties[z];var D=this.contentAspectX;var A=0;var w=0;var s=1;var B=1;if(this._clip){D=this._clip.getAspectRatio();s=this._clip.width/this.source.dimensions.x;B=this._clip.height/this.source.dimensions.y;if(r.getAspectRatio()>D){A=this._clip.x/this._clip.height*r.height;w=this._clip.y/this._clip.height*r.height}else{A=this._clip.x/this._clip.width*r.width;w=this._clip.y/this._clip.width*r.width}}if(r.getAspectRatio()>D){var C=r.height/B;var v=0;if(x.isHorizontallyCentered){v=(r.width-r.height*D)/2}else{if(x.isRight){v=r.width-r.height*D}}this.setPosition(new d.Point(r.x-A+v,r.y-w),y);this.setHeight(C,y)}else{var u=r.width/s;var t=0;if(x.isVerticallyCentered){t=(r.height-r.width/D)/2}else{if(x.isBottom){t=r.height-r.width/D}}this.setPosition(new d.Point(r.x-A,r.y-w+t),y);this.setWidth(u,y)}},getClip:function(){if(this._clip){return this._clip.clone()}return null},setClip:function(r){d.console.assert(!r||r instanceof d.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null");if(r instanceof d.Rect){this._clip=r.clone()}else{this._clip=null}this._needsDraw=true},getOpacity:function(){return this.opacity},setOpacity:function(r){this.opacity=r;this._needsDraw=true},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(r){this.compositeOperation=r;this._needsDraw=true},_setScale:function(t,r){var s=(this._scaleSpring.target.value===t);if(r){if(s&&this._scaleSpring.current.value===t){return}this._scaleSpring.resetTo(t);this._updateForScale();this._needsDraw=true}else{if(s){return}this._scaleSpring.springTo(t);this._updateForScale();this._needsDraw=true}if(!s){this._raiseBoundsChange()}},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value;this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value;this._worldWidthCurrent=this._scaleSpring.current.value;this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this}});function i(I){I._needsDraw=false;var J,r,s=null,y=false,E=d.now(),F=I.viewport.getBoundsWithMargins(true),w=I.viewport.deltaPixelsFromPointsNoRotate(I.source.getPixelRatio(0),true).x*I._scaleSpring.current.value,z=Math.max(I.source.minLevel,Math.floor(Math.log(I.minZoomImageRatio)/Math.log(2))),D=Math.min(Math.abs(I.source.maxLevel),Math.abs(Math.floor(Math.log(w/I.minPixelRatio)/Math.log(2)))),A,u,H,K,L,C;while(I.lastDrawn.length>0){J=I.lastDrawn.pop();J.beingDrawn=false}if(!I.wrapHorizontal&&!I.wrapVertical){var v=I.getClippedBounds(true);var x=F.intersection(v);if(x===null){return}F=x}F=F.getBoundingBox();F.x-=I._xSpring.current.value;F.y-=I._ySpring.current.value;var G=F.getTopLeft();var B=F.getBottomRight();if(!I.wrapHorizontal&&(B.x<0||G.x>I._worldWidthCurrent)){return}if(!I.wrapVertical&&(B.y<0||G.y>I._worldHeightCurrent)){return}if(!I.wrapHorizontal){G.x=Math.max(G.x,0);B.x=Math.min(B.x,I._worldWidthCurrent)}if(!I.wrapVertical){G.y=Math.max(G.y,0);B.y=Math.min(B.y,I._worldHeightCurrent)}z=Math.min(z,D);var t;for(r=D;r>=z;r--){t=false;A=I.viewport.deltaPixelsFromPointsNoRotate(I.source.getPixelRatio(r),true).x*I._scaleSpring.current.value;if((!y&&A>=I.minPixelRatio)||(r==z)){t=true;y=true}else{if(!y){continue}}u=I.viewport.deltaPixelsFromPointsNoRotate(I.source.getPixelRatio(r),false).x*I._scaleSpring.current.value;H=I.viewport.deltaPixelsFromPointsNoRotate(I.source.getPixelRatio(Math.max(I.source.getClosestLevel(I.viewport.containerSize)-1,0)),false).x*I._scaleSpring.current.value;K=I.immediateRender?1:H;L=Math.min(1,(A-0.5)/0.5);C=K/Math.abs(K-u);s=p(I,y,t,r,L,C,G,B,E,s);if(c(I.coverage,r)){break}}h(I,I.lastDrawn);if(s&&!s.context2D){k(I,s,E)}}function p(u,F,G,s,v,E,H,I,t,w){var D,C,B,A,r,z=u.viewport.pixelFromPoint(u.viewport.getCenter());if(u.viewer){u.viewer.raiseEvent("update-level",{tiledImage:u,havedrawn:F,level:s,opacity:v,visibility:E,topleft:H,bottomright:I,currenttime:t,best:w})}B=u.source.getTileAtPoint(s,H.divide(u._scaleSpring.current.value));A=u.source.getTileAtPoint(s,I.divide(u._scaleSpring.current.value));r=u.source.getNumTiles(s);a(u.coverage,s);if(!u.wrapHorizontal){A.x=Math.min(A.x,r.x-1)}if(!u.wrapVertical){A.y=Math.min(A.y,r.y-1)}for(D=B.x;D<=A.x;D++){for(C=B.y;C<=A.y;C++){w=n(u,G,F,D,C,s,v,E,z,r,t,w)}}return w}function n(w,J,I,G,F,u,A,H,E,s,v,C){var D=g(G,F,u,w.source,w.tilesMatrix,v,s,w._worldWidthCurrent,w._worldHeightCurrent),z=J;if(w.viewer){w.viewer.raiseEvent("update-tile",{tiledImage:w,tile:D})}b(w.coverage,u,G,F,false);if(!D.exists){return C}if(I&&!z){if(o(w.coverage,u,G,F)){b(w.coverage,u,G,F,true)}else{z=true}}if(!z){return C}e(D,w.source.tileOverlap,w.viewport,E,H,w);if(!D.loaded){if(D.context2D){m(w,D)}else{var t=w._tileCache.getImageRecord(D.url);if(t){var B=t.getImage();m(w,D,B)}}}if(D.loaded){var r=l(w,D,G,F,u,A,v);if(r){w._needsDraw=true}}else{if(D.loading){}else{C=q(C,D)}}return C}function g(F,E,t,C,z,v,I,B,D){var w,u,r,G,s,H,A;if(!z[t]){z[t]={}}if(!z[t][F]){z[t][F]={}}if(!z[t][F][E]){w=(I.x+(F%I.x))%I.x;u=(I.y+(E%I.y))%I.y;r=C.getTileBounds(t,w,u);G=C.tileExists(t,w,u);s=C.getTileUrl(t,w,u);H=C.getContext2D?C.getContext2D(t,w,u):undefined;r.x+=(F-w)/I.x;r.y+=(D/B)*((E-u)/I.y);z[t][F][E]=new d.Tile(t,F,E,r,G,s,H)}A=z[t][F][E];A.lastTouchTime=v;return A}function k(s,r,t){r.loading=true;s._imageLoader.addJob({src:r.url,crossOriginPolicy:s.crossOriginPolicy,callback:function(v,u){j(s,r,t,v,u)},abort:function(){r.loading=false}})}function j(u,t,w,v,s){if(!v){d.console.log("Tile %s failed to load: %s - error: %s",t,t.url,s);u.viewer.raiseEvent("tile-load-failed",{tile:t,tiledImage:u,time:w,message:s});t.loading=false;t.exists=false;return}if(w<u.lastResetTime){d.console.log("Ignoring tile %s loaded before reset: %s",t,t.url);t.loading=false;return}var r=function(){var x=Math.ceil(Math.log(u.source.getTileWidth(t.level))/Math.log(2));m(u,t,v,x)};if(!u._midDraw){r()}else{window.setTimeout(r,1)}}function m(v,t,w,s){var r=0;function x(){r++;return u}function u(){r--;if(r===0){t.loading=false;t.loaded=true;if(!t.context2D){v._tileCache.cacheTile({image:w,tile:t,cutoff:s,tiledImage:v})}v._needsDraw=true}}v.viewer.raiseEvent("tile-loaded",{tile:t,tiledImage:v,image:w,getCompletionCallback:x});x()()}function e(x,C,z,y,D,t){var v=x.bounds.getTopLeft();v.x*=t._scaleSpring.current.value;v.y*=t._scaleSpring.current.value;v.x+=t._xSpring.current.value;v.y+=t._ySpring.current.value;var E=x.bounds.getSize();E.x*=t._scaleSpring.current.value;E.y*=t._scaleSpring.current.value;var w=z.pixelFromPointNoRotate(v,true),B=z.pixelFromPointNoRotate(v,false),s=z.deltaPixelsFromPointsNoRotate(E,true),u=z.deltaPixelsFromPointsNoRotate(E,false),A=B.plus(u.divide(2)),r=y.distanceTo(A);if(!C){s=s.plus(new d.Point(1,1))}x.position=w;x.size=s;x.distance=r;x.visibility=D}function l(u,A,C,B,r,v,t){var s=1000*u.blendTime,z,w;if(!A.blendStart){A.blendStart=t}z=t-A.blendStart;w=s?Math.min(1,z/(s)):1;if(u.alwaysBlend){w*=v}A.opacity=w;u.lastDrawn.push(A);if(w==1){b(u.coverage,r,C,B,true);u._hasOpaqueTile=true}else{if(z<s){return true}}return false}function c(w,A,r,z){var u,v,t,s;if(!w[A]){return false}if(r===undefined||z===undefined){u=w[A];for(t in u){if(u.hasOwnProperty(t)){v=u[t];for(s in v){if(v.hasOwnProperty(s)&&!v[s]){return false}}}}return true}return(w[A][r]===undefined||w[A][r][z]===undefined||w[A][r][z]===true)}function o(s,u,r,t){if(r===undefined||t===undefined){return c(s,u+1)}else{return(c(s,u+1,2*r,2*t)&&c(s,u+1,2*r,2*t+1)&&c(s,u+1,2*r+1,2*t)&&c(s,u+1,2*r+1,2*t+1))}}function b(t,v,s,u,r){if(!t[v]){d.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",v);return}if(!t[v][s]){t[v][s]={}}t[v][s][u]=r}function a(r,s){r[s]={}}function q(r,s){if(!r){return s}if(s.visibility>r.visibility){return s}else{if(s.visibility==r.visibility){if(s.distance<r.distance){return s}}}return r}function h(t,w){if(w.length===0){return}var B=w[0];var D=t.opacity<1||(t.compositeOperation&&t.compositeOperation!=="source-over")||(!t._isBottomItem()&&B._hasTransparencyChannel());var x;var E;var G=t.viewport.getZoom(true);var A=t.viewportToImageZoom(G);if(A>t.smoothTileEdgesMinZoom&&!t.iOSDevice){D=true;x=B.getScaleForEdgeSmoothing();E=B.getTranslationForEdgeSmoothing(x,t._drawer.getCanvasSize(false),t._drawer.getCanvasSize(true))}var r;if(D){if(!x){r=t.viewport.viewportToViewerElementRectangle(t.getClippedBounds(true)).getIntegerBoundingBox().times(d.pixelDensityRatio)}t._drawer._clear(true,r)}if(t.viewport.degrees!==0&&!x){t._drawer._offsetForRotation(t.viewport.degrees,D)}var s=false;if(t._clip){t._drawer.saveContext(D);var y=t.imageToViewportRectangle(t._clip,true);var u=t._drawer.viewportToDrawerRectangle(y);if(x){u=u.times(x)}if(E){u=u.translate(E)}t._drawer.setClip(u,D);s=true}if(t.placeholderFillStyle&&t._hasOpaqueTile===false){var C=t._drawer.viewportToDrawerRectangle(t.getBounds(true));if(x){C=C.times(x)}if(E){C=C.translate(E)}var F=null;if(typeof t.placeholderFillStyle==="function"){F=t.placeholderFillStyle(t,t._drawer.context)}else{F=t.placeholderFillStyle}t._drawer.drawRectangle(C,F,D)}for(var v=w.length-1;v>=0;v--){B=w[v];t._drawer.drawTile(B,t._drawingHandler,D,x,E);B.beingDrawn=true;if(t.viewer){t.viewer.raiseEvent("tile-drawn",{tiledImage:t,tile:B})}}if(s){t._drawer.restoreContext(D)}if(t.viewport.degrees!==0&&!x){t._drawer._restoreRotationChanges(D)}if(D){var z=t.viewport.degrees!==0&&x;if(z){t._drawer._offsetForRotation(t.viewport.degrees,false)}t._drawer.blendSketch({opacity:t.opacity,scale:x,translate:E,compositeOperation:t.compositeOperation,bounds:r});if(z){t._drawer._restoreRotationChanges(false)}}f(t,w)}function f(u,s){if(u.debugMode){for(var r=s.length-1;r>=0;r--){var t=s[r];try{u._drawer.drawDebugInfo(t,s.length,r)}catch(v){d.console.error(v)}}}}}(OpenSeadragon));(function(b){var c=function(d){b.console.assert(d,"[TileCache.cacheTile] options is required");b.console.assert(d.tile,"[TileCache.cacheTile] options.tile is required");b.console.assert(d.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");this.tile=d.tile;this.tiledImage=d.tiledImage};var a=function(d){b.console.assert(d,"[ImageRecord] options is required");b.console.assert(d.image,"[ImageRecord] options.image is required");this._image=d.image;this._tiles=[]};a.prototype={destroy:function(){this._image=null;this._renderedContext=null;this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var d=document.createElement("canvas");d.width=this._image.width;d.height=this._image.height;this._renderedContext=d.getContext("2d");this._renderedContext.drawImage(this._image,0,0);this._image=null}return this._renderedContext},setRenderedContext:function(d){b.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext.");this._renderedContext=d},addTile:function(d){b.console.assert(d,"[ImageRecord.addTile] tile is required");this._tiles.push(d)},removeTile:function(e){for(var d=0;d<this._tiles.length;d++){if(this._tiles[d]===e){this._tiles.splice(d,1);return}}b.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",e)},getTileCount:function(){return this._tiles.length}};b.TileCache=function(d){d=d||{};this._maxImageCacheCount=d.maxImageCacheCount||b.DEFAULT_SETTINGS.maxImageCacheCount;this._tilesLoaded=[];this._imagesLoaded=[];this._imagesLoadedCount=0};b.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(r){b.console.assert(r,"[TileCache.cacheTile] options is required");b.console.assert(r.tile,"[TileCache.cacheTile] options.tile is required");b.console.assert(r.tile.url,"[TileCache.cacheTile] options.tile.url is required");b.console.assert(r.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var g=r.cutoff||0;var j=this._tilesLoaded.length;var e=this._imagesLoaded[r.tile.url];if(!e){b.console.assert(r.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord");e=this._imagesLoaded[r.tile.url]=new a({image:r.image});this._imagesLoadedCount++}e.addTile(r.tile);r.tile.cacheImageRecord=e;if(this._imagesLoadedCount>this._maxImageCacheCount){var m=null;var q=-1;var n=null;var l,f,h,d,p,o;for(var k=this._tilesLoaded.length-1;k>=0;k--){o=this._tilesLoaded[k];l=o.tile;if(l.level<=g||l.beingDrawn){continue}else{if(!m){m=l;q=k;n=o;continue}}d=l.lastTouchTime;f=m.lastTouchTime;p=l.level;h=m.level;if(d<f||(d==f&&p>h)){m=l;q=k;n=o}}if(m&&q>=0){this._unloadTile(n);j=q}}this._tilesLoaded[j]=new c({tile:r.tile,tiledImage:r.tiledImage})},clearTilesFor:function(f){b.console.assert(f,"[TileCache.clearTilesFor] tiledImage is required");var d;for(var e=0;e<this._tilesLoaded.length;++e){d=this._tilesLoaded[e];if(d.tiledImage===f){this._unloadTile(d);this._tilesLoaded.splice(e,1);e--}}},getImageRecord:function(d){b.console.assert(d,"[TileCache.getImageRecord] url is required");return this._imagesLoaded[d]},_unloadTile:function(e){b.console.assert(e,"[TileCache._unloadTile] tileRecord is required");var f=e.tile;var g=e.tiledImage;f.unload();f.cacheImageRecord=null;var d=this._imagesLoaded[f.url];d.removeTile(f);if(!d.getTileCount()){d.destroy();delete this._imagesLoaded[f.url];this._imagesLoadedCount--}g.viewer.raiseEvent("tile-unloaded",{tile:f,tiledImage:g})}}}(OpenSeadragon));(function(a){a.World=function(b){var c=this;a.console.assert(b.viewer,"[World] options.viewer is required");a.EventSource.call(this);this.viewer=b.viewer;this._items=[];this._needsDraw=false;this._autoRefigureSizes=true;this._needsSizesFigured=false;this._delegatedFigureSizes=function(d){if(c._autoRefigureSizes){c._figureSizes()}else{c._needsSizesFigured=true}};this._figureSizes()};a.extend(a.World.prototype,a.EventSource.prototype,{addItem:function(d,c){a.console.assert(d,"[World.addItem] item is required");a.console.assert(d instanceof a.TiledImage,"[World.addItem] only TiledImages supported at this time");c=c||{};if(c.index!==undefined){var b=Math.max(0,Math.min(this._items.length,c.index));this._items.splice(b,0,d)}else{this._items.push(d)}if(this._autoRefigureSizes){this._figureSizes()}else{this._needsSizesFigured=true}this._needsDraw=true;d.addHandler("bounds-change",this._delegatedFigureSizes);this.raiseEvent("add-item",{item:d})},getItemAt:function(b){a.console.assert(b!==undefined,"[World.getItemAt] index is required");return this._items[b]},getIndexOfItem:function(b){a.console.assert(b,"[World.getIndexOfItem] item is required");return a.indexOf(this._items,b)},getItemCount:function(){return this._items.length},setItemIndex:function(c,b){a.console.assert(c,"[World.setItemIndex] item is required");a.console.assert(b!==undefined,"[World.setItemIndex] index is required");var d=this.getIndexOfItem(c);if(b>=this._items.length){throw new Error("Index bigger than number of layers.")}if(b===d||d===-1){return}this._items.splice(d,1);this._items.splice(b,0,c);this._needsDraw=true;this.raiseEvent("item-index-change",{item:c,previousIndex:d,newIndex:b})},removeItem:function(c){a.console.assert(c,"[World.removeItem] item is required");var b=a.indexOf(this._items,c);if(b===-1){return}c.removeHandler("bounds-change",this._delegatedFigureSizes);c.destroy();this._items.splice(b,1);this._figureSizes();this._needsDraw=true;this._raiseRemoveItem(c)},removeAll:function(){this.viewer._cancelPendingImages();var d;for(var c=0;c<this._items.length;c++){d=this._items[c];d.removeHandler("bounds-change",this._delegatedFigureSizes);d.destroy()}var b=this._items;this._items=[];this._figureSizes();this._needsDraw=true;for(c=0;c<b.length;c++){d=b[c];this._raiseRemoveItem(d)}},resetItems:function(){for(var b=0;b<this._items.length;b++){this._items[b].reset()}},update:function(){var c=false;for(var b=0;b<this._items.length;b++){c=this._items[b].update()||c}return c},draw:function(){for(var b=0;b<this._items.length;b++){this._items[b].draw()}this._needsDraw=false},needsDraw:function(){for(var b=0;b<this._items.length;b++){if(this._items[b].needsDraw()){return true}}return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(b){this._autoRefigureSizes=b;if(b&this._needsSizesFigured){this._figureSizes();this._needsSizesFigured=false}},arrange:function(s){s=s||{};var e=s.immediately||false;var j=s.layout||a.DEFAULT_SETTINGS.collectionLayout;var r=s.rows||a.DEFAULT_SETTINGS.collectionRows;var d=s.columns||a.DEFAULT_SETTINGS.collectionColumns;var p=s.tileSize||a.DEFAULT_SETTINGS.collectionTileSize;var q=s.tileMargin||a.DEFAULT_SETTINGS.collectionTileMargin;var m=p+q;var c;if(!s.rows&&d){c=d}else{c=Math.ceil(this._items.length/r)}var l=0;var k=0;var o,h,b,n,g;this.setAutoRefigureSizes(false);for(var f=0;f<this._items.length;f++){if(f&&(f%c)===0){if(j==="horizontal"){k+=m;l=0}else{l+=m;k=0}}o=this._items[f];h=o.getBounds();if(h.width>h.height){b=p}else{b=p*(h.width/h.height)}n=b*(h.height/h.width);g=new a.Point(l+((p-b)/2),k+((p-n)/2));o.setPosition(g,e);o.setWidth(b,e);if(j==="horizontal"){l+=m}else{k+=m}}this.setAutoRefigureSizes(true)},_figureSizes:function(){var f=this._homeBounds?this._homeBounds.clone():null;var l=this._contentSize?this._contentSize.clone():null;var h=this._contentFactor||0;if(!this._items.length){this._homeBounds=new a.Rect(0,0,1,1);this._contentSize=new a.Point(1,1);this._contentFactor=1}else{var m=this._items[0];var c=m.getBounds();this._contentFactor=m.getContentSize().x/c.width;var g=m.getClippedBounds();var d=g.x;var j=g.y;var k=g.x+g.width;var b=g.y+g.height;for(var e=1;e<this._items.length;e++){m=this._items[e];c=m.getBounds();this._contentFactor=Math.max(this._contentFactor,m.getContentSize().x/c.width);g=m.getClippedBounds();d=Math.min(d,g.x);j=Math.min(j,g.y);k=Math.max(k,g.x+g.width);b=Math.max(b,g.y+g.height)}this._homeBounds=new a.Rect(d,j,k-d,b-j);this._contentSize=new a.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}if(this._contentFactor!==h||!this._homeBounds.equals(f)||!this._contentSize.equals(l)){this.raiseEvent("metrics-change",{})}},_raiseRemoveItem:function(b){this.raiseEvent("remove-item",{item:b})}})}(OpenSeadragon));(function(c){if(!c.version||c.version.major<2){throw new Error("This version of OpenSeadragonScalebar requires OpenSeadragon version 2.0.0+")}c.Viewer.prototype.scalebar=function(k){if(!this.scalebarInstance){k=k||{};k.viewer=this;this.scalebarInstance=new c.Scalebar(k)}else{this.scalebarInstance.refresh(k)}};c.ScalebarType={NONE:0,MICROSCOPY:1,MAP:2};c.ScalebarLocation={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4};c.Scalebar=function(l){l=l||{};if(!l.viewer){throw new Error("A viewer must be specified.")}this.viewer=l.viewer;this.divElt=document.createElement("div");this.viewer.container.appendChild(this.divElt);this.divElt.style.position="relative";this.divElt.style.margin="0";this.divElt.style.pointerEvents="none";this.setMinWidth(l.minWidth||"150px");this.setDrawScalebarFunction(l.type||c.ScalebarType.MICROSCOPY);this.color=l.color||"black";this.fontColor=l.fontColor||"black";this.backgroundColor=l.backgroundColor||"none";this.fontSize=l.fontSize||"";this.fontFamily=l.fontFamily||"";this.barThickness=l.barThickness||2;this.pixelsPerMeter=l.pixelsPerMeter||null;this.referenceItemIdx=l.referenceItemIdx||0;this.location=l.location||c.ScalebarLocation.BOTTOM_LEFT;this.xOffset=l.xOffset||5;this.yOffset=l.yOffset||5;this.stayInsideImage=h(l.stayInsideImage)?l.stayInsideImage:true;this.sizeAndTextRenderer=l.sizeAndTextRenderer||c.ScalebarSizeAndTextRenderer.METRIC_LENGTH;var k=this;this.viewer.addHandler("open",function(){k.refresh()});this.viewer.addHandler("animation",function(){k.refresh()});this.viewer.addHandler("resize",function(){k.refresh()})};c.Scalebar.prototype={updateOptions:function(k){if(!k){return}if(h(k.type)){this.setDrawScalebarFunction(k.type)}if(h(k.minWidth)){this.setMinWidth(k.minWidth)}if(h(k.color)){this.color=k.color}if(h(k.fontColor)){this.fontColor=k.fontColor}if(h(k.backgroundColor)){this.backgroundColor=k.backgroundColor}if(h(k.fontSize)){this.fontSize=k.fontSize}if(h(k.fontFamily)){this.fontFamily=k.fontFamily}if(h(k.barThickness)){this.barThickness=k.barThickness}if(h(k.pixelsPerMeter)){this.pixelsPerMeter=k.pixelsPerMeter}if(h(k.referenceItemIdx)){this.referenceItemIdx=k.referenceItemIdx}if(h(k.location)){this.location=k.location}if(h(k.xOffset)){this.xOffset=k.xOffset}if(h(k.yOffset)){this.yOffset=k.yOffset}if(h(k.stayInsideImage)){this.stayInsideImage=k.stayInsideImage}if(h(k.sizeAndTextRenderer)){this.sizeAndTextRenderer=k.sizeAndTextRenderer}},setDrawScalebarFunction:function(k){if(!k){this.drawScalebar=null}else{if(k===c.ScalebarType.MAP){this.drawScalebar=this.drawMapScalebar}else{this.drawScalebar=this.drawMicroscopyScalebar}}},setMinWidth:function(k){this.divElt.style.width=k;this.divElt.style.display="";this.minWidth=this.divElt.offsetWidth},refresh:function(n){this.updateOptions(n);if(!this.viewer.isOpen()||!this.drawScalebar||!this.pixelsPerMeter||!this.location){this.divElt.style.display="none";return}this.divElt.style.display="";var k=this.viewer.viewport;var q=this.viewer.world.getItemAt(this.referenceItemIdx);var p=a(q,k.getZoom(true));var m=p*this.pixelsPerMeter;var o=this.sizeAndTextRenderer(m,this.minWidth);this.drawScalebar(o.size,o.text);var l=this.getScalebarLocation();this.divElt.style.left=l.x+"px";this.divElt.style.top=l.y+"px"},drawMicroscopyScalebar:function(k,l){this.divElt.style.fontSize=this.fontSize;this.divElt.style.fontFamily=this.fontFamily;this.divElt.style.textAlign="center";this.divElt.style.color=this.fontColor;this.divElt.style.border="none";this.divElt.style.borderBottom=this.barThickness+"px solid "+this.color;this.divElt.style.backgroundColor=this.backgroundColor;this.divElt.innerHTML=l;this.divElt.style.width=k+"px"},drawMapScalebar:function(k,l){this.divElt.style.fontSize=this.fontSize;this.divElt.style.fontFamily=this.fontFamily;this.divElt.style.textAlign="center";this.divElt.style.color=this.fontColor;this.divElt.style.border=this.barThickness+"px solid "+this.color;this.divElt.style.borderTop="none";this.divElt.style.backgroundColor=this.backgroundColor;this.divElt.innerHTML=l;this.divElt.style.width=k+"px"},getScalebarLocation:function(){if(this.location===c.ScalebarLocation.TOP_LEFT){var k=0;var p=0;if(this.stayInsideImage){var m=this.viewer.viewport.pixelFromPoint(new c.Point(0,0),true);if(!this.viewer.wrapHorizontal){k=Math.max(m.x,0)}if(!this.viewer.wrapVertical){p=Math.max(m.y,0)}}return new c.Point(k+this.xOffset,p+this.yOffset)}if(this.location===c.ScalebarLocation.TOP_RIGHT){var n=this.divElt.offsetWidth;var l=this.viewer.container;var k=l.offsetWidth-n;var p=0;if(this.stayInsideImage){var m=this.viewer.viewport.pixelFromPoint(new c.Point(1,0),true);if(!this.viewer.wrapHorizontal){k=Math.min(k,m.x-n)}if(!this.viewer.wrapVertical){p=Math.max(p,m.y)}}return new c.Point(k-this.xOffset,p+this.yOffset)}if(this.location===c.ScalebarLocation.BOTTOM_RIGHT){var n=this.divElt.offsetWidth;var o=this.divElt.offsetHeight;var l=this.viewer.container;var k=l.offsetWidth-n;var p=l.offsetHeight-o;if(this.stayInsideImage){var m=this.viewer.viewport.pixelFromPoint(new c.Point(1,1/this.viewer.source.aspectRatio),true);if(!this.viewer.wrapHorizontal){k=Math.min(k,m.x-n)}if(!this.viewer.wrapVertical){p=Math.min(p,m.y-o)}}return new c.Point(k-this.xOffset,p-this.yOffset)}if(this.location===c.ScalebarLocation.BOTTOM_LEFT){var o=this.divElt.offsetHeight;var l=this.viewer.container;var k=0;var p=l.offsetHeight-o;if(this.stayInsideImage){var m=this.viewer.viewport.pixelFromPoint(new c.Point(0,1/this.viewer.source.aspectRatio),true);if(!this.viewer.wrapHorizontal){k=Math.max(k,m.x)}if(!this.viewer.wrapVertical){p=Math.min(p,m.y-o)}}return new c.Point(k+this.xOffset,p-this.yOffset)}},getAsCanvas:function(){var l=document.createElement("canvas");l.width=this.divElt.offsetWidth;l.height=this.divElt.offsetHeight;var m=l.getContext("2d");m.fillStyle=this.backgroundColor;m.fillRect(0,0,l.width,l.height);m.fillStyle=this.color;m.fillRect(0,l.height-this.barThickness,l.width,l.height);if(this.drawScalebar===this.drawMapScalebar){m.fillRect(0,0,this.barThickness,l.height);m.fillRect(l.width-this.barThickness,0,this.barThickness,l.height)}m.font=window.getComputedStyle(this.divElt).font;m.textAlign="center";m.textBaseline="middle";m.fillStyle=this.fontColor;var n=l.width/2;var k=l.height/2;m.fillText(this.divElt.textContent,n,k);return l},getImageWithScalebarAsCanvas:function(){var m=this.viewer.drawer.canvas;var n=document.createElement("canvas");n.width=m.width;n.height=m.height;var o=n.getContext("2d");o.drawImage(m,0,0);var k=this.getAsCanvas();var l=this.getScalebarLocation();o.drawImage(k,l.x,l.y);return n}};c.ScalebarSizeAndTextRenderer={METRIC_LENGTH:function(k,l){return b(k,l,"m")},IMPERIAL_LENGTH:function(n,o){var q=o*2;var l=n*0.0254;if(q<l*12){if(q<l){var k=l/1000;return e(k,o,"th")}return e(l,o,"in")}var m=l*12;if(q<m*2000){return e(m,o,"ft")}var p=m*5280;return e(p,o,"mi")},ASTRONOMY:function(n,m){var o=m*2;if(o<n*60){return e(n,m,'"',false,"")}var l=n*60;if(o<l*60){return e(l,m,"'",false,"")}var k=l*60;return e(k,m,"&#176",false,"")},STANDARD_TIME:function(l,p){var q=p*2;if(q<l*60){return b(l,p,"s",false)}var o=l*60;if(q<o*60){return e(o,p,"minute",true)}var k=o*60;if(q<k*24){return e(k,p,"hour",true)}var m=k*24;if(q<m*365.25){return e(m,p,"day",true)}var n=m*365.25;return e(n,p,"year",true)},METRIC_GENERIC:b};function a(m,k){var l=m._scaleSpring.current.value*m.viewport._containerInnerSize.x/m.source.dimensions.x;return l*k}function e(m,k,r,l,n){n=n===undefined?" ":n;var q=d(m,k);var o=j(q/m*k,3);var s=q*k;var p=l&&o>1?"s":"";return{size:s,text:o+n+r+p}}function b(o,q,p){var n=d(o,q);var m=j(n/o*q,3);var l=n*q;var k=g(m,p);return{size:l,text:k}}function d(n,o){var l=f(n);var m=f(o);var k=f(l/m);if(k>=5){k/=5}if(k>=4){k/=4}if(k>=2){k/=2}return k}function f(k){return k*Math.pow(10,Math.ceil(-i(k)))}function j(k,n){var o=-Math.ceil(-i(k));var m=n-o;var l=k*Math.pow(10,m);if(m<0){return Math.round(l)*Math.pow(10,-m)}return Math.round(l)/Math.pow(10,m)}function i(k){return Math.log(k)/Math.log(10)}function g(k,l){if(k<0.000001){return k*1000000000+" n"+l}if(k<0.001){return k*1000000+" μ"+l}if(k<1){return k*1000+" m"+l}if(k>=1000){return k/1000+" k"+l}return k+" "+l}function h(k){return typeof(k)!=="undefined"}}(OpenSeadragon));(function(a){a.Profiler=function(){this.midUpdate=false;this.numUpdates=0;this.lastBeginTime=null;this.lastEndTime=null;this.minUpdateTime=Infinity;this.avgUpdateTime=0;this.maxUpdateTime=0;this.minIdleTime=Infinity;this.avgIdleTime=0;this.maxIdleTime=0};a.Profiler.prototype={beginUpdate:function(){if(this.midUpdate){this.endUpdate()}this.midUpdate=true;this.lastBeginTime=a.now();if(this.numUpdates<1){return}var b=this.lastBeginTime-this.lastEndTime;this.avgIdleTime=(this.avgIdleTime*(this.numUpdates-1)+b)/this.numUpdates;if(b<this.minIdleTime){this.minIdleTime=b}if(b>this.maxIdleTime){this.maxIdleTime=b}},endUpdate:function(){if(!this.midUpdate){return}this.lastEndTime=a.now();this.midUpdate=false;var b=this.lastEndTime-this.lastBeginTime;this.numUpdates++;this.avgUpdateTime=(this.avgUpdateTime*(this.numUpdates-1)+b)/this.numUpdates;if(b<this.minUpdateTime){this.minUpdateTime=b}if(b>this.maxUpdateTime){this.maxUpdateTime=b}},clearProfile:function(){this.midUpdate=false;this.numUpdates=0;this.lastBeginTime=null;this.lastEndTime=null;this.minUpdateTime=Infinity;this.avgUpdateTime=0;this.maxUpdateTime=0;this.minIdleTime=Infinity;this.avgIdleTime=0;this.maxIdleTime=0}}}(OpenSeadragon));